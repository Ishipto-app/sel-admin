(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{hgve:function(e,t,i){"use strict";i.r(t);var s=i("tyNb"),o=i("5HBU"),a=i("STbY"),r=i("/1cH"),n=i("iadO"),h=i("bTqV"),c=i("7EHt"),l=i("kmnG"),p=i("NFeN"),d=i("Qu3c"),u=i("qFsG"),m=i("wZkO"),b=i("d3UM"),g=i("QibW"),v=i("0IaG"),k=i("/t3+"),f=i("bSwM"),_=i("M9IT"),y=i("xHqg"),S=i("A5z7"),C=i("bv9b"),D=i("XhcP"),w=i("FKr1"),B=i("1jcm"),R=i("+0xr"),O=i("Dh3D"),T=i("IOBc"),A=i("212X"),V=i("LPQX"),j=i("XNiG"),x=i("1G5W"),H=i("PVWW"),I=i("fXoL"),N=i("HX77"),P=i("lJxs"),M=i("2Vo4"),L=i("tk/3"),q=i("I/3d"),E=i("qXBG");let X=(()=>{class e{constructor(e,t,i,s){if(this.router=e,this.db=t,this.authService=i,this._httpClient=s,this.codeCompany=["DCL","SEG","SEL","SIN","SLO","TWN","REF: "],this.filterData={valid:"1"},this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.total={},this.priceHeader=[],this.priceObj={},this.onPermissionChanged=new M.a([]),this.onSelDocumentChanged=new M.a([]),this.onVesselChanged=new M.a([]),this.onDataChanged=new M.a([]),this.onDataItemChanged=new M.a([]),this.onModulChanged=new j.a,this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}}resolve(e){return this.modul=e.params.modul,this.authService.routerData=e,new Promise((e,t)=>{Promise.all([this.getDataVoyage()]).then(([])=>{e()},t)})}getDataVoyage(){let e={headers:new L.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((t,i)=>{this._httpClient.get(this.authService.apiUrl+"/sel/voyage/data",e).subscribe(e=>{this.vessel=e[0],this.supplier=e[1],this.user=e[2],this.country=e[3],this.seaport=e[4],this.seaTerminal=e[5],this.onDataChanged.next(e),t(e)},i)})}getItemData(){let e={headers:new L.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((t,i)=>{this._httpClient.get(this.authService.apiUrl+"/sel/shipment/item-data",e).subscribe(e=>{this.price=e[0],this.unit=e[1],this.currency=e[2],this.country=e[3],this.user=e[4],this.commodity=e[5],this.packageType=e[6],this.onDataItemChanged.next(e),t(e)},i)})}writeDatabaseBooking(e,t){this.bookingCollection=this.db.collection("booking-draft"),this.bookingCollection.doc(e).set(t)}readDatabaseBooking(){return this.bookingCollection=this.db.collection("booking-draft"),this.booking=this.bookingCollection.snapshotChanges().pipe(Object(P.a)(e=>e.map(e=>{const t=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},t)}))),this.booking}readDatabaseBookingByUser(e){return this.bookingCollection=this.db.collection("booking-draft",t=>t.where("user","==",e)),this.booking=this.bookingCollection.snapshotChanges().pipe(Object(P.a)(e=>e.map(e=>{const t=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},t)}))),this.booking}getDatabaseBookingById(e){return this.bookingCollection=this.db.collection("booking-draft"),this.bookingCollection.doc(e).valueChanges()}updateDatabaseBookingById(e,t){this.bookingCollection=this.db.collection("booking-draft"),this.bookingCollection.doc(e).set(t)}deleteDatabaseBookingById(e){this.bookingDoc=this.db.doc("booking-draft/"+e),this.bookingDoc.delete()}readDatabaseRemark(){return this.remarkCollection=this.db.collection("vessel-remark"),this.remark=this.remarkCollection.snapshotChanges().pipe(Object(P.a)(e=>e.map(e=>{const t=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},t)}))),this.remark}updateDatabaseRemarkById(e,t){this.remarkCollection=this.db.collection("vessel-remark"),this.remarkCollection.doc(e).set(t)}deleteDatabaseRemarkById(e){this.remarkDoc=this.db.doc("vessel-remark/"+e),this.remarkDoc.delete()}updateBookingConfirm(e,t){let i=t.book,s=t.voyage,o=i.volume.map(e=>e.commodity.name);o=o.filter((e,t,i)=>i.indexOf(e)===t);let a,r,n=o.join(",");s.closing_time||(s.closing_time=s.depart_time-864e5),"HAIPHONG"==s.load_port_name||"DA NANG"==s.load_port_name?(a=null,r="CAP CONT NANG, SACH, TOT"):(a="DUY\u1ec6T L\u1ec6NH QUA EMAIL",r="Li\xean h\u1ec7 c\u1ea5p cont r\u1ed7ng qua mail dochcm@sel.vn v\xe0 support2@sel.vn, l\u1ea5y seal t\u1ea1i b\xe3i c\u1ea5p v\u1ecf container");let h={book_number:i.code,shipper:i.customer,agent:i.agent?i.agent:null,volume:i.volume,commodity:n,empty_pick_up_depot:i.empty_pick_up_depot?i.empty_pick_up_depot:null,place_of_stuffing:i.place_of_stuffing?i.place_of_stuffing:null,closing_time_vgm:i.closing_time_vgm?i.closing_time_vgm:null,return_laden_cont:s.load_terminal_name,clcv:i.clcv?i.clcv:a,note:i.note?i.note:r,contact_note:i.contact_note?i.contact_note:"HOCHIMINH"==s.pol?"Li\xean h\u1ec7 c\u1ea5p cont r\u1ed7ng qua mail dochcm@sel.vn v\xe0 support2@sel.vn, l\u1ea5y seal t\u1ea1i b\xe3i c\u1ea5p v\u1ecf container":"For picking-up container, handing over custom clearance sheet, pls contact with our branch as follows",voyage:{pol:s.load_port_name,pod:s.discharge_port_name,load_terminal:s.load_terminal_name,discharge_terminal:s.discharge_terminal_name,vessel:s.vessel_name.replace(s.name,"").trim(),voyage:s.name,closing_time:s.closing_time,etd:s.depart_time,eta:s.arrive_time},lcv_note:i.lcv_note?i.lcv_note:null,truck_name:i.truck_name?i.truck_name:null,truck_number:i.truck_number?i.truck_number:null,valid:i.valid?i.valid:null,valid_time:i.valid_time?i.valid_time:null,code_company:i.code_company?i.code_company:""};t.bookConfirm=h,this.updateDatabaseBookingById(e,t)}getPermissionById(e){let t={headers:new L.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,s)=>{this._httpClient.get(this.authService.apiUrl+"/permission/id/"+e,t).subscribe(e=>{this.onPermissionChanged.next(e),i(e)},s)})}createSelShipment(e){let t={headers:new L.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,s)=>{this._httpClient.post(this.authService.apiUrl+"/sel/book/shipment",e,t).subscribe(e=>{i(e)},s)})}getData(){if(this.filterBook=this.bookingfb.slice(),this.modul.includes("export-hochiminh")&&(this.filterBook=this.filterBook.filter(e=>"HOCHIMINH"==e.voyage.load_port_name)),this.modul.includes("export-haiphong")&&(this.filterBook=this.filterBook.filter(e=>"HAIPHONG"==e.voyage.load_port_name)),this.modul.includes("import-hochiminh")&&(this.filterBook=this.filterBook.filter(e=>"HOCHIMINH"==e.voyage.discharge_port_name)),this.modul.includes("import-haiphong")&&(this.filterBook=this.filterBook.filter(e=>"HAIPHONG"==e.voyage.discharge_port_name)),this.modul.includes("export-danang")&&(this.filterBook=this.filterBook.filter(e=>"DANANG"==e.voyage.load_port_name)),"all"!=this.filterData.valid){let e=(new Date).getTime();this.filterBook=this.filterBook.filter("1"==this.filterData.valid?t=>t.voyage.depart_time>=e:t=>t.voyage.depart_time<e)}if(this.filterData.code&&(this.filterBook=this.filterBook.filter(e=>e.book.code.toLowerCase().includes(this.filterData.code.toLowerCase()))),this.filterData.customer&&(this.filterBook=this.filterBook.filter(e=>e.book.customer.full_name.toLowerCase().includes(this.filterData.customer.toLowerCase()))),this.filterData.pol&&(this.filterBook=this.filterBook.filter(e=>e.voyage.load_port_name.toLowerCase().includes(this.filterData.pol.toLowerCase()))),this.filterData.pod&&(this.filterBook=this.filterBook.filter(e=>e.voyage.discharge_port_name.toLowerCase().includes(this.filterData.pod.toLowerCase()))),this.filterData.booking_number&&(this.filterBook=this.filterBook.filter(e=>e.book.code.toLowerCase().includes(this.filterData.booking_number.toLowerCase()))),this.filterData.vessel&&(this.filterBook=this.filterBook.filter(e=>(e.voyage.vessel_name+" "+e.voyage.name).toLowerCase().includes(this.filterData.vessel.toLowerCase()))),this.filterData.time_from){let e=new Date(this.filterData.time_from).getTime();this.filterBook=this.filterBook.filter(t=>new Date(t.voyage.depart_time).getTime()>=e)}if(this.filterData.time_to){let e=new Date(this.filterData.time_to).getTime();this.filterBook=this.filterBook.filter(t=>new Date(t.voyage.depart_time).getTime()<=e)}this.contType=[],this.total={};let e=["20DC","20FR","20RF","20TK","40DC","40FR","40HC","40HR","40OT","40RF"];this.filterBook.map(t=>{e.map(e=>{t.book[e]&&delete t.book[e]}),t.book.volume&&t.book.volume.map(e=>{this.contType.includes(e.cont_type.code)||(this.contType.push(e.cont_type.code),this.total[e.cont_type.code]=0),t.book[e.cont_type.code]||(t.book[e.cont_type.code]=0),this.total[e.cont_type.code]+=e.quantity,t.book[e.cont_type.code]+=e.quantity})}),this.contType.sort(),this.buildReport()}buildReport(){this.sptRouter=[],this.data={},this.voyage={},this.dataVessel={},this.total={},this.priceObj={},this.priceHeader=[];let e=[],t=[];this.filterBook.map(i=>{this.priceObj[i.id]={},i.bookConfirm.contArr&&0!=i.bookConfirm.contArr.length||(i.bookConfirm.contArr=[{container:null,type:null}]);let s=i.voyage.load_port_name+"-"+i.voyage.discharge_port_name;this.sptRouter.includes(s)?this.data[s].push(i):(this.sptRouter.push(s),this.data[s]=[i]),this.priceObj[i.id].revenueVNPrice||(this.priceObj[i.id].revenueVNPrice={}),this.priceObj[i.id].revenueNNPrice||(this.priceObj[i.id].revenueNNPrice={}),i.revenue.sell.map(s=>{e.includes(s.price.code+s.currency.code+s.payment_center.name)||(e.push(s.price.code+s.currency.code+s.payment_center.name),t.push({id:s.price.id,code:s.price.code,name:s.price.name,unit_code:s.price.unit_code,currency:s.currency.code,payment_center:s.payment_center.name})),"VIETNAM"==s.payment_center.name?this.priceObj[i.id].revenueVNPrice[s.price.code+s.currency.code+s.payment_center.name]=s.amount:this.priceObj[i.id].revenueNNPrice[s.price.code+s.currency.code+s.payment_center.name]=s.amount})}),this.buildPrice(t),this.sptRouter.map(e=>{this.voyage[e]=[],this.data[e].map(t=>{let i=t.voyage,s=i.depart_time+"-"+i.vessel_name+"-"+i.name;this.dataVessel[s]||(this.dataVessel[s]={voyage_name:i.name,vessel_name:i.vessel_name,pol_name:i.load_port_name,pod_name:i.discharge_port_name,depart_time:i.depart_time,arrive_time:i.arrive_time,closing_time:i.closing_time,shipment:[],container:0},this.voyage[e].push(s)),this.dataVessel[s].shipment.push(t),this.dataVessel[s].container+=t.bookConfirm.contArr.length-1,t.book.volume.map(e=>{this.dataVessel[s][e.cont_type.code]?this.dataVessel[s][e.cont_type.code]+=e.quantity:this.dataVessel[s][e.cont_type.code]=e.quantity,this.total[e.cont_type.code]?this.total[e.cont_type.code]+=e.quantity:this.total[e.cont_type.code]=e.quantity})})}),this.onVesselChanged.next([this.contType,this.sptRouter,this.data,this.voyage,this.dataVessel,this.total])}buildPrice(e){let t=e.filter(e=>"VIETNAM"==e.payment_center),i=e.filter(e=>"VIETNAM"!=e.payment_center),s=["OF","EBS","EFF","RR","BILL","LTHC","SEAL","DO","DTHC","DCIC","VS","AMS","ENS"];t.sort((e,t)=>{var i=e.unit_code,s=t.unit_code,o=e.currency,a=t.currency,r=e.code,n=t.code;return i>s?1:i<s?-1:o>a?1:o<a?-1:r>n?1:r<n?-1:0});let o,a,r=t.filter(e=>e.unit_code.includes("20")),n=t.filter(e=>e.unit_code.includes("40")),h=t.filter(e=>!e.unit_code.includes("20")&&!e.unit_code.includes("40")),c=[],l=[],p=[],d=[],u=[],m=[];s.map((e,t)=>{d[t]=r.filter(t=>t.code.includes(e)),d[t].length>0&&d[t].map(e=>{a=r.indexOf(e),a>=0&&(o=r.splice(a,1),c.push(o[0]))}),u[t]=n.filter(t=>t.code.includes(e)),u[t].length>0&&u[t].map(e=>{a=n.indexOf(e),a>=0&&(o=n.splice(a,1),l.push(o[0]))}),m[t]=h.filter(t=>t.code.includes(e)),m[t].length>0&&m[t].map(e=>{a=h.indexOf(e),a>=0&&(o=h.splice(a,1),p.push(o[0]))})}),i.sort((e,t)=>{var i=e.unit_code,s=t.unit_code,o=e.currency,a=t.currency,r=e.code,n=t.code;return i>s?1:i<s?-1:o>a?1:o<a?-1:r>n?1:r<n?-1:0});let b,g,v=i.filter(e=>e.unit_code.includes("20")),k=i.filter(e=>e.unit_code.includes("40")),f=i.filter(e=>!e.unit_code.includes("20")&&!e.unit_code.includes("40")),_=[],y=[],S=[],C=[],D=[],w=[];s.map((e,t)=>{C[t]=v.filter(t=>t.code.includes(e)),C[t].length>0&&C[t].map(e=>{g=v.indexOf(e),g>=0&&(b=v.splice(g,1),_.push(b[0]))}),D[t]=k.filter(t=>t.code.includes(e)),D[t].length>0&&D[t].map(e=>{g=k.indexOf(e),g>=0&&(b=k.splice(g,1),y.push(b[0]))}),w[t]=f.filter(t=>t.code.includes(e)),w[t].length>0&&w[t].map(e=>{g=f.indexOf(e),g>=0&&(b=f.splice(g,1),S.push(b[0]))})}),this.priceHeader=[...c,...r,...l,...n,...p,...h,..._,...v,...y,...k,...S,...f]}updateVoyageList(e){let t={headers:new L.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,s)=>{this._httpClient.put(this.authService.apiUrl+"/sel/book/voyage",e,t).subscribe(e=>{i(e)},s)})}}return e.\u0275fac=function(t){return new(t||e)(I.bc(s.g),I.bc(q.a),I.bc(E.a),I.bc(L.a))},e.\u0275prov=I.Nb({token:e,factory:e.\u0275fac}),e})();var F=i("B9zo"),G=i("ofXK"),W=i("fE3o"),U=i("IZxC"),z=i("Pg/h");function J(e,t){if(1&e){const e=I.Yb();I.Xb(0,"fuse-sidebar",8),I.Xb(1,"bookings-sidebar",9),I.fc("filterChanged",(function(t){return I.Bc(e),I.jc().filterChanged(t)})),I.Wb(),I.Wb()}if(2&e){const e=I.jc();I.Db(1),I.pc("modul",e.modul)("portPair",e.portPair)}}function Q(e,t){1&e&&I.Sb(0,"router-outlet")}let K=(()=>{class e{constructor(e,t,i,s){if(this._fuseSidebarService=e,this.shipmentService=t,this.router=i,this.authService=s,this.sidebarPanel=!0,this.time=Date.now(),this.contType=[],this.sptRouter=[],this.portPair=[],this.data={},this.voyage={},this.dataVessel={},this.total={},this._unsubscribeAll=new j.a,this.modul=this.authService.modul,this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}this.permission&&!this.permission.data?this.shipmentService.getPermissionById(this.permission.id).then(e=>{this.permission=e,this.shipmentService.readDatabaseBooking().subscribe(e=>{e.map(e=>{e.voyage.depart_time=new Date(e.voyage.depart_time).getTime()}),e.sort((e,t)=>e.voyage.depart_time<t.voyage.depart_time?1:t.voyage.depart_time<e.voyage.depart_time?-1:0);let t=e.filter(e=>this.permission.owner.includes(e.user)||(e.book.create_by?this.permission.owner.includes(e.book.create_by.id):null)||!!e.share&&e.share.map(e=>e.id).includes(this.authService.user));this.shipmentService.bookingfb=t,this.shipmentService.getData()})}):this.shipmentService.readDatabaseBooking().subscribe(e=>{e.map(e=>{e.voyage.depart_time=new Date(e.voyage.depart_time).getTime()}),e.sort((e,t)=>e.voyage.depart_time<t.voyage.depart_time?1:t.voyage.depart_time<e.voyage.depart_time?-1:0),this.shipmentService.bookingfb=e,this.shipmentService.getData()})}ngOnInit(){this.authService.urlChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{if(this.modul=this.authService.modul,this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}}),this.shipmentService.onVesselChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.contType=this.shipmentService.contType,this.sptRouter=this.shipmentService.sptRouter,this.portPair.length<this.sptRouter.length&&(this.portPair=this.sptRouter.slice()),this.data=this.shipmentService.data,this.voyage=this.shipmentService.voyage,this.dataVessel=this.shipmentService.dataVessel,this.total=this.shipmentService.total})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}toggleSidebar(e){this._fuseSidebarService.getSidebar(e).toggleOpen()}showHideBar(e){this.sidebarPanel=!this.sidebarPanel}refreshPage(e){this.authService.refreshData(this.shipmentService)}newContainer(e){this.router.navigate(["/apps/news/shipment-book/form/0"])}saveShipment(e){let t=e.id,i={code:e.book.code,customer:e.book.customer.id,agent:e.book.agent?e.book.agent.id:null,pol:e.book.pol.id,pod:e.book.pod.id,status:1,direct:0,owner:e.user,info:e,create_by:e.book.create_by?e.book.create_by.id:this.authService.user};this.authService.onRequestChanged.next(!0),this.shipmentService.createSelShipment(i).then(e=>{this.authService.onRequestChanged.next(!1),this.shipmentService.deleteDatabaseBookingById(t),e.createShipment&&this.router.navigate(["/apps/workflow/shipment/detail/"+e.createShipment.insertId+"/soa"])}).catch(e=>{this.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)})}copyBooking(e){if(confirm("Do you want to copy this booking?")){let t=JSON.parse(JSON.stringify(e));t.book.code+="(copy)",t.user=this.authService.user,t.share=null,delete t.id;let i=Date.now().toString();this.shipmentService.writeDatabaseBooking(i,t)}}deleteBookDraft(e){this.shipmentService.deleteDatabaseBookingById(e.id)}filterChanged(e){this.shipmentService.filterData=e,this.shipmentService.getData()}}return e.\u0275fac=function(t){return new(t||e)(I.Rb(N.a),I.Rb(X),I.Rb(s.g),I.Rb(E.a))},e.\u0275cmp=I.Lb({type:e,selectors:[["shipment-book"]],decls:8,vars:6,consts:[["id","shipment",1,"page-layout","carded","left-sidebar","inner-scroll"],["class","sidebar","name","bookings-sidebar","position","left","lockedOpen","gt-md",4,"ngIf"],["name","bookings-setting","position","right",1,"sidebar"],[1,"center","mr-0","ml-0"],[3,"modul","searchText","sidebarName","showHideBar","refreshPage","toggleSidebar"],[1,"content-card",2,"border","none","border-radius","0"],[1,"content"],[4,"ngIf"],["name","bookings-sidebar","position","left","lockedOpen","gt-md",1,"sidebar"],[3,"modul","portPair","filterChanged"]],template:function(e,t){1&e&&(I.Xb(0,"div",0),I.Jc(1,J,2,2,"fuse-sidebar",1),I.Sb(2,"fuse-sidebar",2),I.Xb(3,"div",3),I.Xb(4,"bookings-header",4),I.fc("showHideBar",(function(e){return t.showHideBar(e)}))("refreshPage",(function(e){return t.refreshPage(e)}))("toggleSidebar",(function(e){return t.toggleSidebar(e)})),I.Wb(),I.Xb(5,"div",5),I.Xb(6,"div",6),I.Jc(7,Q,1,0,"router-outlet",7),I.Wb(),I.Wb(),I.Wb(),I.Wb()),2&e&&(I.Db(1),I.pc("ngIf",t.sidebarPanel),I.Db(3),I.pc("modul",t.modul)("searchText",t.searchText)("sidebarName","bookings-sidebar")("modul",t.modul),I.Db(3),I.pc("ngIf",!0))},directives:[F.a,G.t,W.a,U.a,z.a,s.l],styles:["shipment-book{width:100%}shipment-book .center .header{height:64px!important;min-height:64px!important;max-height:64px!important}@media screen and (max-width:599px){shipment-book .center .header{height:56px!important;min-height:56px!important;max-height:56px!important}}shipment-book .center .content-card .toolbar .toolbar-separator{height:32px;width:1px;margin:0 12px}@media screen and (max-width:1919px){shipment-book .center .content-card shipment-book{border-right:0}shipment-book .center .content-card shipment-book,shipment-book .center .content-card shipment-details{-webkit-box-flex:1;flex:1 0 100%}shipment-book .center .content-card shipment-details{display:none!important}shipment-book .center .content-card.current-shipment-selected .toolbar{padding-left:16px!important}shipment-book .center .content-card.current-shipment-selected .content shipment-book,shipment-book .center .content-card.current-shipment-selected .toolbar .shipment-selection{display:none!important}shipment-book .center .content-card.current-shipment-selected .content shipment-details{display:-webkit-box!important;display:flex!important}}"],encapsulation:2,data:{animation:H.a}}),e})();var Y=i("qjGM");let Z=(()=>{class e{constructor(e,t,i,s,o){if(this.router=e,this.route=t,this._activatedRoute=i,this.authService=s,this.shipmentService=o,this.vessel=[],this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.selected=0,this.total={},this.priceHeader=[],this.priceObj={},this.height=560,this._unsubscribeAll=new j.a,this.modul=this.authService.modul,this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}}ngOnInit(){this.authService.urlChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{if(this.modul=this.authService.modul,this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}}),this.authService.windowSizeChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-64-16-4}),this.authService.changeScreen.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-64-16-4:this.authService.screenHeight-64-64-16-4}),this.shipmentService.onVesselChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.contType=this.shipmentService.contType,this.sptRouter=this.shipmentService.sptRouter,this.data=this.shipmentService.data,this.voyage=this.shipmentService.voyage,this.dataVessel=this.shipmentService.dataVessel,this.total=this.shipmentService.total,this.priceHeader=this.shipmentService.priceHeader,this.priceObj=this.shipmentService.priceObj})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}saveShipment(e){let t=e.id,i={code:e.book.code,customer:e.book.customer.id,agent:e.book.agent?e.book.agent.id:null,pol:e.book.pol.id,pod:e.book.pod.id,status:1,direct:0,owner:e.user,info:e,create_by:e.book.create_by?e.book.create_by.id:this.authService.user};this.authService.onRequestChanged.next(!0),this.shipmentService.createSelShipment(i).then(e=>{this.authService.onRequestChanged.next(!1),this.shipmentService.deleteDatabaseBookingById(t),e.createShipment&&this.router.navigate(["/apps/workflow/shipment/detail/"+e.createShipment.insertId+"/soa"])}).catch(e=>{this.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)})}copyBooking(e){if(confirm("Do you want to copy this booking?")){let t=JSON.parse(JSON.stringify(e));t.book.code+="(copy)",t.user=this.authService.user,t.share=null,delete t.id;let i=Date.now().toString();this.shipmentService.writeDatabaseBooking(i,t)}}deleteBookDraft(e){this.shipmentService.deleteDatabaseBookingById(e.id)}}return e.\u0275fac=function(t){return new(t||e)(I.Rb(s.g),I.Rb(s.a),I.Rb(s.a),I.Rb(E.a),I.Rb(X))},e.\u0275cmp=I.Lb({type:e,selectors:[["shipment-book-vessel"]],decls:1,vars:10,consts:[[3,"dataVessel","voyage","sptRouter","contType","height","permission","total","priceHeader","priceObj","modul","saveShipment","copyBooking","deleteBookDraft"]],template:function(e,t){1&e&&(I.Xb(0,"bookings-vessel",0),I.fc("saveShipment",(function(e){return t.saveShipment(e)}))("copyBooking",(function(e){return t.copyBooking(e)}))("deleteBookDraft",(function(e){return t.deleteBookDraft(e)})),I.Wb()),2&e&&I.pc("dataVessel",t.dataVessel)("voyage",t.voyage)("sptRouter",t.sptRouter)("contType",t.contType)("height",t.height)("permission",t.permission)("total",t.total)("priceHeader",t.priceHeader)("priceObj",t.priceObj)("modul",t.modul)},directives:[Y.a],styles:[""],encapsulation:2,data:{animation:H.a}}),e})();var $=i("5S3l");let ee=(()=>{class e{constructor(e,t,i,s,o){if(this.router=e,this.route=t,this._activatedRoute=i,this.authService=s,this.shipmentService=o,this.vessel=[],this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.selected=0,this.total={},this.priceHeader=[],this.priceObj={},this.height=560,this._unsubscribeAll=new j.a,this.modul=this.authService.modul,this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}}ngOnInit(){this.authService.urlChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{if(this.modul=this.authService.modul,this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}}),this.authService.windowSizeChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-64-16-4}),this.authService.changeScreen.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-64-16-4:this.authService.screenHeight-64-64-16-4}),this.shipmentService.onVesselChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.contType=this.shipmentService.contType,this.sptRouter=this.shipmentService.sptRouter,this.data=this.shipmentService.data,this.voyage=this.shipmentService.voyage,this.dataVessel=this.shipmentService.dataVessel,this.total=this.shipmentService.total})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}}return e.\u0275fac=function(t){return new(t||e)(I.Rb(s.g),I.Rb(s.a),I.Rb(s.a),I.Rb(E.a),I.Rb(X))},e.\u0275cmp=I.Lb({type:e,selectors:[["shipment-book-table"]],decls:1,vars:11,consts:[[3,"data","dataVessel","voyage","sptRouter","contType","height","permission","total","priceHeader","priceObj","modul"]],template:function(e,t){1&e&&I.Sb(0,"bookings-table",0),2&e&&I.pc("data",t.data)("dataVessel",t.dataVessel)("voyage",t.voyage)("sptRouter",t.sptRouter)("contType",t.contType)("height",t.height)("permission",t.permission)("total",t.total)("priceHeader",t.priceHeader)("priceObj",t.priceObj)("modul",t.modul)},directives:[$.a],styles:[""],encapsulation:2,data:{animation:H.a}}),e})();var te=i("t0+f"),ie=i("wFrn"),se=i("xmvJ");let oe=(()=>{class e{constructor(e,t,i,s,o){if(this.router=e,this.route=t,this.authService=i,this.shipmentService=s,this._matDialog=o,this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.selected=0,this.total={},this.priceHeader=[],this.priceObj={},this.revenueVNOpen=!1,this.revenueNNOpen=!1,this.height=560,this.time=(new Date).getTime(),this.remarkVessel={},this._unsubscribeAll=new j.a,this.modul=this.authService.modul,this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}this.shipmentService.readDatabaseRemark().subscribe(e=>{this.remarkVessel={},e.map(e=>{this.remarkVessel[e.id]=e.remark})})}ngOnInit(){this.authService.urlChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{if(this.modul=this.authService.modul,this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}}),this.authService.windowSizeChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-64-16-4}),this.authService.changeScreen.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-64-16-4:this.authService.screenHeight-64-64-16-4}),this.shipmentService.onDataChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.vessel=e[0],this.supplier=e[1],this.user=e[2],this.country=e[3],this.seaport=e[4],this.seaTerminal=e[5]}),this.shipmentService.onVesselChanged.pipe(Object(x.a)(this._unsubscribeAll)).subscribe(e=>{this.contType=this.shipmentService.contType,this.sptRouter=this.shipmentService.sptRouter,this.data=this.shipmentService.data,this.voyage=this.shipmentService.voyage,this.dataVessel=this.shipmentService.dataVessel,this.total=this.shipmentService.total,this.priceHeader=this.shipmentService.priceHeader,this.priceObj=this.shipmentService.priceObj})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}openModal(e){this.dialogRef=this._matDialog.open(te.a,{panelClass:"bookings-modal-dialog",data:{label:"Add/Remove container",data:e.bookConfirm}}),this.dialogRef.afterClosed().subscribe(t=>{t&&(e.bookConfirm.contArr=t.contArr?t.contArr:[],this.shipmentService.updateDatabaseBookingById(e.id,e))})}editRemark([e,t]){this.dialogRef=this._matDialog.open(ie.a,{panelClass:"bookings-vessel-modal-dialog",data:{label:"Edit Remark",data:t||null}}),this.dialogRef.afterClosed().subscribe(t=>{if(!t)return;let i=e.id;t.name=e.vessel_name+" "+e.name,!t.remark&&this.remarkVessel[i]?this.shipmentService.deleteDatabaseRemarkById(i.toString()):this.shipmentService.updateDatabaseRemarkById(i.toString(),t)})}openVessel([e,t]){this.dialogRef=this._matDialog.open(ie.a,{panelClass:"bookings-vessel-modal-dialog",data:{label:"Edit Voyage",data:e,vessel:this.vessel,supplier:this.supplier,user:this.user,country:this.country,seaport:this.seaport,seaTerminal:this.seaTerminal}}),this.dialogRef.afterClosed().subscribe(e=>{e&&(this.authService.onRequestChanged.next(!0),this.shipmentService.updateVoyageList(e).then(e=>{this.authService.onRequestChanged.next(!1),e.data?this.updateDataBook(e.data,t):alert("Error voyage"),console.log(e)}).catch(e=>{this.authService.onRequestChanged.next(!1),console.error(e),alert("Error edit voyage")}))})}updateDataBook(e,t){this.dataVessel[t].shipment.map(t=>{t.voyage=e,t.bookConfirm.voyage={pol:e.load_port_name,pod:e.discharge_port_name,load_terminal:e.load_terminal_name,discharge_terminal:e.discharge_terminal_name,vessel:e.vessel_name.replace(e.name,"").trim(),voyage:e.name,closing_time:e.closing_time,etd:e.depart_time,eta:e.arrive_time},t.return_laden_cont=e.load_terminal_name,this.shipmentService.updateDatabaseBookingById(t.id,t)})}}return e.\u0275fac=function(t){return new(t||e)(I.Rb(s.g),I.Rb(s.a),I.Rb(E.a),I.Rb(X),I.Rb(v.b))},e.\u0275cmp=I.Lb({type:e,selectors:[["shipment-book-container"]],decls:1,vars:11,consts:[[3,"dataVessel","voyage","sptRouter","contType","height","permission","total","priceHeader","priceObj","modul","remarkVessel","openModal","editRemark","openVessel"]],template:function(e,t){1&e&&(I.Xb(0,"bookings-container",0),I.fc("openModal",(function(e){return t.openModal(e)}))("editRemark",(function(e){return t.editRemark(e)}))("openVessel",(function(e){return t.openVessel(e)})),I.Wb()),2&e&&I.pc("dataVessel",t.dataVessel)("voyage",t.voyage)("sptRouter",t.sptRouter)("contType",t.contType)("height",t.height)("permission",t.permission)("total",t.total)("priceHeader",t.priceHeader)("priceObj",t.priceObj)("modul",t.modul)("remarkVessel",t.remarkVessel)},directives:[se.a],styles:[""],encapsulation:2,data:{animation:H.a}}),e})();var ae=i("vxfF"),re=i("cfqv"),ne=i("T3U3"),he=i("h3iT"),ce=i("eKfw"),le=i("fUQu"),pe=i("Mrpe"),de=i("FDnR"),ue=i("X00z");i.d(t,"ShipmentBookModule",(function(){return be}));const me=[{path:"",component:K,resolve:{data:X},children:[{path:"vessel",component:Z},{path:"container",component:oe},{path:"table",component:ee}]}];let be=(()=>{class e{}return e.\u0275mod=I.Pb({type:e}),e.\u0275inj=I.Ob({factory:function(t){return new(t||e)},providers:[X],imports:[[s.k.forChild(me),a.b,o.a,r.b,n.c,h.c,c.b,l.e,p.b,d.b,u.c,m.c,b.b,g.c,v.e,k.b,f.b,_.b,y.d,S.e,C.b,D.b,B.b,R.k,O.c,w.t,T.a,A.a,V.f,ae.g,re.b,ne.a,he.a,ce.a,le.a,pe.a,de.a,ue.a]]}),e})()}}]);