(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{zLd6:function(e,t,i){"use strict";i.r(t);var s=i("tyNb"),o=i("5HBU"),a=i("STbY"),n=i("/1cH"),r=i("iadO"),c=i("bTqV"),h=i("7EHt"),l=i("kmnG"),p=i("NFeN"),d=i("Qu3c"),u=i("qFsG"),m=i("wZkO"),b=i("d3UM"),g=i("QibW"),v=i("0IaG"),k=i("/t3+"),y=i("bSwM"),_=i("M9IT"),f=i("xHqg"),S=i("A5z7"),D=i("bv9b"),C=i("XhcP"),w=i("FKr1"),R=i("1jcm"),B=i("+0xr"),O=i("Dh3D"),T=i("IOBc"),V=i("212X"),x=i("LPQX"),j=i("XNiG"),A=i("1G5W"),I=i("PVWW"),H=i("fXoL"),P=i("HX77"),N=i("lJxs"),L=i("2Vo4"),q=i("tk/3"),E=i("I/3d"),X=i("qXBG");let F=(()=>{class e{constructor(e,t,i,s){this.router=e,this.db=t,this.authService=i,this._httpClient=s,this.modul="pacific-logistics-network",this.codeCompany=["DCL","SEG","SEL","SIN","SLO","TWN","REF: "],this.filterData={valid:"1"},this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.total={},this.priceHeader=[],this.priceObj={},this.onPermissionChanged=new L.a([]),this.onSelDocumentChanged=new L.a([]),this.onVesselChanged=new L.a([]),this.onDataChanged=new L.a([]),this.onDataItemChanged=new L.a([]),this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2])}resolve(e){return this.authService.routerData=e,new Promise((e,t)=>{Promise.all([this.getDataVoyage()]).then(([])=>{e()},t)})}getDataVoyage(){let e={headers:new q.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((t,i)=>{this._httpClient.get(this.authService.apiUrl+"/pln/voyage/data",e).subscribe(e=>{this.vessel=e[0],this.partner=e[1],this.users=e[2],this.country=e[3],this.seaport=e[4],this.seaTerminal=e[5],this.supplier=e[6],this.selVessel=e[7],this.onDataChanged.next(e),t(e)},i)})}getItemData(){let e={headers:new q.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((t,i)=>{this._httpClient.get(this.authService.apiUrl+"/pln/shipment/item-data",e).subscribe(e=>{this.price=e[0],this.unit=e[1],this.currency=e[2],this.country=e[3],this.users=e[4],this.commodity=e[5],this.packageType=e[6],this.onDataItemChanged.next(e),t(e)},i)})}writeDatabaseBooking(e,t){this.bookingCollection=this.db.collection("pln-booking-draft"),this.bookingCollection.doc(e).set(t)}readDatabaseBooking(){return this.bookingCollection=this.db.collection("pln-booking-draft"),this.booking=this.bookingCollection.snapshotChanges().pipe(Object(N.a)(e=>e.map(e=>{const t=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},t)}))),this.booking}readDatabaseBookingByUser(e){return this.bookingCollection=this.db.collection("pln-booking-draft",t=>t.where("user","==",e)),this.booking=this.bookingCollection.snapshotChanges().pipe(Object(N.a)(e=>e.map(e=>{const t=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},t)}))),this.booking}getDatabaseBookingById(e){return this.bookingCollection=this.db.collection("pln-booking-draft"),this.bookingCollection.doc(e).valueChanges()}updateDatabaseBookingById(e,t){this.bookingCollection=this.db.collection("pln-booking-draft"),this.bookingCollection.doc(e).set(t)}deleteDatabaseBookingById(e){this.bookingDoc=this.db.doc("pln-booking-draft/"+e),this.bookingDoc.delete()}readDatabaseRemark(){return this.remarkCollection=this.db.collection("pln-vessel-remark"),this.remark=this.remarkCollection.snapshotChanges().pipe(Object(N.a)(e=>e.map(e=>{const t=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},t)}))),this.remark}updateDatabaseRemarkById(e,t){this.remarkCollection=this.db.collection("pln-vessel-remark"),this.remarkCollection.doc(e).set(t)}deleteDatabaseRemarkById(e){this.remarkDoc=this.db.doc("pln-vessel-remark/"+e),this.remarkDoc.delete()}updateBookingConfirm(e,t){let i=t.book,s=t.voyage,o=i.volume.map(e=>e.commodity.name);o=o.filter((e,t,i)=>i.indexOf(e)===t);let a,n,r,c=o.join(",");s.closing_time||(s.closing_time=s.depart_time-864e5),a=null,n="All containers in clean, sound and cargo worthy condition",r="Vui l\xf2ng li\xean h\u1ec7 c\u1ea5p cont r\u1ed7ng qua mail legend@pln.vn v\xe0 com@pln.vn, l\u1ea5y seal t\u1ea1i b\xe3i c\u1ea5p v\u1ecf container";let h="";i.volume.map(e=>{h+=this.calculateTotal(e.cont_type.code,i.volume)+"x"+e.cont_type.code+" "}),s.closing_time||(s.closing_time=s.depart_time-864e5),t.bookConfirm={book_number:i.code,shipper:i.customer,agent:i.agent,volume:i.volume,commodity:c,empty_pick_up_depot:i.empty_pick_up_depot?i.empty_pick_up_depot:null,place_of_stuffing:i.place_of_stuffing?i.place_of_stuffing:null,closing_time_vgm:i.closing_time_vgm?i.closing_time_vgm:null,return_laden_cont:s.load_terminal_name,clcv:i.clcv?i.clcv:null,note:i.note?i.note:"All containers in clean, sound and cargo worthy condition",contact_note:i.contact_note?i.contact_note:"Vui l\xf2ng li\xean h\u1ec7 c\u1ea5p cont r\u1ed7ng qua mail legend@pln.vn v\xe0 com@pln.vn, l\u1ea5y seal t\u1ea1i b\xe3i c\u1ea5p v\u1ecf container",pol:i.pol,pot:i.pot?i.pot.name:null,pod:i.pod,voyage:{pol:s.load_port_name,pod:s.discharge_port_name,load_terminal:s.load_terminal_name,discharge_terminal:s.discharge_terminal_name,vessel:s.vessel_name,voyage:s.name,closing_time:s.closing_time,etd:s.depart_time,eta:s.arrive_time},lcv_note:i.lcv_note?i.lcv_note:null,lcv_volume:h,truck_name:i.truck_name?i.truck_name:null,truck_number:i.truck_number?i.truck_number:null,valid:i.valid?i.valid:null,valid_time:i.valid_time?i.valid_time:null,code_company:i.code_company?i.code_company:""},this.updateDatabaseBookingById(e,t)}getPermissionById(e){let t={headers:new q.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,s)=>{this._httpClient.get(this.authService.apiUrl+"/permission/id/"+e,t).subscribe(e=>{this.onPermissionChanged.next(e),i(e)},s)})}createSelShipment(e){let t={headers:new q.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,s)=>{this._httpClient.post(this.authService.apiUrl+"/pln/book/shipment",e,t).subscribe(e=>{i(e)},s)})}getData(){if(this.filterBook=this.bookingfb.slice(),"all"!=this.filterData.valid){let e=(new Date).getTime();this.filterBook=this.filterBook.filter("1"==this.filterData.valid?t=>t.voyage.depart_time>=e:t=>t.voyage.depart_time<e)}if(this.filterData.code&&(this.filterBook=this.filterBook.filter(e=>e.book.code.toLowerCase().includes(this.filterData.code.toLowerCase()))),this.filterData.customer&&(this.filterBook=this.filterBook.filter(e=>e.book.customer.full_name.toLowerCase().includes(this.filterData.customer.toLowerCase()))),this.filterData.pol&&(this.filterBook=this.filterBook.filter(e=>e.voyage.load_port_name.toLowerCase().includes(this.filterData.pol.toLowerCase()))),this.filterData.pod&&(this.filterBook=this.filterBook.filter(e=>e.voyage.discharge_port_name.toLowerCase().includes(this.filterData.pod.toLowerCase()))),this.filterData.booking_number&&(this.filterBook=this.filterBook.filter(e=>e.book.code.toLowerCase().includes(this.filterData.booking_number.toLowerCase()))),this.filterData.vessel&&(this.filterBook=this.filterBook.filter(e=>(e.voyage.vessel_name+" "+e.voyage.name).toLowerCase().includes(this.filterData.vessel.toLowerCase()))),this.filterData.time_from){let e=new Date(this.filterData.time_from).getTime();this.filterBook=this.filterBook.filter(t=>new Date(t.voyage.depart_time).getTime()>=e)}if(this.filterData.time_to){let e=new Date(this.filterData.time_to).getTime();this.filterBook=this.filterBook.filter(t=>new Date(t.voyage.depart_time).getTime()<=e)}console.log(this.filterBook),this.contType=[],this.total={};let e=["20DC","20FR","20RF","20TK","40DC","40FR","40HC","40HR","40OT","40RF"];this.filterBook.map(t=>{e.map(e=>{t.book[e]&&delete t.book[e]}),t.book.volume&&t.book.volume.map(e=>{this.contType.includes(e.cont_type.code)||(this.contType.push(e.cont_type.code),this.total[e.cont_type.code]=0),t.book[e.cont_type.code]||(t.book[e.cont_type.code]=0),this.total[e.cont_type.code]+=e.quantity,t.book[e.cont_type.code]+=e.quantity})}),this.contType.sort(),this.buildReport()}buildReport(){this.sptRouter=[],this.data={},this.voyage={},this.dataVessel={},this.total={},this.priceObj={},this.priceHeader=[];let e=[],t=[];this.filterBook.map(i=>{this.priceObj[i.id]={},i.bookConfirm.contArr&&0!=i.bookConfirm.contArr.length||(i.bookConfirm.contArr=[{container:null,type:null}]);let s=i.voyage.load_port_name+"-"+i.voyage.discharge_port_name;this.sptRouter.includes(s)?this.data[s].push(i):(this.sptRouter.push(s),this.data[s]=[i]),this.priceObj[i.id].revenueVNPrice||(this.priceObj[i.id].revenueVNPrice={}),this.priceObj[i.id].revenueNNPrice||(this.priceObj[i.id].revenueNNPrice={}),i.revenue.sell.map(s=>{e.includes(s.price.code+s.currency.code+s.payment_center.name)||(e.push(s.price.code+s.currency.code+s.payment_center.name),t.push({id:s.price.id,code:s.price.code,name:s.price.name,unit_code:s.price.unit_code,currency:s.currency.code,payment_center:s.payment_center.name})),"VIETNAM"==s.payment_center.name?this.priceObj[i.id].revenueVNPrice[s.price.code+s.currency.code+s.payment_center.name]=s.amount:this.priceObj[i.id].revenueNNPrice[s.price.code+s.currency.code+s.payment_center.name]=s.amount})}),this.buildPrice(t),this.sptRouter.map(e=>{this.voyage[e]=[],this.data[e].map(t=>{let i=t.voyage,s=i.depart_time+"-"+i.vessel_name+"-"+i.name;this.dataVessel[s]||(this.dataVessel[s]={voyage_name:i.name,vessel_name:i.vessel_name,pol_name:i.load_port_name,pod_name:i.discharge_port_name,depart_time:i.depart_time,arrive_time:i.arrive_time,closing_time:i.closing_time,shipment:[],container:0},this.voyage[e].push(s)),this.dataVessel[s].shipment.push(t),this.dataVessel[s].container+=t.bookConfirm.contArr.length-1,t.book.volume.map(e=>{this.dataVessel[s][e.cont_type.code]?this.dataVessel[s][e.cont_type.code]+=e.quantity:this.dataVessel[s][e.cont_type.code]=e.quantity,this.total[e.cont_type.code]?this.total[e.cont_type.code]+=e.quantity:this.total[e.cont_type.code]=e.quantity})})}),this.onVesselChanged.next([this.contType,this.sptRouter,this.data,this.voyage,this.dataVessel,this.total])}buildPrice(e){let t=e.filter(e=>"VIETNAM"==e.payment_center),i=e.filter(e=>"VIETNAM"!=e.payment_center),s=["OF","EBS","EFF","RR","BILL","LTHC","SEAL","DO","DTHC","DCIC","VS","AMS","ENS"];t.sort((e,t)=>{var i=e.unit_code,s=t.unit_code,o=e.currency,a=t.currency,n=e.code,r=t.code;return i>s?1:i<s?-1:o>a?1:o<a?-1:n>r?1:n<r?-1:0});let o,a,n=t.filter(e=>e.unit_code.includes("20")),r=t.filter(e=>e.unit_code.includes("40")),c=t.filter(e=>!e.unit_code.includes("20")&&!e.unit_code.includes("40")),h=[],l=[],p=[],d=[],u=[],m=[];s.map((e,t)=>{d[t]=n.filter(t=>t.code.includes(e)),d[t].length>0&&d[t].map(e=>{a=n.indexOf(e),a>=0&&(o=n.splice(a,1),h.push(o[0]))}),u[t]=r.filter(t=>t.code.includes(e)),u[t].length>0&&u[t].map(e=>{a=r.indexOf(e),a>=0&&(o=r.splice(a,1),l.push(o[0]))}),m[t]=c.filter(t=>t.code.includes(e)),m[t].length>0&&m[t].map(e=>{a=c.indexOf(e),a>=0&&(o=c.splice(a,1),p.push(o[0]))})}),i.sort((e,t)=>{var i=e.unit_code,s=t.unit_code,o=e.currency,a=t.currency,n=e.code,r=t.code;return i>s?1:i<s?-1:o>a?1:o<a?-1:n>r?1:n<r?-1:0});let b,g,v=i.filter(e=>e.unit_code.includes("20")),k=i.filter(e=>e.unit_code.includes("40")),y=i.filter(e=>!e.unit_code.includes("20")&&!e.unit_code.includes("40")),_=[],f=[],S=[],D=[],C=[],w=[];s.map((e,t)=>{D[t]=v.filter(t=>t.code.includes(e)),D[t].length>0&&D[t].map(e=>{g=v.indexOf(e),g>=0&&(b=v.splice(g,1),_.push(b[0]))}),C[t]=k.filter(t=>t.code.includes(e)),C[t].length>0&&C[t].map(e=>{g=k.indexOf(e),g>=0&&(b=k.splice(g,1),f.push(b[0]))}),w[t]=y.filter(t=>t.code.includes(e)),w[t].length>0&&w[t].map(e=>{g=y.indexOf(e),g>=0&&(b=y.splice(g,1),S.push(b[0]))})}),this.priceHeader=[...h,...n,...l,...r,...p,...c,..._,...v,...f,...k,...S,...y]}updateVoyageList(e){let t={headers:new q.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,s)=>{this._httpClient.put(this.authService.apiUrl+"/sel/book/voyage",e,t).subscribe(e=>{i(e)},s)})}calculateTotal(e,t){let i=0;return t.map(t=>{t.cont_type.code==e&&(i+=t.quantity)}),i}}return e.\u0275fac=function(t){return new(t||e)(H.bc(s.g),H.bc(E.a),H.bc(X.a),H.bc(q.a))},e.\u0275prov=H.Nb({token:e,factory:e.\u0275fac}),e})();var M=i("B9zo"),W=i("ofXK"),z=i("fE3o"),J=i("IZxC"),U=i("Pg/h");function G(e,t){if(1&e){const e=H.Yb();H.Xb(0,"fuse-sidebar",8),H.Xb(1,"bookings-sidebar",9),H.fc("filterChanged",(function(t){return H.Bc(e),H.jc().filterChanged(t)})),H.Wb(),H.Wb()}if(2&e){const e=H.jc();H.Db(1),H.pc("modul",e.modul)("portPair",e.portPair)}}function K(e,t){1&e&&H.Sb(0,"router-outlet")}let Q=(()=>{class e{constructor(e,t,i,s){this._fuseSidebarService=e,this.shipmentService=t,this.router=i,this.authService=s,this.modul="pacific-logistics-network",this.sidebarPanel=!0,this.time=Date.now(),this.contType=[],this.sptRouter=[],this.portPair=[],this.data={},this.voyage={},this.dataVessel={},this.total={},this._unsubscribeAll=new j.a,this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2]),this.permission&&!this.permission.data?this.shipmentService.getPermissionById(this.permission.id).then(e=>{this.permission=e,this.shipmentService.readDatabaseBooking().subscribe(e=>{e.map(e=>{e.voyage.depart_time=new Date(e.voyage.depart_time).getTime()}),e.sort((e,t)=>e.voyage.depart_time<t.voyage.depart_time?1:t.voyage.depart_time<e.voyage.depart_time?-1:0);let t=e.filter(e=>this.permission.owner.includes(e.user)||(e.book.create_by?this.permission.owner.includes(e.book.create_by.id):null)||!!e.share&&e.share.map(e=>e.id).includes(this.authService.user));this.shipmentService.bookingfb=t,this.shipmentService.getData()})}):this.shipmentService.readDatabaseBooking().subscribe(e=>{console.log(e),e.map(e=>{e.voyage.depart_time=new Date(e.voyage.depart_time).getTime()}),e.sort((e,t)=>e.voyage.depart_time<t.voyage.depart_time?1:t.voyage.depart_time<e.voyage.depart_time?-1:0),this.shipmentService.bookingfb=e,this.shipmentService.getData()})}ngOnInit(){this.modul=this.shipmentService.modul,this.shipmentService.onVesselChanged.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.contType=this.shipmentService.contType,this.sptRouter=this.shipmentService.sptRouter,this.portPair.length<this.sptRouter.length&&(this.portPair=this.sptRouter.slice()),this.data=this.shipmentService.data,this.voyage=this.shipmentService.voyage,this.dataVessel=this.shipmentService.dataVessel,this.total=this.shipmentService.total})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}toggleSidebar(e){this._fuseSidebarService.getSidebar(e).toggleOpen()}showHideBar(e){this.sidebarPanel=!this.sidebarPanel}refreshPage(e){this.authService.refreshData(this.shipmentService)}newContainer(e){this.router.navigate(["/apps/news/shipment-book/form/0"])}saveShipment(e){let t=e.id,i={code:e.book.code,customer:e.book.customer.id,agent:e.book.agent?e.book.agent.id:null,pol:e.book.pol.id,pod:e.book.pod.id,status:1,direct:0,owner:e.user,info:e,create_by:e.book.create_by?e.book.create_by.id:this.authService.user};this.authService.onRequestChanged.next(!0),this.shipmentService.createSelShipment(i).then(e=>{this.authService.onRequestChanged.next(!1),this.shipmentService.deleteDatabaseBookingById(t),e.createShipment&&this.router.navigate(["/apps/pacific-logistics-network/shipment/detail/"+e.createShipment.insertId+"/soa"])}).catch(e=>{this.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)})}copyBooking(e){if(confirm("Do you want to copy this booking?")){let t=JSON.parse(JSON.stringify(e));t.book.code+="(copy)",t.user=this.authService.user,t.share=null,delete t.id;let i=Date.now().toString();this.shipmentService.writeDatabaseBooking(i,t)}}deleteBookDraft(e){this.shipmentService.deleteDatabaseBookingById(e.id)}filterChanged(e){this.shipmentService.filterData=e,this.shipmentService.getData()}}return e.\u0275fac=function(t){return new(t||e)(H.Rb(P.a),H.Rb(F),H.Rb(s.g),H.Rb(X.a))},e.\u0275cmp=H.Lb({type:e,selectors:[["shipment-book"]],decls:8,vars:6,consts:[["id","shipment",1,"page-layout","carded","left-sidebar","inner-scroll"],["class","sidebar","name","bookings-sidebar","position","left","lockedOpen","gt-md",4,"ngIf"],["name","bookings-setting","position","right",1,"sidebar"],[1,"center","mr-0","ml-0"],[3,"modul","searchText","sidebarName","showHideBar","refreshPage","toggleSidebar"],[1,"content-card",2,"border","none","border-radius","0"],[1,"content"],[4,"ngIf"],["name","bookings-sidebar","position","left","lockedOpen","gt-md",1,"sidebar"],[3,"modul","portPair","filterChanged"]],template:function(e,t){1&e&&(H.Xb(0,"div",0),H.Jc(1,G,2,2,"fuse-sidebar",1),H.Sb(2,"fuse-sidebar",2),H.Xb(3,"div",3),H.Xb(4,"bookings-header",4),H.fc("showHideBar",(function(e){return t.showHideBar(e)}))("refreshPage",(function(e){return t.refreshPage(e)}))("toggleSidebar",(function(e){return t.toggleSidebar(e)})),H.Wb(),H.Xb(5,"div",5),H.Xb(6,"div",6),H.Jc(7,K,1,0,"router-outlet",7),H.Wb(),H.Wb(),H.Wb(),H.Wb()),2&e&&(H.Db(1),H.pc("ngIf",t.sidebarPanel),H.Db(3),H.pc("modul",t.modul)("searchText",t.searchText)("sidebarName","bookings-sidebar")("modul",t.modul),H.Db(3),H.pc("ngIf",!0))},directives:[M.a,W.t,z.a,J.a,U.a,s.l],styles:["shipment-book{width:100%}shipment-book .center .header{height:64px!important;min-height:64px!important;max-height:64px!important}@media screen and (max-width:599px){shipment-book .center .header{height:56px!important;min-height:56px!important;max-height:56px!important}}shipment-book .center .content-card .toolbar .toolbar-separator{height:32px;width:1px;margin:0 12px}@media screen and (max-width:1919px){shipment-book .center .content-card shipment-book{border-right:0}shipment-book .center .content-card shipment-book,shipment-book .center .content-card shipment-details{-webkit-box-flex:1;flex:1 0 100%}shipment-book .center .content-card shipment-details{display:none!important}shipment-book .center .content-card.current-shipment-selected .toolbar{padding-left:16px!important}shipment-book .center .content-card.current-shipment-selected .content shipment-book,shipment-book .center .content-card.current-shipment-selected .toolbar .shipment-selection{display:none!important}shipment-book .center .content-card.current-shipment-selected .content shipment-details{display:-webkit-box!important;display:flex!important}}"],encapsulation:2,data:{animation:I.a}}),e})();var Y=i("qjGM");let Z=(()=>{class e{constructor(e,t,i,s,o){this.router=e,this.route=t,this._activatedRoute=i,this.authService=s,this.shipmentService=o,this.modul="pacific-logistics-network",this.vessel=[],this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.selected=0,this.total={},this.priceHeader=[],this.priceObj={},this.height=560,this._unsubscribeAll=new j.a,this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2])}ngOnInit(){this.modul=this.shipmentService.modul,this.authService.windowSizeChanged.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-64-16-4}),this.authService.changeScreen.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-64-16-4:this.authService.screenHeight-64-64-16-4}),this.shipmentService.onVesselChanged.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.contType=this.shipmentService.contType,this.sptRouter=this.shipmentService.sptRouter,this.data=this.shipmentService.data,this.voyage=this.shipmentService.voyage,this.dataVessel=this.shipmentService.dataVessel,this.total=this.shipmentService.total,this.priceHeader=this.shipmentService.priceHeader,this.priceObj=this.shipmentService.priceObj})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}saveShipment(e){let t=e.id,i={code:e.book.code,customer:e.book.customer.id,agent:e.book.agent?e.book.agent.id:null,pol:e.book.pol.id,pod:e.book.pod.id,status:1,direct:0,owner:e.user,info:e,create_by:e.book.create_by?e.book.create_by.id:this.authService.user};this.authService.onRequestChanged.next(!0),this.shipmentService.createSelShipment(i).then(e=>{this.authService.onRequestChanged.next(!1),this.shipmentService.deleteDatabaseBookingById(t),e.createShipment&&this.router.navigate(["/apps/pacific-logistics-network/shipment/detail/"+e.createShipment.insertId+"/soa"])}).catch(e=>{this.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)})}copyBooking(e){if(confirm("Do you want to copy this booking?")){let t=JSON.parse(JSON.stringify(e));t.book.code+="(copy)",t.user=this.authService.user,t.share=null,delete t.id;let i=Date.now().toString();this.shipmentService.writeDatabaseBooking(i,t)}}deleteBookDraft(e){this.shipmentService.deleteDatabaseBookingById(e.id)}}return e.\u0275fac=function(t){return new(t||e)(H.Rb(s.g),H.Rb(s.a),H.Rb(s.a),H.Rb(X.a),H.Rb(F))},e.\u0275cmp=H.Lb({type:e,selectors:[["shipment-book-vessel"]],decls:1,vars:10,consts:[[3,"dataVessel","voyage","sptRouter","contType","height","permission","total","priceHeader","priceObj","modul","saveShipment","copyBooking","deleteBookDraft"]],template:function(e,t){1&e&&(H.Xb(0,"bookings-vessel",0),H.fc("saveShipment",(function(e){return t.saveShipment(e)}))("copyBooking",(function(e){return t.copyBooking(e)}))("deleteBookDraft",(function(e){return t.deleteBookDraft(e)})),H.Wb()),2&e&&H.pc("dataVessel",t.dataVessel)("voyage",t.voyage)("sptRouter",t.sptRouter)("contType",t.contType)("height",t.height)("permission",t.permission)("total",t.total)("priceHeader",t.priceHeader)("priceObj",t.priceObj)("modul",t.modul)},directives:[Y.a],styles:[""],encapsulation:2,data:{animation:I.a}}),e})();var $=i("5S3l");let ee=(()=>{class e{constructor(e,t,i,s,o){this.router=e,this.route=t,this._activatedRoute=i,this.authService=s,this.shipmentService=o,this.modul="pacific-logistics-network",this.vessel=[],this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.selected=0,this.total={},this.priceHeader=[],this.priceObj={},this.height=560,this._unsubscribeAll=new j.a,this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2])}ngOnInit(){this.modul=this.shipmentService.modul,this.authService.windowSizeChanged.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-64-16-4}),this.authService.changeScreen.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-64-16-4:this.authService.screenHeight-64-64-16-4}),this.shipmentService.onVesselChanged.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.contType=this.shipmentService.contType,this.sptRouter=this.shipmentService.sptRouter,this.data=this.shipmentService.data,this.voyage=this.shipmentService.voyage,this.dataVessel=this.shipmentService.dataVessel,this.total=this.shipmentService.total})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}}return e.\u0275fac=function(t){return new(t||e)(H.Rb(s.g),H.Rb(s.a),H.Rb(s.a),H.Rb(X.a),H.Rb(F))},e.\u0275cmp=H.Lb({type:e,selectors:[["shipment-book-table"]],decls:1,vars:11,consts:[[3,"data","dataVessel","voyage","sptRouter","contType","height","permission","total","priceHeader","priceObj","modul"]],template:function(e,t){1&e&&H.Sb(0,"bookings-table",0),2&e&&H.pc("data",t.data)("dataVessel",t.dataVessel)("voyage",t.voyage)("sptRouter",t.sptRouter)("contType",t.contType)("height",t.height)("permission",t.permission)("total",t.total)("priceHeader",t.priceHeader)("priceObj",t.priceObj)("modul",t.modul)},directives:[$.a],styles:[""],encapsulation:2,data:{animation:I.a}}),e})();var te=i("t0+f"),ie=i("wFrn"),se=i("xmvJ");let oe=(()=>{class e{constructor(e,t,i,s,o){this.router=e,this.route=t,this.authService=i,this.shipmentService=s,this._matDialog=o,this.modul="pacific-logistics-network",this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.selected=0,this.total={},this.priceHeader=[],this.priceObj={},this.revenueVNOpen=!1,this.revenueNNOpen=!1,this.height=560,this.time=(new Date).getTime(),this.remarkVessel={},this._unsubscribeAll=new j.a,this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2]),this.shipmentService.readDatabaseRemark().subscribe(e=>{this.remarkVessel={},console.log(e),e.map(e=>{this.remarkVessel[e.id]=e.remark})})}ngOnInit(){this.modul=this.shipmentService.modul,this.authService.windowSizeChanged.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-64-16-4}),this.authService.changeScreen.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-64-16-4:this.authService.screenHeight-64-64-16-4}),this.shipmentService.onDataChanged.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.vessel=e[0],this.supplier=e[1],this.user=e[2],this.country=e[3],this.seaport=e[4],this.seaTerminal=e[5]}),this.shipmentService.onVesselChanged.pipe(Object(A.a)(this._unsubscribeAll)).subscribe(e=>{this.contType=this.shipmentService.contType,this.sptRouter=this.shipmentService.sptRouter,this.data=this.shipmentService.data,this.voyage=this.shipmentService.voyage,this.dataVessel=this.shipmentService.dataVessel,this.total=this.shipmentService.total,this.priceHeader=this.shipmentService.priceHeader,this.priceObj=this.shipmentService.priceObj})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}openModal(e){this.dialogRef=this._matDialog.open(te.a,{panelClass:"bookings-modal-dialog",data:{label:"Add/Remove container",data:e.bookConfirm}}),this.dialogRef.afterClosed().subscribe(t=>{t&&(e.bookConfirm.contArr=t.contArr?t.contArr:[],this.shipmentService.updateDatabaseBookingById(e.id,e))})}editRemark([e,t]){this.dialogRef=this._matDialog.open(ie.a,{panelClass:"bookings-vessel-modal-dialog",data:{label:"Edit Remark",data:t||null}}),this.dialogRef.afterClosed().subscribe(t=>{if(!t)return;let i=e.id;t.name=e.vessel_name+" "+e.name,!t.remark&&this.remarkVessel[i]?this.shipmentService.deleteDatabaseRemarkById(i.toString()):this.shipmentService.updateDatabaseRemarkById(i.toString(),t)})}openVessel([e,t]){this.dialogRef=this._matDialog.open(ie.a,{panelClass:"bookings-vessel-modal-dialog",data:{label:"Edit Voyage",data:e,vessel:this.vessel,supplier:this.supplier,user:this.user,country:this.country,seaport:this.seaport,seaTerminal:this.seaTerminal}}),this.dialogRef.afterClosed().subscribe(e=>{e&&(this.authService.onRequestChanged.next(!0),this.shipmentService.updateVoyageList(e).then(e=>{this.authService.onRequestChanged.next(!1),e.data?this.updateDataBook(e.data,t):alert("Error voyage"),console.log(e)}).catch(e=>{this.authService.onRequestChanged.next(!1),console.error(e),alert("Error edit voyage")}))})}updateDataBook(e,t){this.dataVessel[t].shipment.map(t=>{t.voyage=e,t.bookConfirm.voyage={pol:e.load_port_name,pod:e.discharge_port_name,load_terminal:e.load_terminal_name,discharge_terminal:e.discharge_terminal_name,vessel:e.vessel_name.replace(e.name,"").trim(),voyage:e.name,closing_time:e.closing_time,etd:e.depart_time,eta:e.arrive_time},t.return_laden_cont=e.load_terminal_name,this.shipmentService.updateDatabaseBookingById(t.id,t)})}}return e.\u0275fac=function(t){return new(t||e)(H.Rb(s.g),H.Rb(s.a),H.Rb(X.a),H.Rb(F),H.Rb(v.b))},e.\u0275cmp=H.Lb({type:e,selectors:[["shipment-book-container"]],decls:1,vars:11,consts:[[3,"dataVessel","voyage","sptRouter","contType","height","permission","total","priceHeader","priceObj","modul","remarkVessel","openModal","editRemark","openVessel"]],template:function(e,t){1&e&&(H.Xb(0,"bookings-container",0),H.fc("openModal",(function(e){return t.openModal(e)}))("editRemark",(function(e){return t.editRemark(e)}))("openVessel",(function(e){return t.openVessel(e)})),H.Wb()),2&e&&H.pc("dataVessel",t.dataVessel)("voyage",t.voyage)("sptRouter",t.sptRouter)("contType",t.contType)("height",t.height)("permission",t.permission)("total",t.total)("priceHeader",t.priceHeader)("priceObj",t.priceObj)("modul",t.modul)("remarkVessel",t.remarkVessel)},directives:[se.a],styles:[""],encapsulation:2,data:{animation:I.a}}),e})();var ae=i("vxfF"),ne=i("cfqv"),re=i("T3U3"),ce=i("h3iT"),he=i("eKfw"),le=i("fUQu"),pe=i("Mrpe"),de=i("FDnR"),ue=i("X00z");i.d(t,"ShipmentBookModule",(function(){return be}));const me=[{path:"",component:Q,resolve:{data:F},children:[{path:"vessel",component:Z},{path:"container",component:oe},{path:"table",component:ee}]}];let be=(()=>{class e{}return e.\u0275mod=H.Pb({type:e}),e.\u0275inj=H.Ob({factory:function(t){return new(t||e)},providers:[F],imports:[[s.k.forChild(me),a.b,o.a,n.b,r.c,c.c,h.b,l.e,p.b,d.b,u.c,m.c,b.b,g.c,v.e,k.b,y.b,_.b,f.d,S.e,D.b,C.b,R.b,B.k,O.c,w.t,T.a,V.a,x.f,ae.g,ne.b,re.a,ce.a,he.a,le.a,pe.a,de.a,ue.a]]}),e})()}}]);