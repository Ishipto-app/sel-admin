function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{"2AaX":function(e,t,n){"use strict";n.r(t);var i,a=n("tyNb"),r=n("5HBU"),o=n("STbY"),c=n("/1cH"),s=n("iadO"),u=n("bTqV"),b=n("7EHt"),l=n("kmnG"),p=n("NFeN"),m=n("Qu3c"),h=n("qFsG"),d=n("wZkO"),f=n("d3UM"),g=n("QibW"),v=n("0IaG"),x=n("/t3+"),k=n("bSwM"),y=n("M9IT"),q=n("xHqg"),w=n("A5z7"),X=n("bv9b"),W=n("XhcP"),S=n("FKr1"),D=n("1jcm"),_=n("+0xr"),C=n("212X"),P=n("LPQX"),L=n("2Vo4"),I=n("tk/3"),O=n("fXoL"),A=n("qXBG"),F=((i=function(){function e(t,n){_classCallCheck(this,e),this._httpClient=t,this.authService=n,this.onDataChanged=new L.a([]),this.onQuoteChanged=new L.a({})}return _createClass(e,[{key:"resolve",value:function(e){var t=this;this.authService.routerData=e;var n=e.params.id;return new Promise((function(e,i){Promise.all([t.getDetailsDnlQuote(n),t.getData()]).then((function(){e()}),i)}))}},{key:"getDetailsDnlQuote",value:function(e){var t=this,n={headers:new I.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(i,a){t._httpClient.get(t.authService.apiUrl+"/dnl/quote/id/"+e,n).subscribe((function(e){t.quote=e[0],t.quoteDetails=[1],t.quoteCostDetails=[2],t.onQuoteChanged.next(e),i(e)}),a)}))}},{key:"getData",value:function(){var e=this,t={headers:new I.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(n,i){e._httpClient.get(e.authService.apiUrl+"/dnl/shipment/data",t).subscribe((function(t){e.partner=t[0],e.truckPoint=t[1],e.user=t[2],e.price=t[3],e.currency=t[4],e.country=t[5],e.unit=t[6],e.scope=t[7],e.ipoint=t[8],e.agent=e.partner.filter((function(e){return"A"==e.scope_type})),e.onDataChanged.next(t),n(t)}),i)}))}},{key:"createDnlShipmentQuote",value:function(e){var t=this,n={headers:new I.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(i,a){t._httpClient.post(t.authService.apiUrl+"/dnl/quote/shipment",e,n).subscribe((function(e){i(e)}),a)}))}}]),e}()).\u0275fac=function(e){return new(e||i)(O.bc(I.a),O.bc(A.a))},i.\u0275prov=O.Nb({token:i,factory:i.\u0275fac}),i),R=n("yrbL"),M=n("XNiG"),N=n("HX77"),j=n("ofXK"),z=n("B9zo"),J=n("EwFO"),T=n("0JVi"),H=n("XiUz"),B=n("znSr");function E(e,t){if(1&e){var n=O.Yb();O.Xb(0,"button",10),O.fc("click",(function(e){O.Bc(n);var t=O.jc();return e.stopPropagation(),t.changeScreen(!0)})),O.Xb(1,"mat-icon"),O.Lc(2,"flip_to_front"),O.Wb(),O.Wb()}}function Q(e,t){if(1&e){var n=O.Yb();O.Xb(0,"button",10),O.fc("click",(function(e){O.Bc(n);var t=O.jc();return e.stopPropagation(),t.changeScreen(!1)})),O.Xb(1,"mat-icon"),O.Lc(2,"flip_to_back"),O.Wb(),O.Wb()}}var U,V=((U=function(){function e(t,n){_classCallCheck(this,e),this.authService=t,this._fuseConfigService=n,this.collapsed=!0,this.fullScreen=!1,this.toggleSidebar=new O.o,this.showHideBar=new O.o,this.refreshPage=new O.o,this._unsubscribeAll=new M.a}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"changeScreen",value:function(e){this.fullScreen=e,this.authService.changeScreen.next(e),this._fuseConfigService.config=this.fullScreen?{layout:{navbar:{hidden:!0},toolbar:{hidden:!0},footer:{hidden:!0},sidepanel:{hidden:!0}}}:{layout:{navbar:{hidden:!1},toolbar:{hidden:!1},footer:{hidden:!0},sidepanel:{hidden:!0}}}}},{key:"collapse",value:function(){this.collapsed=!0}},{key:"expand",value:function(){this.collapsed=!1}}]),e}()).\u0275fac=function(e){return new(e||U)(O.Rb(A.a),O.Rb(T.b))},U.\u0275cmp=O.Lb({type:U,selectors:[["shipment-quote-header"]],inputs:{sidebarName:"sidebarName"},outputs:{toggleSidebar:"toggleSidebar",showHideBar:"showHideBar",refreshPage:"refreshPage"},decls:15,vars:2,consts:[[1,"p-0","mat-elevation-z1"],["fxFlex","","fxFill","","fxLayout","row","fxLayoutAlign","start center"],["fxFlex","1 0 auto","fxLayout","row","fxLayoutAlign","start center"],[1,"px-8","px-md-16"],["mat-icon-button","","color","accent","fxHide.gt-sm","","fxFlex","10","fxFlex.gt-sm","0",1,"sidebar-toggle","mr-12",3,"click"],["mat-icon-button","","fxHide","","fxShow.gt-sm","","fxFlex","10","fxFlex.gt-sm","0",1,"sidebar-toggle","mr-12",3,"click"],["fxFlex","0 1 auto","fxLayout","row","fxLayoutAlign","start center",1,""],[1,"toolbar-separator"],["mat-icon-button","","class","ml-8",3,"click",4,"ngIf"],["fxHide","","fxShow.gt-xs","",1,"toolbar-separator"],["mat-icon-button","",1,"ml-8",3,"click"]],template:function(e,t){1&e&&(O.Xb(0,"mat-toolbar",0),O.Xb(1,"div",1),O.Xb(2,"div",2),O.Xb(3,"div",3),O.Xb(4,"button",4),O.fc("click",(function(e){return t.toggleSidebar.emit(t.sidebarName)})),O.Xb(5,"mat-icon"),O.Lc(6,"save"),O.Wb(),O.Wb(),O.Xb(7,"button",5),O.fc("click",(function(e){return t.showHideBar.emit()})),O.Xb(8,"mat-icon"),O.Lc(9,"menu"),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Xb(10,"div",6),O.Sb(11,"div",7),O.Jc(12,E,3,0,"button",8),O.Jc(13,Q,3,0,"button",8),O.Sb(14,"div",9),O.Wb(),O.Wb(),O.Wb()),2&e&&(O.Db(12),O.pc("ngIf",!t.fullScreen),O.Db(1),O.pc("ngIf",t.fullScreen))},directives:[x.a,H.b,H.e,H.d,H.c,u.b,B.b,p.a,j.t],styles:["shipment-quote-header{position:relative;display:-webkit-box;display:flex;-webkit-box-flex:0;flex:0 0 auto;z-index:4}shipment-quote-header.below{z-index:2}shipment-quote-header .mat-toolbar{position:relative;background:#fff!important;color:inherit!important}shipment-quote-header .logo{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}shipment-quote-header .logo .logo-icon{width:38px}shipment-quote-header .chat-panel-toggle-button,shipment-quote-header .language-button,shipment-quote-header .quick-panel-toggle-button,shipment-quote-header .user-button,shipment-quote-header fuse-search-bar{min-width:64px;height:64px}@media screen and (max-width:599px){shipment-quote-header .chat-panel-toggle-button,shipment-quote-header .language-button,shipment-quote-header .quick-panel-toggle-button,shipment-quote-header .user-button,shipment-quote-header fuse-search-bar{height:56px}}shipment-quote-header .navbar-toggle-button{min-width:56px;height:56px}shipment-quote-header .toolbar-separator{height:64px;width:1px;background:#e6e6e6}@media screen and (max-width:599px){shipment-quote-header .toolbar-separator{height:56px}}shipment-quote-header #shipment-detail-search-bar{display:-webkit-box;display:flex;-webkit-box-flex:0;flex:0 1 auto;min-width:64px;height:64px;font-size:13px}@media screen and (max-width:599px){shipment-quote-header #shipment-detail-search-bar{height:56px}}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content{display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 1 auto;-webkit-box-align:center;align-items:center;-webkit-box-pack:start;justify-content:flex-start}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-collapser,shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-expander{cursor:pointer;padding:0 20px;margin:0;width:64px!important;height:64px!important;line-height:64px!important}@media screen and (max-width:599px){shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-collapser,shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-expander{height:56px!important;line-height:56px!important}}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-loader{width:64px!important;height:64px!important;line-height:64px!important}@media screen and (max-width:599px){shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-loader{height:56px!important;line-height:56px!important}}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-collapser{display:none}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content #shipment-detail-search-bar-input{display:none;-webkit-box-flex:1;flex:1 0 auto;min-height:64px;font-size:16px;background-color:transparent;color:currentColor}shipment-quote-header #shipment-detail-search-bar.expanded{position:absolute;top:0;right:0;bottom:0;left:0;z-index:10;background:#f5f5f5}shipment-quote-header #shipment-detail-search-bar.expanded .shipment-detail-search-bar-content #shipment-detail-search-bar-input{display:-webkit-box;display:flex}shipment-quote-header #shipment-detail-search-bar.expanded .shipment-detail-search-bar-content .shipment-detail-search-bar-collapser{display:block}"],encapsulation:2}),U),G=n("PVWW"),$=n("0Zc1");function Y(e,t){if(1&e&&(O.Xb(0,"tr"),O.Xb(1,"td"),O.Lc(2),O.Wb(),O.Xb(3,"td"),O.Lc(4),O.Wb(),O.Xb(5,"td"),O.Lc(6),O.Wb(),O.Xb(7,"td"),O.Lc(8),O.Wb(),O.Xb(9,"td"),O.Lc(10),O.kc(11,"number"),O.Wb(),O.Xb(12,"td"),O.Lc(13),O.kc(14,"number"),O.Wb(),O.Xb(15,"td"),O.Lc(16),O.Wb(),O.Xb(17,"td"),O.Lc(18),O.Wb(),O.Xb(19,"td",5),O.Xb(20,"a"),O.Lc(21),O.Wb(),O.Wb(),O.Xb(22,"td"),O.Lc(23),O.Wb(),O.Sb(24,"td",6),O.Wb()),2&e){var n=t.$implicit,i=t.index;O.Db(2),O.Mc(i+1),O.Db(2),O.Mc(n.price_name),O.Db(2),O.Mc(n.unit_code),O.Db(2),O.Mc(n.volume),O.Db(2),O.Mc(O.mc(11,12,n.amount,"1.0-0")),O.Db(3),O.Mc(O.mc(14,15,n.tax,"1.2-2")),O.Db(3),O.Mc(n.currency_code),O.Db(2),O.Mc(n.country_name),O.Db(1),O.pc("matTooltip",n.info)("matTooltipPosition","left"),O.Db(2),O.Mc(n.info?"view":""),O.Db(2),O.Mc(n.partner_short_name)}}function K(e,t){if(1&e&&(O.Xb(0,"tr"),O.Sb(1,"td"),O.Sb(2,"td"),O.Sb(3,"td"),O.Xb(4,"td"),O.Lc(5,"Total"),O.Wb(),O.Xb(6,"td"),O.Lc(7),O.kc(8,"number"),O.Wb(),O.Xb(9,"td"),O.Lc(10),O.kc(11,"number"),O.Wb(),O.Xb(12,"td"),O.Lc(13),O.kc(14,"number"),O.Wb(),O.Xb(15,"td"),O.Lc(16),O.Wb(),O.Sb(17,"td"),O.Sb(18,"td"),O.Sb(19,"td",6),O.Wb()),2&e){var n=t.$implicit;O.Db(7),O.Mc(O.mc(8,4,n.amount,"1.2-2")),O.Db(3),O.Mc(O.mc(11,7,n.tax,"1.2-2")),O.Db(3),O.Mc(O.mc(14,10,n.total,"1.2-2")),O.Db(3),O.Mc(n.currency)}}function Z(e,t){if(1&e&&(O.Xb(0,"div",1),O.Xb(1,"h2"),O.Lc(2),O.Wb(),O.Xb(3,"div",2),O.Xb(4,"table",3),O.Xb(5,"thead"),O.Xb(6,"tr"),O.Xb(7,"th"),O.Lc(8,"No"),O.Wb(),O.Xb(9,"th"),O.Lc(10,"Price"),O.Wb(),O.Xb(11,"th"),O.Lc(12,"Unit"),O.Wb(),O.Xb(13,"th"),O.Lc(14,"Volume"),O.Wb(),O.Xb(15,"th"),O.Lc(16,"Amount"),O.Wb(),O.Xb(17,"th"),O.Lc(18,"Tax(%)"),O.Wb(),O.Xb(19,"th"),O.Lc(20,"Currency"),O.Wb(),O.Xb(21,"th"),O.Lc(22,"Payment center"),O.Wb(),O.Xb(23,"th"),O.Lc(24,"Info"),O.Wb(),O.Xb(25,"th"),O.Lc(26),O.Wb(),O.Sb(27,"th"),O.Wb(),O.Wb(),O.Xb(28,"tbody"),O.Jc(29,Y,25,18,"tr",4),O.Wb(),O.Xb(30,"tfoot"),O.Jc(31,K,20,13,"tr",4),O.Wb(),O.Wb(),O.Wb(),O.Wb()),2&e){var n=O.jc();O.Db(2),O.Mc(n.label),O.Db(1),O.Ic("max-height",n.height,"px"),O.Db(23),O.Nc("","Revenue"==n.label?"Pay":"Issue"," partner"),O.Db(3),O.pc("ngForOf",n.data),O.Db(2),O.pc("ngForOf",n.sum)}}var ee,te,ne=((te=function(){function e(t,n){_classCallCheck(this,e),this.router=t,this.authService=n,this.deleteItem=new O.o,this.totalCurrency=[],this.height=480,this.total={tax:0,amount:0},this._unsubscribeAll=new M.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;console.log(this.data),this.total={tax:0,amount:0},this.totalCurrency=[],this.data.map((function(t){var n=e.totalCurrency.find((function(e){return e.code==t.currency_code}));n?(n.amount+=t.volume*t.amount,n.tax+=t.volume*t.tax_amount):e.totalCurrency.push({code:t.currency_code,amount:t.volume*t.amount,tax:t.volume*t.tax_amount}),e.total.tax+=t.volume*t.tax_amount*t.ex_rate,e.total.amount+=t.volume*t.amount*t.ex_rate}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}}]),e}()).\u0275fac=function(e){return new(e||te)(O.Rb(a.g),O.Rb(A.a))},te.\u0275cmp=O.Lb({type:te,selectors:[["shipment-quote-content-table"]],inputs:{data:"data",sum:"sum",label:"label"},outputs:{deleteItem:"deleteItem"},decls:1,vars:1,consts:[["class","group mb-12 mt-12",4,"ngIf"],[1,"group","mb-12","mt-12"],[2,"overflow","auto"],[1,"simple","quote-details-table"],[4,"ngFor","ngForOf"],[3,"matTooltip","matTooltipPosition"],[1,"text-right"]],template:function(e,t){1&e&&O.Jc(0,Z,32,6,"div",0),2&e&&O.pc("ngIf",t.data&&t.data.length>0)},directives:[j.t,j.s,m.a],pipes:[j.g],styles:["shipment-quote-content-table .group{margin-left:0;margin-right:0;display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 0 auto;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;position:relative;border-radius:2px;padding:16px 0 8px;border:1px solid #000}shipment-quote-content-table .group h2{position:absolute;top:-8px;left:8px;margin:0;padding:0 8px;font-size:12px;font-weight:700;background:#fafafa}shipment-quote-content-table .group .quote-details-table{font-size:12px}shipment-quote-content-table .group .quote-details-table td,shipment-quote-content-table .group .quote-details-table th{padding:8px;font-size:12px}shipment-quote-content-table .group .quote-details-table tfoot td{font-weight:600}shipment-quote-content-table .group .quote-details-table .sticky-left-col1{position:sticky;min-width:36px;position:-webkit-sticky;left:0;background-color:#fff;z-index:10}shipment-quote-content-table .group .quote-details-table .sticky-left-col2{position:sticky;position:-webkit-sticky;left:36px;background-color:#fff;z-index:20}shipment-quote-content-table .group .quote-details-table .sticky-right-col{min-width:40px;position:sticky;position:-webkit-sticky;right:0;background-color:#b3e5fc}shipment-quote-content-table .group .quote-details-table tfoot td.sticky-row2{position:sticky;position:-webkit-sticky;bottom:0;background:#fff;z-index:25;font-weight:bolder}shipment-quote-content-table .group .quote-details-table tfoot td.sticky-row1{position:sticky;position:-webkit-sticky;bottom:32px;background:#fff;z-index:25}"],encapsulation:2,data:{animation:G.a}}),te),ie=((ee=function(){function e(t,n){_classCallCheck(this,e),this.authService=t,this.commonService=n,this.deleteItem=new O.o}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||ee)(O.Rb(A.a),O.Rb($.a))},ee.\u0275cmp=O.Lb({type:ee,selectors:[["shipment-quote-content"]],inputs:{quote:"quote",sumRevenue:"sumRevenue",sumCost:"sumCost"},outputs:{deleteItem:"deleteItem"},decls:3,vars:6,consts:[["id","print-content"],[3,"data","label","sum","deleteItem"]],template:function(e,t){1&e&&(O.Xb(0,"div",0),O.Xb(1,"shipment-quote-content-table",1),O.fc("deleteItem",(function(e){return t.deleteItem.emit(e)})),O.Wb(),O.Xb(2,"shipment-quote-content-table",1),O.fc("deleteItem",(function(e){return t.deleteItem.emit(e)})),O.Wb(),O.Wb()),2&e&&(O.Db(1),O.pc("data",t.quote.quote)("label","Revenue")("sum",t.sumRevenue),O.Db(1),O.pc("data",t.quote.quote_cost)("label","Cost")("sum",t.sumCost))},directives:[ne],styles:["shipment-quote-content{background:#fff}shipment-quote-content #print-content{overflow:auto}@media print{shipment-quote-content #print-content{height:auto!important}}"],encapsulation:2,data:{animation:G.a}}),ee),ae=n("fE3o"),re=n("1G5W"),oe=n("3Pt+"),ce=n("JX91"),se=n("lJxs"),ue=["formDirective"];function be(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," code is required "),O.Wb())}function le(e,t){if(1&e&&(O.Xb(0,"mat-option",34),O.Lc(1),O.Wb()),2&e){var n=t.$implicit;O.pc("value",n.id),O.Db(1),O.Nc(" ",n.short_name," ")}}function pe(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," Partner is required "),O.Wb())}function me(e,t){if(1&e&&(O.Xb(0,"mat-option",34),O.Lc(1),O.Wb()),2&e){var n=t.$implicit;O.pc("value",n.id),O.Db(1),O.Nc(" ",n.name," ")}}function he(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," pick_up is required "),O.Wb())}function de(e,t){if(1&e&&(O.Xb(0,"mat-option",34),O.Lc(1),O.Wb()),2&e){var n=t.$implicit;O.pc("value",n.id),O.Db(1),O.Nc(" ",n.name," ")}}function fe(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," deliver is required "),O.Wb())}function ge(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1,"Manage date is required!"),O.Wb())}function ve(e,t){if(1&e&&(O.Xb(0,"mat-option",34),O.Lc(1),O.Wb()),2&e){var n=t.$implicit;O.pc("value",n.id),O.Db(1),O.Mc(n.name)}}function xe(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," Status is required "),O.Wb())}function ke(e,t){if(1&e&&(O.Xb(0,"mat-option",34),O.Lc(1),O.Wb()),2&e){var n=t.$implicit;O.pc("value",n.id),O.Db(1),O.Mc(n.name)}}function ye(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," Owner is required "),O.Wb())}var qe,we=((qe=function(){function e(t,n,i){_classCallCheck(this,e),this.formBuilder=t,this.authService=n,this.commonService=i,this.createShipment=new O.o,this.form=this.formBuilder.group({code:[null,oe.y.required],hbl:[null],mbl:[null],partner:[null,oe.y.required],pick_up:[null,oe.y.required],pick_date:[null],deliver:[null,oe.y.required],deliver_date:[null],manage_date:[null,oe.y.required],status:[null,oe.y.required],owner:[null,oe.y.required],info:[null]}),this.status=[{id:0,name:"Invalid"},{id:1,name:"Booking"},{id:2,name:"Pick up"},{id:3,name:"Deliver"},{id:4,name:"Complete"},{id:5,name:"Done"},{id:10,name:"Lock"}],this.now=new Date,this.height=560,this._unsubscribeAll=new M.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.form.patchValue(this.quote),this.minDate=new Date(this.quote.quote_from),this.maxDate=new Date(this.quote.quote_to),this.form.controls.code.setValue(null),this.form.controls.status.setValue(1),this.authService.windowSizeChanged.pipe(Object(re.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t.height-64-64-18})),this.authService.changeScreen.pipe(Object(re.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t?e.authService.screenHeight-64-18:e.authService.screenHeight-64-64-18})),this.filteredPartner=this.form.controls.partner.valueChanges.pipe(Object(ce.a)(""),Object(se.a)((function(e){return e?"string"==typeof e?e:e.partner_name:null})),Object(se.a)((function(t){return t?e.commonService.filterData(t,"short_name",e.partner):[]}))),this.filteredTruckPoint1=this.form.controls.pick_up.valueChanges.pipe(Object(ce.a)(""),Object(se.a)((function(e){return e?"string"==typeof e?e:e.name:null})),Object(se.a)((function(t){return t?e.commonService.filterData(t,"name",e.truckPoint):[]}))),this.filteredTruckPoint2=this.form.controls.deliver.valueChanges.pipe(Object(ce.a)(""),Object(se.a)((function(e){return e?"string"==typeof e?e:e.name:null})),Object(se.a)((function(t){return t?e.commonService.filterData(t,"name",e.truckPoint):[]}))),this.form.controls.code.valueChanges.subscribe((function(t){e.form.controls.hbl.setValue(t)}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"setCheck",value:function(e){e.check=!e.check}},{key:"resetForm",value:function(){this.searchNgForm.resetForm()}},{key:"onFormSubmit",value:function(e){e.valid&&this.createShipment.emit(e.value)}}]),e}()).\u0275fac=function(e){return new(e||qe)(O.Rb(oe.d),O.Rb(A.a),O.Rb($.a))},qe.\u0275cmp=O.Lb({type:qe,selectors:[["shipment-quote-sidebar"]],viewQuery:function(e,t){var n;1&e&&O.Sc(ue,!0),2&e&&O.wc(n=O.gc())&&(t.searchNgForm=n.first)},inputs:{quote:"quote",user:"user",partner:"partner",truckPoint:"truckPoint",permission:"permission"},outputs:{createShipment:"createShipment"},decls:100,vars:35,consts:[["name","form",2,"border-right","1px solid #E6E6E6",3,"formGroup","keydown.enter","ngSubmit"],["formDirective","ngForm"],[1,"navbar-top"],["fxLayout","row","fxLayoutAlign","space-between center"],["mat-raised-button","","type","submit","fxFlex","45",1,"ml-8","mr-8",2,"border","1px solid #039BE5","border-radius","8px","color","#696969"],["fusePerfectScrollbar","",1,"navbar-scroll-container"],[1,"navbar-content"],[1,"nav","material2"],["fxLayout","row wrap"],["fxFlex","100",1,"info-line","mt-24"],["appearance","outline",1,"w-100-p","pr-sm-8"],["inputCheck","","aria-label","code","matInput","","formControlName","code","required",""],[4,"ngIf"],["fxFlex","100",1,"info-line"],["inputCheck","","matInput","","formControlName","hbl"],["inputCheck","","matInput","","formControlName","mbl"],["inputCheck","","aria-label","partner","matInput","","formControlName","partner","required","",3,"matAutocomplete"],[3,"displayWith"],["autoPartner","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["inputCheck","","aria-label","pick_up","matInput","","formControlName","pick_up","required","",3,"matAutocomplete"],["autoTruckPoint1","matAutocomplete"],["inputCheck","","matInput","","name","pick_date","formControlName","pick_date",3,"matDatepicker","min","max","change"],["matSuffix","",3,"for"],["pick_date",""],["inputCheck","","aria-label","deliver","matInput","","formControlName","deliver","required","",3,"matAutocomplete"],["autoTruckPoint2","matAutocomplete"],["inputCheck","","matInput","","name","deliver_date","formControlName","deliver_date",3,"matDatepicker","change"],["deliver_date",""],["inputCheck","","matInput","","name","manage_date","formControlName","manage_date","required","",3,"matDatepicker","change"],["manage_date",""],["formControlName","status","required",""],["formControlName","owner","required",""],["inputCheck","","matInput","","formControlName","info"],[3,"value"]],template:function(e,t){if(1&e&&(O.Xb(0,"form",0,1),O.fc("keydown.enter",(function(e){return"TEXTAREA"==e.target.tagName}))("ngSubmit",(function(e){return t.onFormSubmit(t.form)})),O.Xb(2,"div",2),O.Xb(3,"div",3),O.Xb(4,"button",4),O.Lc(5," Submit "),O.Wb(),O.Wb(),O.Wb(),O.Xb(6,"div",5),O.Xb(7,"div",6),O.Xb(8,"div",7),O.Xb(9,"div",8),O.Xb(10,"div",9),O.Xb(11,"mat-form-field",10),O.Xb(12,"mat-label"),O.Lc(13,"Code"),O.Wb(),O.Sb(14,"input",11),O.Jc(15,be,2,0,"mat-error",12),O.Wb(),O.Wb(),O.Xb(16,"div",13),O.Xb(17,"mat-form-field",10),O.Xb(18,"mat-label"),O.Lc(19,"HBL"),O.Wb(),O.Sb(20,"input",14),O.Wb(),O.Wb(),O.Xb(21,"div",13),O.Xb(22,"mat-form-field",10),O.Xb(23,"mat-label"),O.Lc(24,"MBL"),O.Wb(),O.Sb(25,"input",15),O.Wb(),O.Wb(),O.Xb(26,"div",13),O.Xb(27,"mat-form-field",10),O.Xb(28,"mat-label"),O.Lc(29,"Partner"),O.Wb(),O.Sb(30,"input",16),O.Xb(31,"mat-autocomplete",17,18),O.Jc(33,le,2,2,"mat-option",19),O.kc(34,"async"),O.Wb(),O.Jc(35,pe,2,0,"mat-error",12),O.Wb(),O.Wb(),O.Xb(36,"div",13),O.Xb(37,"mat-form-field",10),O.Xb(38,"mat-label"),O.Lc(39,"Pick up"),O.Wb(),O.Sb(40,"input",20),O.Xb(41,"mat-autocomplete",17,21),O.Jc(43,me,2,2,"mat-option",19),O.kc(44,"async"),O.Wb(),O.Jc(45,he,2,0,"mat-error",12),O.Wb(),O.Wb(),O.Xb(46,"div",13),O.Xb(47,"mat-form-field",10),O.Xb(48,"mat-label"),O.Lc(49,"Pick Date"),O.Wb(),O.Xb(50,"input",22),O.fc("change",(function(e){return t.commonService.setDateStr(e)})),O.Wb(),O.Sb(51,"mat-datepicker-toggle",23),O.Sb(52,"mat-datepicker",null,24),O.Wb(),O.Wb(),O.Xb(54,"div",13),O.Xb(55,"mat-form-field",10),O.Xb(56,"mat-label"),O.Lc(57,"Deliver"),O.Wb(),O.Sb(58,"input",25),O.Xb(59,"mat-autocomplete",17,26),O.Jc(61,de,2,2,"mat-option",19),O.kc(62,"async"),O.Wb(),O.Jc(63,fe,2,0,"mat-error",12),O.Wb(),O.Wb(),O.Xb(64,"div",13),O.Xb(65,"mat-form-field",10),O.Xb(66,"mat-label"),O.Lc(67,"Deliver Date"),O.Wb(),O.Xb(68,"input",27),O.fc("change",(function(e){return t.commonService.setDateStr(e)})),O.Wb(),O.Sb(69,"mat-datepicker-toggle",23),O.Sb(70,"mat-datepicker",null,28),O.Wb(),O.Wb(),O.Xb(72,"div",13),O.Xb(73,"mat-form-field",10),O.Xb(74,"mat-label"),O.Lc(75,"Manage Date"),O.Wb(),O.Xb(76,"input",29),O.fc("change",(function(e){return t.commonService.setDateStr(e)})),O.Wb(),O.Sb(77,"mat-datepicker-toggle",23),O.Sb(78,"mat-datepicker",null,30),O.Jc(80,ge,2,0,"mat-error",12),O.Wb(),O.Wb(),O.Xb(81,"div",13),O.Xb(82,"mat-form-field",10),O.Xb(83,"mat-label"),O.Lc(84,"Status"),O.Wb(),O.Xb(85,"mat-select",31),O.Jc(86,ve,2,2,"mat-option",19),O.Wb(),O.Jc(87,xe,2,0,"mat-error",12),O.Wb(),O.Wb(),O.Xb(88,"div",13),O.Xb(89,"mat-form-field",10),O.Xb(90,"mat-label"),O.Lc(91,"Owner"),O.Wb(),O.Xb(92,"mat-select",32),O.Jc(93,ke,2,2,"mat-option",19),O.Wb(),O.Jc(94,ye,2,0,"mat-error",12),O.Wb(),O.Wb(),O.Xb(95,"div",13),O.Xb(96,"mat-form-field",10),O.Xb(97,"mat-label"),O.Lc(98,"Info"),O.Wb(),O.Sb(99,"input",33),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Wb()),2&e){var n=O.xc(32),i=O.xc(42),a=O.xc(53),r=O.xc(60),o=O.xc(71),c=O.xc(79);O.pc("formGroup",t.form),O.Db(6),O.Ic("height",t.height,"px"),O.Db(9),O.pc("ngIf",t.form.get("code").hasError("required")),O.Db(15),O.pc("matAutocomplete",n),O.Db(1),O.pc("displayWith",t.commonService.displayFn.bind(t,"short_name",t.partner)),O.Db(2),O.pc("ngForOf",O.lc(34,29,t.filteredPartner)),O.Db(2),O.pc("ngIf",t.form.get("partner").hasError("required")),O.Db(5),O.pc("matAutocomplete",i),O.Db(1),O.pc("displayWith",t.commonService.displayFn.bind(t,"name",t.truckPoint)),O.Db(2),O.pc("ngForOf",O.lc(44,31,t.filteredTruckPoint1)),O.Db(2),O.pc("ngIf",t.form.get("pick_up").hasError("required")),O.Db(5),O.pc("matDatepicker",a)("min",t.minDate)("max",t.maxDate),O.Db(1),O.pc("for",a),O.Db(7),O.pc("matAutocomplete",r),O.Db(1),O.pc("displayWith",t.commonService.displayFn.bind(t,"name",t.truckPoint)),O.Db(2),O.pc("ngForOf",O.lc(62,33,t.filteredTruckPoint2)),O.Db(2),O.pc("ngIf",t.form.get("deliver").hasError("required")),O.Db(5),O.pc("matDatepicker",o),O.Db(1),O.pc("for",o),O.Db(7),O.pc("matDatepicker",c),O.Db(1),O.pc("for",c),O.Db(3),O.pc("ngIf",t.form.get("manage_date").hasError("required")),O.Db(6),O.pc("ngForOf",t.status),O.Db(1),O.pc("ngIf",t.form.get("status").hasError("required")),O.Db(6),O.pc("ngForOf",t.user),O.Db(1),O.pc("ngIf",t.form.get("owner").hasError("required"))}},directives:[oe.A,oe.q,oe.h,H.d,H.c,u.b,H.b,J.a,l.c,l.f,h.b,oe.b,oe.p,oe.g,oe.w,j.t,c.c,c.a,j.s,s.b,s.d,l.h,s.a,f.a,l.b,S.n],pipes:[j.b],styles:["shipment-quote-sidebar .navbar-top{background:#fff!important;padding:13px 0;-webkit-box-pack:center;justify-content:center;height:65px;border-bottom:1px solid #a3a3a3}shipment-quote-sidebar .navbar-scroll-container{background:#fff!important}shipment-quote-sidebar .navbar-scroll-container .navbar-content{padding-top:0}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2{overflow:hidden}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2 .info-line{padding-left:8px;padding-right:8px;margin-bottom:-4px}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2 .info-line .search-shortcut{font-size:12px;padding:4px;border:1px solid #039be5;border-radius:4px;margin-right:4px;margin-bottom:4px;cursor:pointer}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2 .group{margin:16px 16px 16px 8px;display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 0 auto;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;position:relative;border-radius:2px;padding:28px 16px 8px;border:1px solid rgba(0,0,0,.12)}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2 .group h2{position:absolute;top:-8px;left:8px;margin:0;padding:0 8px;font-size:12px;font-weight:600;background:#fafafa;color:rgba(0,0,0,.54)}navbar .navbar-top{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-flex:1;flex:1 0 auto;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;min-height:64px;max-height:64px;height:64px;padding:12px 12px 12px 20px}@media screen and (max-width:599px){navbar .navbar-top{min-height:56px;max-height:56px;height:56px}}navbar .navbar-scroll-container{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-flex:1;flex:1 1 auto;overflow-y:auto;-webkit-overflow-scrolling:touch;background:-webkit-gradient(linear,left top,left bottom,color-stop(30%,transparent),color-stop(30%,transparent)),-webkit-gradient(linear,left top,left bottom,color-stop(0,rgba(0,0,0,.25)),color-stop(40%,transparent));background:linear-gradient(transparent 30%,transparent 0),linear-gradient(rgba(0,0,0,.25),transparent 40%);background-repeat:no-repeat;background-size:100% 40px,100% 10px;background-attachment:local,scroll}navbar .navbar-scroll-container .navbar-content{-webkit-box-flex:1;flex:1 1 auto;padding-top:32px}"],encapsulation:2}),qe);function Xe(e,t){1&e&&(O.Xb(0,"div",8),O.Xb(1,"div",9),O.Xb(2,"div",10),O.Sb(3,"div",11),O.Xb(4,"div",12),O.Sb(5,"div",13),O.Wb(),O.Xb(6,"div",14),O.Sb(7,"div",13),O.Wb(),O.Wb(),O.Wb(),O.Wb())}function We(e,t){if(1&e){var n=O.Yb();O.Xb(0,"fuse-sidebar",15),O.Xb(1,"div",16),O.Xb(2,"shipment-quote-sidebar",17),O.fc("createShipment",(function(e){return O.Bc(n),O.jc().createShipment(e)})),O.Wb(),O.Wb(),O.Wb()}if(2&e){var i=O.jc();O.Db(2),O.pc("quote",i.quote)("partner",i.partner)("user",i.user)("truckPoint",i.truckPoint)}}var Se,De=((Se=function(){function e(t,n,i,a,r,o){_classCallCheck(this,e),this._fuseSidebarService=t,this.authService=n,this.shipmentService=i,this.datePipe=a,this.router=r,this.route=o,this.height=560,this.sumRevenue=[],this.sumCost=[],this.currencyProfit=[],this.sidebarPanel=!0,this.requestProcessing=!1,this._unsubscribeAll=new M.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;if(this.id=this.route.snapshot.params.id,this.authService.windowSizeChanged.pipe(Object(R.takeUntil)(this._unsubscribeAll)).subscribe((function(t){e.height=t.height-64-62-12})),this.authService.changeScreen.pipe(Object(R.takeUntil)(this._unsubscribeAll)).subscribe((function(t){e.height=t?e.authService.screenHeight-62-12:e.authService.screenHeight-64-62-12})),this.shipmentService.onDataChanged.pipe(Object(R.takeUntil)(this._unsubscribeAll)).subscribe((function(t){e.truckPoint=e.shipmentService.truckPoint,e.price=e.shipmentService.price,e.currency=e.shipmentService.currency,e.country=e.shipmentService.country,e.partner=e.shipmentService.partner,e.user=e.shipmentService.user})),this.shipmentService.onQuoteChanged.pipe(Object(R.takeUntil)(this._unsubscribeAll)).subscribe((function(t){e.quote=t[0][0],e.quote.quote=t[1],e.quote.quote_cost=t[2],e.getCurrencyProfit(e.quote)})),this.authService.permissionModul)this.permission=this.authService.permissionModul;else{var t=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(t)}}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"getCurrencyProfit",value:function(e){var t=this;function n(e){return 5.26==e&&(e=.05/.95*100),e}this.currencyProfit=[],this.sumRevenue=[],this.sumCost=[];var i=JSON.parse(JSON.stringify(e));if(i.quote.length>0)for(var a=function(e){var a=i.quote[e],r=t.currency.find((function(e){return e.id==a.currency}));if(r&&!t.currencyProfit.includes(r.code)&&(t.currencyProfit.push(r.code),t.sumRevenue.push({amount:0,tax:0,total:0,currency:r.code}),t.sumCost.push({amount:0,tax:0,total:0,currency:r.code})),r){var o=t.sumRevenue.find((function(e){return e.currency==r.code}));o.amount+=a.volume*a.amount,o.tax+=a.volume*a.amount*n(a.tax)/100,o.total+=a.volume*a.amount*(1+n(a.tax)/100)}},r=0;r<i.quote.length;++r)a(r);if(i.quote_cost.length>0)for(var o=function(e){var a=i.quote_cost[e],r=t.currency.find((function(e){return e.id==a.currency}));if(r&&!t.currencyProfit.includes(r.code)&&(t.currencyProfit.push(r.code),t.sumRevenue.push({amount:0,tax:0,total:0,currency:r.code}),t.sumCost.push({amount:0,tax:0,total:0,currency:r.code})),r){var o=t.sumCost.find((function(e){return e.currency==r.code}));o.amount+=a.volume*a.amount,o.tax+=a.volume*a.amount*n(a.tax)/100,o.total+=a.volume*a.amount*(1+n(a.tax)/100)}},c=0;c<i.quote_cost.length;++c)o(c)}},{key:"createShipment",value:function(e){var t=this;e.pick_date=e.pick_date?this.datePipe.transform(new Date(e.pick_date),"yyyy-MM-dd")+" 00:00:00":null,e.deliver_date=e.deliver_date?this.datePipe.transform(new Date(e.deliver_date),"yyyy-MM-dd")+" 23:59:00":null,e.manage_date=e.manage_date?this.datePipe.transform(new Date(e.manage_date),"yyyy-MM-dd")+" 23:59:00":null,e.create_by=this.authService.user,this.shipment=e;var n={shipment:this.shipment,quote:this.quote};this.requestProcessing=!0,this.shipmentService.createDnlShipmentQuote(n).then((function(e){t.requestProcessing=!1,e.shipment.insertId>0?t.router.navigate(["/apps/workflow/shipment/detail/"+e.shipment.insertId+"/soa"]):(alert("ERROR"),console.error(e))})).catch((function(e){t.requestProcessing=!1,alert("ERROR"),console.error(e)}))}},{key:"deleteItem",value:function(e){}},{key:"toggleSidebar",value:function(e){this._fuseSidebarService.getSidebar(e).toggleOpen()}},{key:"showHideBar",value:function(e){this.sidebarPanel=!this.sidebarPanel}},{key:"refreshPage",value:function(e){this.authService.refreshData(this.shipmentService)}}]),e}()).\u0275fac=function(e){return new(e||Se)(O.Rb(N.a),O.Rb(A.a),O.Rb(F),O.Rb(j.f),O.Rb(a.g),O.Rb(a.a))},Se.\u0275cmp=O.Lb({type:Se,selectors:[["shipment-quote"]],decls:8,vars:8,consts:[["class","spinner-wrapper",4,"ngIf"],[1,"page-layout","simple","left-sidebar","inner-scroll"],["class","sidebar","name","shipment-quote-sidebar","position","left","lockedOpen","gt-md",4,"ngIf"],["fusePerfectScrollbar","",1,"center"],[3,"sidebarName","showHideBar","refreshPage","toggleSidebar"],[1,"content","pl-8","pt-8"],[2,"overflow","auto"],[3,"quote","sumRevenue","sumCost","deleteItem"],[1,"spinner-wrapper"],[1,"spinner"],[1,"inner"],[1,"gap"],[1,"left"],[1,"half-circle"],[1,"right"],["name","shipment-quote-sidebar","position","left","lockedOpen","gt-md",1,"sidebar"],[1,"content"],[3,"quote","partner","user","truckPoint","createShipment"]],template:function(e,t){1&e&&(O.Jc(0,Xe,8,0,"div",0),O.Xb(1,"div",1),O.Jc(2,We,3,4,"fuse-sidebar",2),O.Xb(3,"div",3),O.Xb(4,"shipment-quote-header",4),O.fc("showHideBar",(function(e){return t.showHideBar(e)}))("refreshPage",(function(e){return t.refreshPage(e)}))("toggleSidebar",(function(e){return t.toggleSidebar(e)})),O.Wb(),O.Xb(5,"div",5),O.Xb(6,"div",6),O.Xb(7,"shipment-quote-content",7),O.fc("deleteItem",(function(e){return t.deleteItem(e)})),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Wb()),2&e&&(O.pc("ngIf",t.requestProcessing),O.Db(2),O.pc("ngIf",t.sidebarPanel),O.Db(2),O.pc("sidebarName","shipment-quote-sidebar"),O.Db(2),O.Ic("height",t.height,"px"),O.Db(1),O.pc("quote",t.quote)("sumRevenue",t.sumRevenue)("sumCost",t.sumCost))},directives:[j.t,z.a,J.a,V,ie,ae.a,we],styles:[""]}),Se);n.d(t,"ShipmentQuoteModule",(function(){return Pe}));var _e,Ce=[{path:":id",component:De,resolve:{data:F}}],Pe=((_e=function e(){_classCallCheck(this,e)}).\u0275mod=O.Pb({type:_e}),_e.\u0275inj=O.Ob({factory:function(e){return new(e||_e)},providers:[F],imports:[[a.k.forChild(Ce),o.b,r.a,c.b,s.c,u.c,b.b,l.e,p.b,m.b,h.c,d.c,f.b,g.c,v.e,x.b,k.b,y.b,q.d,w.e,X.b,W.b,D.b,_.k,S.t,C.a,P.f]]}),_e)}}]);