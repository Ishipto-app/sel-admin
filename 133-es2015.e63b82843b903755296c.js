(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{"2AaX":function(e,t,i){"use strict";i.r(t);var n=i("tyNb"),a=i("5HBU"),r=i("STbY"),o=i("/1cH"),s=i("iadO"),c=i("bTqV"),b=i("7EHt"),l=i("kmnG"),u=i("NFeN"),p=i("Qu3c"),h=i("qFsG"),m=i("wZkO"),d=i("d3UM"),f=i("QibW"),g=i("0IaG"),x=i("/t3+"),v=i("bSwM"),k=i("M9IT"),q=i("xHqg"),y=i("A5z7"),w=i("bv9b"),X=i("XhcP"),W=i("FKr1"),S=i("1jcm"),D=i("+0xr"),_=i("212X"),L=i("LPQX"),P=i("2Vo4"),C=i("tk/3"),I=i("fXoL"),O=i("qXBG");let A=(()=>{class e{constructor(e,t){this._httpClient=e,this.authService=t,this.onDataChanged=new P.a([]),this.onQuoteChanged=new P.a({})}resolve(e){this.authService.routerData=e;let t=e.params.id;return new Promise((e,i)=>{Promise.all([this.getDetailsDnlQuote(t),this.getData()]).then(()=>{e()},i)})}getDetailsDnlQuote(e){let t={headers:new C.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,n)=>{this._httpClient.get(this.authService.apiUrl+"/dnl/quote/id/"+e,t).subscribe(e=>{this.quote=e[0],this.quoteDetails=[1],this.quoteCostDetails=[2],this.onQuoteChanged.next(e),i(e)},n)})}getData(){let e={headers:new C.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((t,i)=>{this._httpClient.get(this.authService.apiUrl+"/dnl/shipment/data",e).subscribe(e=>{this.partner=e[0],this.truckPoint=e[1],this.user=e[2],this.price=e[3],this.currency=e[4],this.country=e[5],this.unit=e[6],this.scope=e[7],this.ipoint=e[8],this.agent=this.partner.filter(e=>"A"==e.scope_type),this.onDataChanged.next(e),t(e)},i)})}createDnlShipmentQuote(e){let t={headers:new C.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,n)=>{this._httpClient.post(this.authService.apiUrl+"/dnl/quote/shipment",e,t).subscribe(e=>{i(e)},n)})}}return e.\u0275fac=function(t){return new(t||e)(I.bc(C.a),I.bc(O.a))},e.\u0275prov=I.Nb({token:e,factory:e.\u0275fac}),e})();var F=i("yrbL"),R=i("XNiG"),M=i("HX77"),N=i("ofXK"),j=i("B9zo"),z=i("EwFO"),J=i("0JVi"),T=i("XiUz"),H=i("znSr");function B(e,t){if(1&e){const e=I.Yb();I.Xb(0,"button",10),I.fc("click",(function(t){I.Bc(e);const i=I.jc();return t.stopPropagation(),i.changeScreen(!0)})),I.Xb(1,"mat-icon"),I.Lc(2,"flip_to_front"),I.Wb(),I.Wb()}}function E(e,t){if(1&e){const e=I.Yb();I.Xb(0,"button",10),I.fc("click",(function(t){I.Bc(e);const i=I.jc();return t.stopPropagation(),i.changeScreen(!1)})),I.Xb(1,"mat-icon"),I.Lc(2,"flip_to_back"),I.Wb(),I.Wb()}}let Q=(()=>{class e{constructor(e,t){this.authService=e,this._fuseConfigService=t,this.collapsed=!0,this.fullScreen=!1,this.toggleSidebar=new I.o,this.showHideBar=new I.o,this.refreshPage=new I.o,this._unsubscribeAll=new R.a}ngOnInit(){}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}changeScreen(e){this.fullScreen=e,this.authService.changeScreen.next(e),this._fuseConfigService.config=this.fullScreen?{layout:{navbar:{hidden:!0},toolbar:{hidden:!0},footer:{hidden:!0},sidepanel:{hidden:!0}}}:{layout:{navbar:{hidden:!1},toolbar:{hidden:!1},footer:{hidden:!0},sidepanel:{hidden:!0}}}}collapse(){this.collapsed=!0}expand(){this.collapsed=!1}}return e.\u0275fac=function(t){return new(t||e)(I.Rb(O.a),I.Rb(J.b))},e.\u0275cmp=I.Lb({type:e,selectors:[["shipment-quote-header"]],inputs:{sidebarName:"sidebarName"},outputs:{toggleSidebar:"toggleSidebar",showHideBar:"showHideBar",refreshPage:"refreshPage"},decls:15,vars:2,consts:[[1,"p-0","mat-elevation-z1"],["fxFlex","","fxFill","","fxLayout","row","fxLayoutAlign","start center"],["fxFlex","1 0 auto","fxLayout","row","fxLayoutAlign","start center"],[1,"px-8","px-md-16"],["mat-icon-button","","color","accent","fxHide.gt-sm","","fxFlex","10","fxFlex.gt-sm","0",1,"sidebar-toggle","mr-12",3,"click"],["mat-icon-button","","fxHide","","fxShow.gt-sm","","fxFlex","10","fxFlex.gt-sm","0",1,"sidebar-toggle","mr-12",3,"click"],["fxFlex","0 1 auto","fxLayout","row","fxLayoutAlign","start center",1,""],[1,"toolbar-separator"],["mat-icon-button","","class","ml-8",3,"click",4,"ngIf"],["fxHide","","fxShow.gt-xs","",1,"toolbar-separator"],["mat-icon-button","",1,"ml-8",3,"click"]],template:function(e,t){1&e&&(I.Xb(0,"mat-toolbar",0),I.Xb(1,"div",1),I.Xb(2,"div",2),I.Xb(3,"div",3),I.Xb(4,"button",4),I.fc("click",(function(e){return t.toggleSidebar.emit(t.sidebarName)})),I.Xb(5,"mat-icon"),I.Lc(6,"save"),I.Wb(),I.Wb(),I.Xb(7,"button",5),I.fc("click",(function(e){return t.showHideBar.emit()})),I.Xb(8,"mat-icon"),I.Lc(9,"menu"),I.Wb(),I.Wb(),I.Wb(),I.Wb(),I.Xb(10,"div",6),I.Sb(11,"div",7),I.Jc(12,B,3,0,"button",8),I.Jc(13,E,3,0,"button",8),I.Sb(14,"div",9),I.Wb(),I.Wb(),I.Wb()),2&e&&(I.Db(12),I.pc("ngIf",!t.fullScreen),I.Db(1),I.pc("ngIf",t.fullScreen))},directives:[x.a,T.b,T.e,T.d,T.c,c.b,H.b,u.a,N.t],styles:["shipment-quote-header{position:relative;display:-webkit-box;display:flex;-webkit-box-flex:0;flex:0 0 auto;z-index:4}shipment-quote-header.below{z-index:2}shipment-quote-header .mat-toolbar{position:relative;background:#fff!important;color:inherit!important}shipment-quote-header .logo{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}shipment-quote-header .logo .logo-icon{width:38px}shipment-quote-header .chat-panel-toggle-button,shipment-quote-header .language-button,shipment-quote-header .quick-panel-toggle-button,shipment-quote-header .user-button,shipment-quote-header fuse-search-bar{min-width:64px;height:64px}@media screen and (max-width:599px){shipment-quote-header .chat-panel-toggle-button,shipment-quote-header .language-button,shipment-quote-header .quick-panel-toggle-button,shipment-quote-header .user-button,shipment-quote-header fuse-search-bar{height:56px}}shipment-quote-header .navbar-toggle-button{min-width:56px;height:56px}shipment-quote-header .toolbar-separator{height:64px;width:1px;background:#e6e6e6}@media screen and (max-width:599px){shipment-quote-header .toolbar-separator{height:56px}}shipment-quote-header #shipment-detail-search-bar{display:-webkit-box;display:flex;-webkit-box-flex:0;flex:0 1 auto;min-width:64px;height:64px;font-size:13px}@media screen and (max-width:599px){shipment-quote-header #shipment-detail-search-bar{height:56px}}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content{display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 1 auto;-webkit-box-align:center;align-items:center;-webkit-box-pack:start;justify-content:flex-start}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-collapser,shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-expander{cursor:pointer;padding:0 20px;margin:0;width:64px!important;height:64px!important;line-height:64px!important}@media screen and (max-width:599px){shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-collapser,shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-expander{height:56px!important;line-height:56px!important}}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-loader{width:64px!important;height:64px!important;line-height:64px!important}@media screen and (max-width:599px){shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-loader{height:56px!important;line-height:56px!important}}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content .shipment-detail-search-bar-collapser{display:none}shipment-quote-header #shipment-detail-search-bar .shipment-detail-search-bar-content #shipment-detail-search-bar-input{display:none;-webkit-box-flex:1;flex:1 0 auto;min-height:64px;font-size:16px;background-color:transparent;color:currentColor}shipment-quote-header #shipment-detail-search-bar.expanded{position:absolute;top:0;right:0;bottom:0;left:0;z-index:10;background:#f5f5f5}shipment-quote-header #shipment-detail-search-bar.expanded .shipment-detail-search-bar-content #shipment-detail-search-bar-input{display:-webkit-box;display:flex}shipment-quote-header #shipment-detail-search-bar.expanded .shipment-detail-search-bar-content .shipment-detail-search-bar-collapser{display:block}"],encapsulation:2}),e})();var U=i("PVWW"),V=i("0Zc1");function G(e,t){if(1&e&&(I.Xb(0,"tr"),I.Xb(1,"td"),I.Lc(2),I.Wb(),I.Xb(3,"td"),I.Lc(4),I.Wb(),I.Xb(5,"td"),I.Lc(6),I.Wb(),I.Xb(7,"td"),I.Lc(8),I.Wb(),I.Xb(9,"td"),I.Lc(10),I.kc(11,"number"),I.Wb(),I.Xb(12,"td"),I.Lc(13),I.kc(14,"number"),I.Wb(),I.Xb(15,"td"),I.Lc(16),I.Wb(),I.Xb(17,"td"),I.Lc(18),I.Wb(),I.Xb(19,"td",5),I.Xb(20,"a"),I.Lc(21),I.Wb(),I.Wb(),I.Xb(22,"td"),I.Lc(23),I.Wb(),I.Sb(24,"td",6),I.Wb()),2&e){const e=t.$implicit,i=t.index;I.Db(2),I.Mc(i+1),I.Db(2),I.Mc(e.price_name),I.Db(2),I.Mc(e.unit_code),I.Db(2),I.Mc(e.volume),I.Db(2),I.Mc(I.mc(11,12,e.amount,"1.0-0")),I.Db(3),I.Mc(I.mc(14,15,e.tax,"1.2-2")),I.Db(3),I.Mc(e.currency_code),I.Db(2),I.Mc(e.country_name),I.Db(1),I.pc("matTooltip",e.info)("matTooltipPosition","left"),I.Db(2),I.Mc(e.info?"view":""),I.Db(2),I.Mc(e.partner_short_name)}}function $(e,t){if(1&e&&(I.Xb(0,"tr"),I.Sb(1,"td"),I.Sb(2,"td"),I.Sb(3,"td"),I.Xb(4,"td"),I.Lc(5,"Total"),I.Wb(),I.Xb(6,"td"),I.Lc(7),I.kc(8,"number"),I.Wb(),I.Xb(9,"td"),I.Lc(10),I.kc(11,"number"),I.Wb(),I.Xb(12,"td"),I.Lc(13),I.kc(14,"number"),I.Wb(),I.Xb(15,"td"),I.Lc(16),I.Wb(),I.Sb(17,"td"),I.Sb(18,"td"),I.Sb(19,"td",6),I.Wb()),2&e){const e=t.$implicit;I.Db(7),I.Mc(I.mc(8,4,e.amount,"1.2-2")),I.Db(3),I.Mc(I.mc(11,7,e.tax,"1.2-2")),I.Db(3),I.Mc(I.mc(14,10,e.total,"1.2-2")),I.Db(3),I.Mc(e.currency)}}function Y(e,t){if(1&e&&(I.Xb(0,"div",1),I.Xb(1,"h2"),I.Lc(2),I.Wb(),I.Xb(3,"div",2),I.Xb(4,"table",3),I.Xb(5,"thead"),I.Xb(6,"tr"),I.Xb(7,"th"),I.Lc(8,"No"),I.Wb(),I.Xb(9,"th"),I.Lc(10,"Price"),I.Wb(),I.Xb(11,"th"),I.Lc(12,"Unit"),I.Wb(),I.Xb(13,"th"),I.Lc(14,"Volume"),I.Wb(),I.Xb(15,"th"),I.Lc(16,"Amount"),I.Wb(),I.Xb(17,"th"),I.Lc(18,"Tax(%)"),I.Wb(),I.Xb(19,"th"),I.Lc(20,"Currency"),I.Wb(),I.Xb(21,"th"),I.Lc(22,"Payment center"),I.Wb(),I.Xb(23,"th"),I.Lc(24,"Info"),I.Wb(),I.Xb(25,"th"),I.Lc(26),I.Wb(),I.Sb(27,"th"),I.Wb(),I.Wb(),I.Xb(28,"tbody"),I.Jc(29,G,25,18,"tr",4),I.Wb(),I.Xb(30,"tfoot"),I.Jc(31,$,20,13,"tr",4),I.Wb(),I.Wb(),I.Wb(),I.Wb()),2&e){const e=I.jc();I.Db(2),I.Mc(e.label),I.Db(1),I.Ic("max-height",e.height,"px"),I.Db(23),I.Nc("","Revenue"==e.label?"Pay":"Issue"," partner"),I.Db(3),I.pc("ngForOf",e.data),I.Db(2),I.pc("ngForOf",e.sum)}}let K=(()=>{class e{constructor(e,t){this.router=e,this.authService=t,this.deleteItem=new I.o,this.totalCurrency=[],this.height=480,this.total={tax:0,amount:0},this._unsubscribeAll=new R.a}ngOnInit(){console.log(this.data),this.total={tax:0,amount:0},this.totalCurrency=[],this.data.map(e=>{let t=this.totalCurrency.find(t=>t.code==e.currency_code);t?(t.amount+=e.volume*e.amount,t.tax+=e.volume*e.tax_amount):this.totalCurrency.push({code:e.currency_code,amount:e.volume*e.amount,tax:e.volume*e.tax_amount}),this.total.tax+=e.volume*e.tax_amount*e.ex_rate,this.total.amount+=e.volume*e.amount*e.ex_rate})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}}return e.\u0275fac=function(t){return new(t||e)(I.Rb(n.g),I.Rb(O.a))},e.\u0275cmp=I.Lb({type:e,selectors:[["shipment-quote-content-table"]],inputs:{data:"data",sum:"sum",label:"label"},outputs:{deleteItem:"deleteItem"},decls:1,vars:1,consts:[["class","group mb-12 mt-12",4,"ngIf"],[1,"group","mb-12","mt-12"],[2,"overflow","auto"],[1,"simple","quote-details-table"],[4,"ngFor","ngForOf"],[3,"matTooltip","matTooltipPosition"],[1,"text-right"]],template:function(e,t){1&e&&I.Jc(0,Y,32,6,"div",0),2&e&&I.pc("ngIf",t.data&&t.data.length>0)},directives:[N.t,N.s,p.a],pipes:[N.g],styles:["shipment-quote-content-table .group{margin-left:0;margin-right:0;display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 0 auto;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;position:relative;border-radius:2px;padding:16px 0 8px;border:1px solid #000}shipment-quote-content-table .group h2{position:absolute;top:-8px;left:8px;margin:0;padding:0 8px;font-size:12px;font-weight:700;background:#fafafa}shipment-quote-content-table .group .quote-details-table{font-size:12px}shipment-quote-content-table .group .quote-details-table td,shipment-quote-content-table .group .quote-details-table th{padding:8px;font-size:12px}shipment-quote-content-table .group .quote-details-table tfoot td{font-weight:600}shipment-quote-content-table .group .quote-details-table .sticky-left-col1{position:sticky;min-width:36px;position:-webkit-sticky;left:0;background-color:#fff;z-index:10}shipment-quote-content-table .group .quote-details-table .sticky-left-col2{position:sticky;position:-webkit-sticky;left:36px;background-color:#fff;z-index:20}shipment-quote-content-table .group .quote-details-table .sticky-right-col{min-width:40px;position:sticky;position:-webkit-sticky;right:0;background-color:#b3e5fc}shipment-quote-content-table .group .quote-details-table tfoot td.sticky-row2{position:sticky;position:-webkit-sticky;bottom:0;background:#fff;z-index:25;font-weight:bolder}shipment-quote-content-table .group .quote-details-table tfoot td.sticky-row1{position:sticky;position:-webkit-sticky;bottom:32px;background:#fff;z-index:25}"],encapsulation:2,data:{animation:U.a}}),e})(),Z=(()=>{class e{constructor(e,t){this.authService=e,this.commonService=t,this.deleteItem=new I.o}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(I.Rb(O.a),I.Rb(V.a))},e.\u0275cmp=I.Lb({type:e,selectors:[["shipment-quote-content"]],inputs:{quote:"quote",sumRevenue:"sumRevenue",sumCost:"sumCost"},outputs:{deleteItem:"deleteItem"},decls:3,vars:6,consts:[["id","print-content"],[3,"data","label","sum","deleteItem"]],template:function(e,t){1&e&&(I.Xb(0,"div",0),I.Xb(1,"shipment-quote-content-table",1),I.fc("deleteItem",(function(e){return t.deleteItem.emit(e)})),I.Wb(),I.Xb(2,"shipment-quote-content-table",1),I.fc("deleteItem",(function(e){return t.deleteItem.emit(e)})),I.Wb(),I.Wb()),2&e&&(I.Db(1),I.pc("data",t.quote.quote)("label","Revenue")("sum",t.sumRevenue),I.Db(1),I.pc("data",t.quote.quote_cost)("label","Cost")("sum",t.sumCost))},directives:[K],styles:["shipment-quote-content{background:#fff}shipment-quote-content #print-content{overflow:auto}@media print{shipment-quote-content #print-content{height:auto!important}}"],encapsulation:2,data:{animation:U.a}}),e})();var ee=i("fE3o"),te=i("1G5W"),ie=i("3Pt+"),ne=i("JX91"),ae=i("lJxs");const re=["formDirective"];function oe(e,t){1&e&&(I.Xb(0,"mat-error"),I.Lc(1," code is required "),I.Wb())}function se(e,t){if(1&e&&(I.Xb(0,"mat-option",34),I.Lc(1),I.Wb()),2&e){const e=t.$implicit;I.pc("value",e.id),I.Db(1),I.Nc(" ",e.short_name," ")}}function ce(e,t){1&e&&(I.Xb(0,"mat-error"),I.Lc(1," Partner is required "),I.Wb())}function be(e,t){if(1&e&&(I.Xb(0,"mat-option",34),I.Lc(1),I.Wb()),2&e){const e=t.$implicit;I.pc("value",e.id),I.Db(1),I.Nc(" ",e.name," ")}}function le(e,t){1&e&&(I.Xb(0,"mat-error"),I.Lc(1," pick_up is required "),I.Wb())}function ue(e,t){if(1&e&&(I.Xb(0,"mat-option",34),I.Lc(1),I.Wb()),2&e){const e=t.$implicit;I.pc("value",e.id),I.Db(1),I.Nc(" ",e.name," ")}}function pe(e,t){1&e&&(I.Xb(0,"mat-error"),I.Lc(1," deliver is required "),I.Wb())}function he(e,t){1&e&&(I.Xb(0,"mat-error"),I.Lc(1,"Manage date is required!"),I.Wb())}function me(e,t){if(1&e&&(I.Xb(0,"mat-option",34),I.Lc(1),I.Wb()),2&e){const e=t.$implicit;I.pc("value",e.id),I.Db(1),I.Mc(e.name)}}function de(e,t){1&e&&(I.Xb(0,"mat-error"),I.Lc(1," Status is required "),I.Wb())}function fe(e,t){if(1&e&&(I.Xb(0,"mat-option",34),I.Lc(1),I.Wb()),2&e){const e=t.$implicit;I.pc("value",e.id),I.Db(1),I.Mc(e.name)}}function ge(e,t){1&e&&(I.Xb(0,"mat-error"),I.Lc(1," Owner is required "),I.Wb())}let xe=(()=>{class e{constructor(e,t,i){this.formBuilder=e,this.authService=t,this.commonService=i,this.createShipment=new I.o,this.form=this.formBuilder.group({code:[null,ie.y.required],hbl:[null],mbl:[null],partner:[null,ie.y.required],pick_up:[null,ie.y.required],pick_date:[null],deliver:[null,ie.y.required],deliver_date:[null],manage_date:[null,ie.y.required],status:[null,ie.y.required],owner:[null,ie.y.required],info:[null]}),this.status=[{id:0,name:"Invalid"},{id:1,name:"Booking"},{id:2,name:"Pick up"},{id:3,name:"Deliver"},{id:4,name:"Complete"},{id:5,name:"Done"},{id:10,name:"Lock"}],this.now=new Date,this.height=560,this._unsubscribeAll=new R.a}ngOnInit(){this.form.patchValue(this.quote),this.minDate=new Date(this.quote.quote_from),this.maxDate=new Date(this.quote.quote_to),this.form.controls.code.setValue(null),this.form.controls.status.setValue(1),this.authService.windowSizeChanged.pipe(Object(te.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-64-18}),this.authService.changeScreen.pipe(Object(te.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-64-18:this.authService.screenHeight-64-64-18}),this.filteredPartner=this.form.controls.partner.valueChanges.pipe(Object(ne.a)(""),Object(ae.a)(e=>e?"string"==typeof e?e:e.partner_name:null),Object(ae.a)(e=>e?this.commonService.filterData(e,"short_name",this.partner):[])),this.filteredTruckPoint1=this.form.controls.pick_up.valueChanges.pipe(Object(ne.a)(""),Object(ae.a)(e=>e?"string"==typeof e?e:e.name:null),Object(ae.a)(e=>e?this.commonService.filterData(e,"name",this.truckPoint):[])),this.filteredTruckPoint2=this.form.controls.deliver.valueChanges.pipe(Object(ne.a)(""),Object(ae.a)(e=>e?"string"==typeof e?e:e.name:null),Object(ae.a)(e=>e?this.commonService.filterData(e,"name",this.truckPoint):[])),this.form.controls.code.valueChanges.subscribe(e=>{this.form.controls.hbl.setValue(e)})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}setCheck(e){e.check=!e.check}resetForm(){this.searchNgForm.resetForm()}onFormSubmit(e){e.valid&&this.createShipment.emit(e.value)}}return e.\u0275fac=function(t){return new(t||e)(I.Rb(ie.d),I.Rb(O.a),I.Rb(V.a))},e.\u0275cmp=I.Lb({type:e,selectors:[["shipment-quote-sidebar"]],viewQuery:function(e,t){var i;1&e&&I.Sc(re,!0),2&e&&I.wc(i=I.gc())&&(t.searchNgForm=i.first)},inputs:{quote:"quote",user:"user",partner:"partner",truckPoint:"truckPoint",permission:"permission"},outputs:{createShipment:"createShipment"},decls:100,vars:35,consts:[["name","form",2,"border-right","1px solid #E6E6E6",3,"formGroup","keydown.enter","ngSubmit"],["formDirective","ngForm"],[1,"navbar-top"],["fxLayout","row","fxLayoutAlign","space-between center"],["mat-raised-button","","type","submit","fxFlex","45",1,"ml-8","mr-8",2,"border","1px solid #039BE5","border-radius","8px","color","#696969"],["fusePerfectScrollbar","",1,"navbar-scroll-container"],[1,"navbar-content"],[1,"nav","material2"],["fxLayout","row wrap"],["fxFlex","100",1,"info-line","mt-24"],["appearance","outline",1,"w-100-p","pr-sm-8"],["inputCheck","","aria-label","code","matInput","","formControlName","code","required",""],[4,"ngIf"],["fxFlex","100",1,"info-line"],["inputCheck","","matInput","","formControlName","hbl"],["inputCheck","","matInput","","formControlName","mbl"],["inputCheck","","aria-label","partner","matInput","","formControlName","partner","required","",3,"matAutocomplete"],[3,"displayWith"],["autoPartner","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["inputCheck","","aria-label","pick_up","matInput","","formControlName","pick_up","required","",3,"matAutocomplete"],["autoTruckPoint1","matAutocomplete"],["inputCheck","","matInput","","name","pick_date","formControlName","pick_date",3,"matDatepicker","min","max","change"],["matSuffix","",3,"for"],["pick_date",""],["inputCheck","","aria-label","deliver","matInput","","formControlName","deliver","required","",3,"matAutocomplete"],["autoTruckPoint2","matAutocomplete"],["inputCheck","","matInput","","name","deliver_date","formControlName","deliver_date",3,"matDatepicker","change"],["deliver_date",""],["inputCheck","","matInput","","name","manage_date","formControlName","manage_date","required","",3,"matDatepicker","change"],["manage_date",""],["formControlName","status","required",""],["formControlName","owner","required",""],["inputCheck","","matInput","","formControlName","info"],[3,"value"]],template:function(e,t){if(1&e&&(I.Xb(0,"form",0,1),I.fc("keydown.enter",(function(e){return"TEXTAREA"==e.target.tagName}))("ngSubmit",(function(e){return t.onFormSubmit(t.form)})),I.Xb(2,"div",2),I.Xb(3,"div",3),I.Xb(4,"button",4),I.Lc(5," Submit "),I.Wb(),I.Wb(),I.Wb(),I.Xb(6,"div",5),I.Xb(7,"div",6),I.Xb(8,"div",7),I.Xb(9,"div",8),I.Xb(10,"div",9),I.Xb(11,"mat-form-field",10),I.Xb(12,"mat-label"),I.Lc(13,"Code"),I.Wb(),I.Sb(14,"input",11),I.Jc(15,oe,2,0,"mat-error",12),I.Wb(),I.Wb(),I.Xb(16,"div",13),I.Xb(17,"mat-form-field",10),I.Xb(18,"mat-label"),I.Lc(19,"HBL"),I.Wb(),I.Sb(20,"input",14),I.Wb(),I.Wb(),I.Xb(21,"div",13),I.Xb(22,"mat-form-field",10),I.Xb(23,"mat-label"),I.Lc(24,"MBL"),I.Wb(),I.Sb(25,"input",15),I.Wb(),I.Wb(),I.Xb(26,"div",13),I.Xb(27,"mat-form-field",10),I.Xb(28,"mat-label"),I.Lc(29,"Partner"),I.Wb(),I.Sb(30,"input",16),I.Xb(31,"mat-autocomplete",17,18),I.Jc(33,se,2,2,"mat-option",19),I.kc(34,"async"),I.Wb(),I.Jc(35,ce,2,0,"mat-error",12),I.Wb(),I.Wb(),I.Xb(36,"div",13),I.Xb(37,"mat-form-field",10),I.Xb(38,"mat-label"),I.Lc(39,"Pick up"),I.Wb(),I.Sb(40,"input",20),I.Xb(41,"mat-autocomplete",17,21),I.Jc(43,be,2,2,"mat-option",19),I.kc(44,"async"),I.Wb(),I.Jc(45,le,2,0,"mat-error",12),I.Wb(),I.Wb(),I.Xb(46,"div",13),I.Xb(47,"mat-form-field",10),I.Xb(48,"mat-label"),I.Lc(49,"Pick Date"),I.Wb(),I.Xb(50,"input",22),I.fc("change",(function(e){return t.commonService.setDateStr(e)})),I.Wb(),I.Sb(51,"mat-datepicker-toggle",23),I.Sb(52,"mat-datepicker",null,24),I.Wb(),I.Wb(),I.Xb(54,"div",13),I.Xb(55,"mat-form-field",10),I.Xb(56,"mat-label"),I.Lc(57,"Deliver"),I.Wb(),I.Sb(58,"input",25),I.Xb(59,"mat-autocomplete",17,26),I.Jc(61,ue,2,2,"mat-option",19),I.kc(62,"async"),I.Wb(),I.Jc(63,pe,2,0,"mat-error",12),I.Wb(),I.Wb(),I.Xb(64,"div",13),I.Xb(65,"mat-form-field",10),I.Xb(66,"mat-label"),I.Lc(67,"Deliver Date"),I.Wb(),I.Xb(68,"input",27),I.fc("change",(function(e){return t.commonService.setDateStr(e)})),I.Wb(),I.Sb(69,"mat-datepicker-toggle",23),I.Sb(70,"mat-datepicker",null,28),I.Wb(),I.Wb(),I.Xb(72,"div",13),I.Xb(73,"mat-form-field",10),I.Xb(74,"mat-label"),I.Lc(75,"Manage Date"),I.Wb(),I.Xb(76,"input",29),I.fc("change",(function(e){return t.commonService.setDateStr(e)})),I.Wb(),I.Sb(77,"mat-datepicker-toggle",23),I.Sb(78,"mat-datepicker",null,30),I.Jc(80,he,2,0,"mat-error",12),I.Wb(),I.Wb(),I.Xb(81,"div",13),I.Xb(82,"mat-form-field",10),I.Xb(83,"mat-label"),I.Lc(84,"Status"),I.Wb(),I.Xb(85,"mat-select",31),I.Jc(86,me,2,2,"mat-option",19),I.Wb(),I.Jc(87,de,2,0,"mat-error",12),I.Wb(),I.Wb(),I.Xb(88,"div",13),I.Xb(89,"mat-form-field",10),I.Xb(90,"mat-label"),I.Lc(91,"Owner"),I.Wb(),I.Xb(92,"mat-select",32),I.Jc(93,fe,2,2,"mat-option",19),I.Wb(),I.Jc(94,ge,2,0,"mat-error",12),I.Wb(),I.Wb(),I.Xb(95,"div",13),I.Xb(96,"mat-form-field",10),I.Xb(97,"mat-label"),I.Lc(98,"Info"),I.Wb(),I.Sb(99,"input",33),I.Wb(),I.Wb(),I.Wb(),I.Wb(),I.Wb(),I.Wb(),I.Wb()),2&e){const e=I.xc(32),i=I.xc(42),n=I.xc(53),a=I.xc(60),r=I.xc(71),o=I.xc(79);I.pc("formGroup",t.form),I.Db(6),I.Ic("height",t.height,"px"),I.Db(9),I.pc("ngIf",t.form.get("code").hasError("required")),I.Db(15),I.pc("matAutocomplete",e),I.Db(1),I.pc("displayWith",t.commonService.displayFn.bind(t,"short_name",t.partner)),I.Db(2),I.pc("ngForOf",I.lc(34,29,t.filteredPartner)),I.Db(2),I.pc("ngIf",t.form.get("partner").hasError("required")),I.Db(5),I.pc("matAutocomplete",i),I.Db(1),I.pc("displayWith",t.commonService.displayFn.bind(t,"name",t.truckPoint)),I.Db(2),I.pc("ngForOf",I.lc(44,31,t.filteredTruckPoint1)),I.Db(2),I.pc("ngIf",t.form.get("pick_up").hasError("required")),I.Db(5),I.pc("matDatepicker",n)("min",t.minDate)("max",t.maxDate),I.Db(1),I.pc("for",n),I.Db(7),I.pc("matAutocomplete",a),I.Db(1),I.pc("displayWith",t.commonService.displayFn.bind(t,"name",t.truckPoint)),I.Db(2),I.pc("ngForOf",I.lc(62,33,t.filteredTruckPoint2)),I.Db(2),I.pc("ngIf",t.form.get("deliver").hasError("required")),I.Db(5),I.pc("matDatepicker",r),I.Db(1),I.pc("for",r),I.Db(7),I.pc("matDatepicker",o),I.Db(1),I.pc("for",o),I.Db(3),I.pc("ngIf",t.form.get("manage_date").hasError("required")),I.Db(6),I.pc("ngForOf",t.status),I.Db(1),I.pc("ngIf",t.form.get("status").hasError("required")),I.Db(6),I.pc("ngForOf",t.user),I.Db(1),I.pc("ngIf",t.form.get("owner").hasError("required"))}},directives:[ie.A,ie.q,ie.h,T.d,T.c,c.b,T.b,z.a,l.c,l.f,h.b,ie.b,ie.p,ie.g,ie.w,N.t,o.c,o.a,N.s,s.b,s.d,l.h,s.a,d.a,l.b,W.n],pipes:[N.b],styles:["shipment-quote-sidebar .navbar-top{background:#fff!important;padding:13px 0;-webkit-box-pack:center;justify-content:center;height:65px;border-bottom:1px solid #a3a3a3}shipment-quote-sidebar .navbar-scroll-container{background:#fff!important}shipment-quote-sidebar .navbar-scroll-container .navbar-content{padding-top:0}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2{overflow:hidden}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2 .info-line{padding-left:8px;padding-right:8px;margin-bottom:-4px}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2 .info-line .search-shortcut{font-size:12px;padding:4px;border:1px solid #039be5;border-radius:4px;margin-right:4px;margin-bottom:4px;cursor:pointer}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2 .group{margin:16px 16px 16px 8px;display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 0 auto;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;position:relative;border-radius:2px;padding:28px 16px 8px;border:1px solid rgba(0,0,0,.12)}shipment-quote-sidebar .navbar-scroll-container .navbar-content .nav.material2 .group h2{position:absolute;top:-8px;left:8px;margin:0;padding:0 8px;font-size:12px;font-weight:600;background:#fafafa;color:rgba(0,0,0,.54)}navbar .navbar-top{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-flex:1;flex:1 0 auto;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;min-height:64px;max-height:64px;height:64px;padding:12px 12px 12px 20px}@media screen and (max-width:599px){navbar .navbar-top{min-height:56px;max-height:56px;height:56px}}navbar .navbar-scroll-container{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-flex:1;flex:1 1 auto;overflow-y:auto;-webkit-overflow-scrolling:touch;background:-webkit-gradient(linear,left top,left bottom,color-stop(30%,transparent),color-stop(30%,transparent)),-webkit-gradient(linear,left top,left bottom,color-stop(0,rgba(0,0,0,.25)),color-stop(40%,transparent));background:linear-gradient(transparent 30%,transparent 0),linear-gradient(rgba(0,0,0,.25),transparent 40%);background-repeat:no-repeat;background-size:100% 40px,100% 10px;background-attachment:local,scroll}navbar .navbar-scroll-container .navbar-content{-webkit-box-flex:1;flex:1 1 auto;padding-top:32px}"],encapsulation:2}),e})();function ve(e,t){1&e&&(I.Xb(0,"div",8),I.Xb(1,"div",9),I.Xb(2,"div",10),I.Sb(3,"div",11),I.Xb(4,"div",12),I.Sb(5,"div",13),I.Wb(),I.Xb(6,"div",14),I.Sb(7,"div",13),I.Wb(),I.Wb(),I.Wb(),I.Wb())}function ke(e,t){if(1&e){const e=I.Yb();I.Xb(0,"fuse-sidebar",15),I.Xb(1,"div",16),I.Xb(2,"shipment-quote-sidebar",17),I.fc("createShipment",(function(t){return I.Bc(e),I.jc().createShipment(t)})),I.Wb(),I.Wb(),I.Wb()}if(2&e){const e=I.jc();I.Db(2),I.pc("quote",e.quote)("partner",e.partner)("user",e.user)("truckPoint",e.truckPoint)}}let qe=(()=>{class e{constructor(e,t,i,n,a,r){this._fuseSidebarService=e,this.authService=t,this.shipmentService=i,this.datePipe=n,this.router=a,this.route=r,this.height=560,this.sumRevenue=[],this.sumCost=[],this.currencyProfit=[],this.sidebarPanel=!0,this.requestProcessing=!1,this._unsubscribeAll=new R.a}ngOnInit(){if(this.id=this.route.snapshot.params.id,this.authService.windowSizeChanged.pipe(Object(F.takeUntil)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-62-12}),this.authService.changeScreen.pipe(Object(F.takeUntil)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-62-12:this.authService.screenHeight-64-62-12}),this.shipmentService.onDataChanged.pipe(Object(F.takeUntil)(this._unsubscribeAll)).subscribe(e=>{this.truckPoint=this.shipmentService.truckPoint,this.price=this.shipmentService.price,this.currency=this.shipmentService.currency,this.country=this.shipmentService.country,this.partner=this.shipmentService.partner,this.user=this.shipmentService.user}),this.shipmentService.onQuoteChanged.pipe(Object(F.takeUntil)(this._unsubscribeAll)).subscribe(e=>{this.quote=e[0][0],this.quote.quote=e[1],this.quote.quote_cost=e[2],this.getCurrencyProfit(this.quote)}),this.authService.permissionModul)this.permission=this.authService.permissionModul;else{let e=this.router.routerState.snapshot.url.split("/")[2];this.permission=this.authService.getAction(e)}}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}getCurrencyProfit(e){function t(e){return 5.26==e&&(e=.05/.95*100),e}this.currencyProfit=[],this.sumRevenue=[],this.sumCost=[];let i=JSON.parse(JSON.stringify(e));if(i.quote.length>0)for(let n=0;n<i.quote.length;++n){let e=i.quote[n],a=this.currency.find(t=>t.id==e.currency);if(a&&!this.currencyProfit.includes(a.code)&&(this.currencyProfit.push(a.code),this.sumRevenue.push({amount:0,tax:0,total:0,currency:a.code}),this.sumCost.push({amount:0,tax:0,total:0,currency:a.code})),a){let i=this.sumRevenue.find(e=>e.currency==a.code);i.amount+=e.volume*e.amount,i.tax+=e.volume*e.amount*t(e.tax)/100,i.total+=e.volume*e.amount*(1+t(e.tax)/100)}}if(i.quote_cost.length>0)for(let n=0;n<i.quote_cost.length;++n){let e=i.quote_cost[n],a=this.currency.find(t=>t.id==e.currency);if(a&&!this.currencyProfit.includes(a.code)&&(this.currencyProfit.push(a.code),this.sumRevenue.push({amount:0,tax:0,total:0,currency:a.code}),this.sumCost.push({amount:0,tax:0,total:0,currency:a.code})),a){let i=this.sumCost.find(e=>e.currency==a.code);i.amount+=e.volume*e.amount,i.tax+=e.volume*e.amount*t(e.tax)/100,i.total+=e.volume*e.amount*(1+t(e.tax)/100)}}}createShipment(e){e.pick_date=e.pick_date?this.datePipe.transform(new Date(e.pick_date),"yyyy-MM-dd")+" 00:00:00":null,e.deliver_date=e.deliver_date?this.datePipe.transform(new Date(e.deliver_date),"yyyy-MM-dd")+" 23:59:00":null,e.manage_date=e.manage_date?this.datePipe.transform(new Date(e.manage_date),"yyyy-MM-dd")+" 23:59:00":null,e.create_by=this.authService.user,this.shipment=e;let t={shipment:this.shipment,quote:this.quote};this.requestProcessing=!0,this.shipmentService.createDnlShipmentQuote(t).then(e=>{this.requestProcessing=!1,e.shipment.insertId>0?this.router.navigate(["/apps/workflow/shipment/detail/"+e.shipment.insertId+"/soa"]):(alert("ERROR"),console.error(e))}).catch(e=>{this.requestProcessing=!1,alert("ERROR"),console.error(e)})}deleteItem(e){}toggleSidebar(e){this._fuseSidebarService.getSidebar(e).toggleOpen()}showHideBar(e){this.sidebarPanel=!this.sidebarPanel}refreshPage(e){this.authService.refreshData(this.shipmentService)}}return e.\u0275fac=function(t){return new(t||e)(I.Rb(M.a),I.Rb(O.a),I.Rb(A),I.Rb(N.f),I.Rb(n.g),I.Rb(n.a))},e.\u0275cmp=I.Lb({type:e,selectors:[["shipment-quote"]],decls:8,vars:8,consts:[["class","spinner-wrapper",4,"ngIf"],[1,"page-layout","simple","left-sidebar","inner-scroll"],["class","sidebar","name","shipment-quote-sidebar","position","left","lockedOpen","gt-md",4,"ngIf"],["fusePerfectScrollbar","",1,"center"],[3,"sidebarName","showHideBar","refreshPage","toggleSidebar"],[1,"content","pl-8","pt-8"],[2,"overflow","auto"],[3,"quote","sumRevenue","sumCost","deleteItem"],[1,"spinner-wrapper"],[1,"spinner"],[1,"inner"],[1,"gap"],[1,"left"],[1,"half-circle"],[1,"right"],["name","shipment-quote-sidebar","position","left","lockedOpen","gt-md",1,"sidebar"],[1,"content"],[3,"quote","partner","user","truckPoint","createShipment"]],template:function(e,t){1&e&&(I.Jc(0,ve,8,0,"div",0),I.Xb(1,"div",1),I.Jc(2,ke,3,4,"fuse-sidebar",2),I.Xb(3,"div",3),I.Xb(4,"shipment-quote-header",4),I.fc("showHideBar",(function(e){return t.showHideBar(e)}))("refreshPage",(function(e){return t.refreshPage(e)}))("toggleSidebar",(function(e){return t.toggleSidebar(e)})),I.Wb(),I.Xb(5,"div",5),I.Xb(6,"div",6),I.Xb(7,"shipment-quote-content",7),I.fc("deleteItem",(function(e){return t.deleteItem(e)})),I.Wb(),I.Wb(),I.Wb(),I.Wb(),I.Wb()),2&e&&(I.pc("ngIf",t.requestProcessing),I.Db(2),I.pc("ngIf",t.sidebarPanel),I.Db(2),I.pc("sidebarName","shipment-quote-sidebar"),I.Db(2),I.Ic("height",t.height,"px"),I.Db(1),I.pc("quote",t.quote)("sumRevenue",t.sumRevenue)("sumCost",t.sumCost))},directives:[N.t,j.a,z.a,Q,Z,ee.a,xe],styles:[""]}),e})();i.d(t,"ShipmentQuoteModule",(function(){return we}));const ye=[{path:":id",component:qe,resolve:{data:A}}];let we=(()=>{class e{}return e.\u0275mod=I.Pb({type:e}),e.\u0275inj=I.Ob({factory:function(t){return new(t||e)},providers:[A],imports:[[n.k.forChild(ye),r.b,a.a,o.b,s.c,c.c,b.b,l.e,u.b,p.b,h.c,m.c,d.b,f.c,g.e,x.b,v.b,k.b,q.d,y.e,w.b,X.b,S.b,D.k,W.t,_.a,L.f]]}),e})()}}]);