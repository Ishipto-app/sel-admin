(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{JUHC:function(e,t,i){"use strict";i.r(t);var r=i("tyNb"),o=i("ofXK"),a=i("nmyD"),n=i("STbY"),c=i("/1cH"),s=i("iadO"),l=i("bTqV"),b=i("jaxi"),p=i("7EHt"),m=i("kmnG"),u=i("NFeN"),h=i("Qu3c"),d=i("qFsG"),f=i("wZkO"),v=i("d3UM"),g=i("QibW"),y=i("0IaG"),x=i("/t3+"),S=i("bSwM"),X=i("M9IT"),W=i("xHqg"),I=i("A5z7"),w=i("bv9b"),k=i("XhcP"),_=i("1jcm"),L=i("+0xr"),C=i("vxfF"),D=i("cfqv"),A=i("dNgK"),P=i("5HBU"),F=i("LPQX"),R=i("yrbL"),j=i("XNiG"),O=i("fXoL"),M=i("HX77"),T=i("qXBG"),q=i("2Vo4"),N=i("tk/3");let z=(()=>{class e{constructor(e,t,i){this._httpClient=e,this.authService=t,this.datePipe=i,this.country={},this.party={},this.customer={},this.supplier={},this.price={},this.unit={},this.currency={},this.user={},this.partymisa={},this.customermisa={},this.suppliermisa={},this.pricemisa={},this.selInvoice={},this.selRevenueInvoice={},this.selCostInvoice={},this.objContainer={},this.onDataChanged=new q.a([]),this.onDataViewChanged=new q.a([]),this.onFileImportInvoiceChanged=new q.a([]),this.onFileSearchChanged=new q.a({}),this.onRequestProcessingChanged=new q.a(!1),this.onMovementChanged=new q.a([])}resolve(e){return this.authService.routerData=e,new Promise((e,t)=>{Promise.all([this.getData()]).then(()=>{e()},t)})}getFileImportInvoiceById(e){let t={headers:new N.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,r)=>{this._httpClient.get(this.authService.apiUrl+"/sel/fileImport/id/"+e,t).subscribe(e=>{this.fileImport=e,this.onFileImportInvoiceChanged.next(e),i(e)},r)})}getData(){let e={headers:new N.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((t,i)=>{this._httpClient.get(this.authService.apiUrl+"/sel/sel-invoice/data",e).subscribe(e=>{e[0].map(e=>{this.country[e.id]=e}),this.customerArr=e[1],e[1].map(e=>{this.customer[e.id]=e}),this.supplierArr=e[2],e[2].map(e=>{this.supplier[e.id]=e}),this.priceArr=e[3],e[3].map(e=>{this.price[e.id]=e}),e[4].map(e=>{this.unit[e.id]=e}),e[5].map(e=>{this.currency[e.code]=e}),e[6].map(e=>{this.user[e.id]=e}),e[7].map(e=>{this.selRevenueInvoice[e.keydate]=e}),e[8].map(e=>{this.selCostInvoice[e.keydate]=e}),e[9].map(e=>{this.customermisa[e.misa_party]=e}),e[10].map(e=>{this.suppliermisa[e.misa_party]=e}),e[11].map(e=>{this.pricemisa[e.misa_price]=e}),this.type=[{id:1,code:"MM/dd/yyyy",yearFirst:!0,month:0,day:1,year:2},{id:2,code:"dd/MM/yyyy",yearFirst:!0,month:1,day:0,year:2}];let i="AA/"+((new Date).getFullYear()-2e3).toString()+"E",r="IMP"+this.datePipe.transform(new Date,"MM-dd-yyyy");this.invoiceType=[{id:1,type:"revenue",invoiceCode:i,column:[5,1,4,6,8,9,10,11,12,13,14],dateType:2,range:"A1:S1000",header:!0},{id:2,type:"cost",invoiceCode:r,column:[5,1,4,6,8,9,10,11,12,13,14],dateType:2,range:"A1:U1000",header:!0}],this.onDataChanged.next(e),t(e)},i)})}createInvoice(e,t){let i={headers:new N.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((r,o)=>{this._httpClient.post(this.authService.apiUrl+"/sel/sel-invoice/inv/"+t,e,i).subscribe(e=>{r(e)},o)})}createPartymisa(e,t){let i={headers:new N.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((r,o)=>{this._httpClient.post(this.authService.apiUrl+"/sel/sel-invoice/partymisa/"+t,e,i).subscribe(e=>{r(e)},o)})}createPricemisa(e){let t={headers:new N.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((i,r)=>{this._httpClient.post(this.authService.apiUrl+"/sel/sel-invoice/pricemisa",e,t).subscribe(e=>{i(e)},r)})}deleteSelInvoice(e,t){let i={headers:new N.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((r,o)=>{this._httpClient.delete(this.authService.apiUrl+"/sel/sel-invoice/inv/"+t+"/"+e,i).subscribe(e=>{r(e)},o)})}getDateTime(e,t){if("string"==typeof e){let i,r,o=this.type.find(e=>e.id==t.dateType),a=e.split(/[./-]+/);return r=e.match(/^\d{1,2}[./-]\d{1,2}[./-]\d{4}$/g),i=r?i=new Date(a[o.year],a[o.month]-1,a[o.day]):null,i}if(e>25569&&e<365*((new Date).getFullYear()-1970+1)+25569){let t=new Date(86400*(e-25569)*1e3+6e4*(new Date).getTimezoneOffset()+500);return this.datePipe.transform(t,"HH:mm"),t}return null}dateToString(e){let t=(e=new Date(e)).getMonth(),i=e.getDate(),r=e.getFullYear(),o=(t+1<10?"0":"")+(t+1).toString();return o+="/"+(i+1<10?"0":"")+i.toString(),o+="/"+r.toString(),o}createData(e,t,i){let r=[],o=[],a="revenue"==t.invoice_type?"customer":"supplier";return this.partymisa="revenue"==t.invoice_type?this.customermisa:this.suppliermisa,this.party="revenue"==t.invoice_type?this.customer:this.supplier,this.selInvoice="revenue"==t.invoice_type?this.selRevenueInvoice:this.selCostInvoice,e.map((e,i)=>{if(this.checkHeader(i,t)){let i=this.partymisa[e[t.column.party-1]],n=i?this.party[i[a]]:null,c=this.pricemisa[e[t.column.price-1]],s=c?this.price[c.price]:null,l=this.getDateTime(e[t.column.issue_date-1],t),b=e[t.column.t_amount-1]?e[t.column.t_tax-1]/e[t.column.t_amount-1]*100:0;switch(!0){case b<5:b=0;break;case b>=5&&b<5.26:b=5;break;case b>=5.26&&b<6:b=5.26;break;case b>=6&&b<7.5:b=7;break;case b>=7&&b<8.5:b=8;break;default:b=10}let p=(e[t.column.invoice_number-1]?e[t.column.invoice_number-1]:"")+"-"+(n?n.id:"")+(l?"-"+this.dateToString(l):"");r.includes(p)?(o[o.length-1].amount+=e[t.column.t_amount-1]*e[t.column.exrate-1],o[o.length-1].tax+=e[t.column.t_tax-1]*e[t.column.exrate-1],o[o.length-1].itemPrice.push({price_misa:e[t.column.price-1],price_name:e[t.column.price],unit_misa:e[t.column.unit-1],price:s,unit:s?this.unit[s.unit]:null,volume:e[t.column.volume-1],amount:e[t.column.amount-1],t_amount:e[t.column.t_amount-1],tax:b,t_tax:e[t.column.t_tax-1],currency:1==e[t.column.exrate-1]?this.currency.VND:this.currency.USD,ex_rate:e[t.column.exrate-1],update_by:this.authService.user})):(r.push(p),o.push({invoice_number:e[t.column.invoice_number-1],invoice_code:t.invoice_code,party_misa:e[t.column.party-1],party_name:("revenue"==t.invoice_type?e[14]+"-":"")+e[t.column.party],party:n,amount:e[t.column.t_amount-1]*e[t.column.exrate-1],tax:e[t.column.t_tax-1]*e[t.column.exrate-1],payment_center:n?this.country[n.country]:null,issue_date:l,status:1,info:e[t.column.info-1],data_expand:!1,itemPrice:[{price_misa:e[t.column.price-1],price_name:e[t.column.price],unit_misa:e[t.column.unit-1],price:s,unit:s?this.unit[s.unit]:null,volume:e[t.column.volume-1],amount:e[t.column.amount-1],t_amount:e[t.column.t_amount-1],tax:b,t_tax:e[t.column.t_tax-1],currency:1==e[t.column.exrate-1]?this.currency.VND:this.currency.USD,ex_rate:e[t.column.exrate-1],update_by:this.authService.user}],duplicate:this.selInvoice[p]?this.selInvoice[p]:null,type:"revenue"==t.invoice_type?1:-1,error:"",create_by:this.authService.user}))}}),o.map(e=>{this.checkError(e)}),this.dataView=o,o}checkHeader(e,t){return!t.header||e>0}checkError(e){e.error="";for(let i in e)"status"!=i&&"data_expand"!=i&&"error"!=i&&"duplicate"!=i&&"party"!=i&&(e[i]||"info"==i||"amount"==i||"tax"==i||(e.error+="error: "+i+" "));e.itemPrice.map(t=>{for(let i in t)"unit"!=i&&"pay_date"!=i&&"info"!=i&&(t[i]||0==t[i]||e.error.includes("errorPrice: "+i)||(e.error+="errorPrice: "+i+" "))});let t=(e.invoice_number?e.invoice_number:"")+"-"+(e.party?e.party.id:"")+(e.issue_date?"-"+this.dateToString(e.issue_date):"");e.duplicate=this.selInvoice[t]?this.selInvoice[t]:null,e.duplicate&&(e.error+="error: duplicate")}}return e.\u0275fac=function(t){return new(t||e)(O.bc(N.a),O.bc(T.a),O.bc(o.f))},e.\u0275prov=O.Nb({token:e,factory:e.\u0275fac}),e})();var B=i("B9zo"),J=i("EwFO"),E=i("3Pt+"),V=i("1G5W"),H=i("Kj3r"),U=i("/uUt"),G=i("0JVi"),$=i("vI/F"),Y=i("XiUz"),Q=i("znSr");const Z=["googleSheet"];function K(e,t){1&e&&(O.Xb(0,"span"),O.Lc(1,"Error:\xa0"),O.Wb())}function ee(e,t){if(1&e&&(O.Xb(0,"span",20),O.Lc(1,"Error\xa0"),O.Wb()),2&e){const e=O.jc();O.pc("matTooltip",e.errorMessage.value)("matTooltipPosition","left")}}function te(e,t){1&e&&(O.Xb(0,"span"),O.Lc(1,"Success\xa0"),O.Wb())}function ie(e,t){if(1&e){const e=O.Yb();O.Xb(0,"button",21),O.fc("click",(function(t){return O.Bc(e),O.jc().openPicker()})),O.Xb(1,"span"),O.Lc(2,"Get file2"),O.Wb(),O.Wb()}}function re(e,t){if(1&e){const e=O.Yb();O.Xb(0,"button",22),O.fc("click",(function(t){O.Bc(e);const i=O.jc();return t.stopPropagation(),i.changeScreen(!0)})),O.Xb(1,"mat-icon"),O.Lc(2,"flip_to_front"),O.Wb(),O.Wb()}}function oe(e,t){if(1&e){const e=O.Yb();O.Xb(0,"button",22),O.fc("click",(function(t){O.Bc(e);const i=O.jc();return t.stopPropagation(),i.changeScreen(!1)})),O.Xb(1,"mat-icon"),O.Lc(2,"flip_to_back"),O.Wb(),O.Wb()}}const ae=function(e,t){return{"red-600-fg":e,"green-600-fg":t}},ne=function(e){return{hide:e}};let ce=(()=>{class e{constructor(e,t,i){this.authService=e,this._fuseConfigService=t,this.googleApiService=i,this.collapsed=!0,this.fullScreen=!1,this.toggleSidebar=new O.o,this.showHideBar=new O.o,this.refreshPage=new O.o,this.input=new O.o,this.sheetProperties=[],this._unsubscribeAll=new j.a}ngOnInit(){this.searchInput=new E.e(""),this.searchInput.valueChanges.pipe(Object(V.a)(this._unsubscribeAll),Object(H.a)(300),Object(U.a)()).subscribe(e=>{this.input.emit(e)}),this.googleApiService.onFormChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.validForm=this.googleApiService.validForm}),this.googleApiService.stepChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.step=e})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}ngAfterViewInit(){this.googleApiService.onGapiChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.auth=e,this.attachSignin()}),this.googleApiService.onFileDataChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{})}changeScreen(e){this.fullScreen=e,this.authService.changeScreen.next(e),this._fuseConfigService.config=this.fullScreen?{layout:{navbar:{hidden:!0},toolbar:{hidden:!0},footer:{hidden:!0},sidepanel:{hidden:!0}}}:{layout:{navbar:{hidden:!1},toolbar:{hidden:!1},footer:{hidden:!0},sidepanel:{hidden:!0}}}}collapse(){this.collapsed=!0}expand(){this.collapsed=!1}attachSignin(){this.auth.attachClickHandler(this.googleSheet._elementRef.nativeElement,{},e=>{this.token=this.googleApiService.token=e.getAuthResponse().access_token,this.googleApiService.createPicker()},(function(e){alert("ERROR"),console.error(e)}))}openPicker(){this.googleApiService.createPicker()}checkForm(){this.googleApiService.onValidateForm.next(!0)}}return e.\u0275fac=function(t){return new(t||e)(O.Rb(T.a),O.Rb(G.b),O.Rb($.a))},e.\u0275cmp=O.Lb({type:e,selectors:[["file-import-invoice-header"]],viewQuery:function(e,t){var i;1&e&&O.Sc(Z,!0),2&e&&O.wc(i=O.gc())&&(t.googleSheet=i.first)},inputs:{sidebarName:"sidebarName",errorMessage:"errorMessage",spreadsheetId:"spreadsheetId"},outputs:{toggleSidebar:"toggleSidebar",showHideBar:"showHideBar",refreshPage:"refreshPage",input:"input"},decls:35,vars:21,consts:[[1,"p-0","mat-elevation-z1"],["fxFlex","","fxFill","","fxLayout","row","fxLayoutAlign","start center"],["fxFlex","1 0 auto","fxLayout","row","fxLayoutAlign","start center"],[1,"px-8","px-md-16"],["mat-icon-button","","fxHide.gt-sm","","fxFlex","10","fxFlex.gt-sm","0",1,"sidebar-toggle","mr-12",3,"click"],["mat-icon-button","","fxHide","","fxShow.gt-sm","","fxFlex","10","fxFlex.gt-sm","0",1,"sidebar-toggle","mr-12",3,"click"],["fxHide","","fxShow.gt-sm","",1,"m-8","font-size-12",3,"ngClass"],[4,"ngIf"],["fxHide.gt-sm","",1,"m-8","font-size-12",3,"ngClass"],[3,"matTooltip","matTooltipPosition",4,"ngIf"],["fxFlex","0 1 auto","fxLayout","row","fxLayoutAlign","start center",1,""],[1,"toolbar-separator"],["type","button","mat-raised-button","","color","accent","id","googleSheet",1,"m-8",3,"ngClass"],["googleSheet",""],["type","button","mat-raised-button","","color","accent","id","googleSheet2",1,"m-8",3,"ngClass","click"],["type","button","mat-raised-button","","color","accent","class","m-8","id","googleSheet3",3,"click",4,"ngIf"],["mat-icon-button","",1,"ml-8","mr-8",3,"click"],["color","accent"],["mat-icon-button","","class","ml-8",3,"click",4,"ngIf"],["fxHide","","fxShow.gt-xs","",1,"toolbar-separator"],[3,"matTooltip","matTooltipPosition"],["type","button","mat-raised-button","","color","accent","id","googleSheet3",1,"m-8",3,"click"],["mat-icon-button","",1,"ml-8",3,"click"]],template:function(e,t){1&e&&(O.Xb(0,"mat-toolbar",0),O.Xb(1,"div",1),O.Xb(2,"div",2),O.Xb(3,"div",3),O.Xb(4,"button",4),O.fc("click",(function(e){return t.toggleSidebar.emit(t.sidebarName)})),O.Xb(5,"mat-icon"),O.Lc(6,"menu"),O.Wb(),O.Wb(),O.Xb(7,"button",5),O.fc("click",(function(e){return t.showHideBar.emit()})),O.Xb(8,"mat-icon"),O.Lc(9,"menu"),O.Wb(),O.Wb(),O.Wb(),O.Xb(10,"div",6),O.Jc(11,K,2,0,"span",7),O.Xb(12,"span"),O.Lc(13),O.Wb(),O.Wb(),O.Xb(14,"div",8),O.Jc(15,ee,2,2,"span",9),O.Jc(16,te,2,0,"span",7),O.Wb(),O.Wb(),O.Xb(17,"div",10),O.Sb(18,"div",11),O.Xb(19,"button",12,13),O.Xb(21,"span"),O.Lc(22,"Get file"),O.Wb(),O.Wb(),O.Xb(23,"button",14),O.fc("click",(function(e){return t.checkForm()})),O.Xb(24,"span"),O.Lc(25,"Get file1"),O.Wb(),O.Wb(),O.Jc(26,ie,3,0,"button",15),O.Sb(27,"div",11),O.Xb(28,"button",16),O.fc("click",(function(e){return e.stopPropagation(),t.refreshPage.emit()})),O.Xb(29,"mat-icon",17),O.Lc(30,"refresh"),O.Wb(),O.Wb(),O.Sb(31,"div",11),O.Jc(32,re,3,0,"button",18),O.Jc(33,oe,3,0,"button",18),O.Sb(34,"div",19),O.Wb(),O.Wb(),O.Wb()),2&e&&(O.Db(10),O.pc("ngClass",O.sc(11,ae,t.errorMessage.status,!t.errorMessage.status)),O.Db(1),O.pc("ngIf",t.errorMessage.status),O.Db(2),O.Mc(t.errorMessage.value),O.Db(1),O.pc("ngClass",O.sc(14,ae,t.errorMessage.status,!t.errorMessage.status)),O.Db(1),O.pc("ngIf",t.errorMessage.status),O.Db(1),O.pc("ngIf",!t.errorMessage.status&&t.errorMessage.value),O.Db(3),O.pc("ngClass",O.rc(17,ne,t.token||!t.validForm||0!=t.step)),O.Db(4),O.pc("ngClass",O.rc(19,ne,t.validForm||0!=t.step)),O.Db(3),O.pc("ngIf",t.validForm&&t.token&&0==t.step),O.Db(6),O.pc("ngIf",!t.fullScreen),O.Db(1),O.pc("ngIf",t.fullScreen))},directives:[x.a,Y.b,Y.e,Y.d,Y.c,l.b,Q.b,u.a,o.q,Q.a,o.t,h.a],styles:["file-import-invoice-header{position:relative;display:-webkit-box;display:flex;-webkit-box-flex:0;flex:0 0 auto;z-index:4}file-import-invoice-header.below{z-index:2}file-import-invoice-header .mat-toolbar{position:relative;background:#fff!important;color:inherit!important}file-import-invoice-header .logo{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}file-import-invoice-header .logo .logo-icon{width:38px}file-import-invoice-header .chat-panel-toggle-button,file-import-invoice-header .language-button,file-import-invoice-header .quick-panel-toggle-button,file-import-invoice-header .user-button,file-import-invoice-header fuse-search-bar{min-width:64px;height:64px}@media screen and (max-width:599px){file-import-invoice-header .chat-panel-toggle-button,file-import-invoice-header .language-button,file-import-invoice-header .quick-panel-toggle-button,file-import-invoice-header .user-button,file-import-invoice-header fuse-search-bar{height:56px}}file-import-invoice-header .navbar-toggle-button{min-width:56px;height:56px}file-import-invoice-header .toolbar-separator{height:64px;width:1px;background:#e6e6e6}@media screen and (max-width:599px){file-import-invoice-header .toolbar-separator{height:56px}}file-import-invoice-header #fileImport-detail-search-bar{display:-webkit-box;display:flex;-webkit-box-flex:0;flex:0 1 auto;min-width:64px;height:64px;font-size:13px}@media screen and (max-width:599px){file-import-invoice-header #fileImport-detail-search-bar{height:56px}}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content{display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 1 auto;-webkit-box-align:center;align-items:center;-webkit-box-pack:start;justify-content:flex-start}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-collapser,file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-expander{cursor:pointer;padding:0 20px;margin:0;width:64px!important;height:64px!important;line-height:64px!important}@media screen and (max-width:599px){file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-collapser,file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-expander{height:56px!important;line-height:56px!important}}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-loader{width:64px!important;height:64px!important;line-height:64px!important}@media screen and (max-width:599px){file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-loader{height:56px!important;line-height:56px!important}}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-collapser{display:none}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content #fileImport-detail-search-bar-input{display:none;-webkit-box-flex:1;flex:1 0 auto;min-height:64px;font-size:16px;background-color:transparent;color:currentColor}file-import-invoice-header #fileImport-detail-search-bar.expanded{position:absolute;top:0;right:0;bottom:0;left:0;z-index:10;background:#f5f5f5}file-import-invoice-header #fileImport-detail-search-bar.expanded .fileImport-detail-search-bar-content #fileImport-detail-search-bar-input{display:-webkit-box;display:flex}file-import-invoice-header #fileImport-detail-search-bar.expanded .fileImport-detail-search-bar-content .fileImport-detail-search-bar-collapser{display:block}"],encapsulation:2}),e})();var se=i("fE3o"),le=i("0Zc1");const be=function(e,t,i,r){return{current:e,completed:t,last:i,first:r}};function pe(e,t){if(1&e){const e=O.Yb();O.Xb(0,"div",5),O.fc("click",(function(i){O.Bc(e);const r=t.index;return O.jc().gotoStep(r)})),O.Xb(1,"div",6),O.Xb(2,"span"),O.Lc(3),O.Wb(),O.Wb(),O.Xb(4,"div",7),O.Lc(5),O.Wb(),O.Wb()}if(2&e){const e=t.$implicit,i=t.index,r=t.last,o=t.first,a=O.jc();O.pc("ngClass",O.uc(3,be,a.currentStep===i,a.currentStep>i,r,o)),O.Db(3),O.Mc(i+1),O.Db(2),O.Mc(e.title)}}let me=(()=>{class e{constructor(e,t,i,r,o){this.formBuilder=e,this.authService=t,this.router=i,this.commonService=r,this.googleApiService=o,this.getUpdate=new O.o,this.viewChanged=new O.o,this.height=560,this.steps=[{title:"Set info import",url:"/apps/sel-admin/invoice-import/file-import/view"},{title:"Import to server",url:"/apps/sel-admin/invoice-import/file-import/table"}],this._unsubscribeAll=new j.a}ngOnInit(){this.currentStep=0,this.authService.windowSizeChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-64-12}),this.authService.changeScreen.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-64-12:this.authService.screenHeight-64-64-12}),this.googleApiService.stepChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.changeStep(e)})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}gotoStep(e){0==e&&this.googleApiService.stepChanged.next(e)}changeStep(e){this.currentStep!=e&&this.router.navigate([this.steps[e].url]),this.currentStep=e}}return e.\u0275fac=function(t){return new(t||e)(O.Rb(E.d),O.Rb(T.a),O.Rb(r.g),O.Rb(le.a),O.Rb($.a))},e.\u0275cmp=O.Lb({type:e,selectors:[["file-import-invoice-sidebar"]],inputs:{view:"view",column:"column",supplier:"supplier",moveType:"moveType"},outputs:{getUpdate:"getUpdate",viewChanged:"viewChanged"},decls:5,vars:3,consts:[[1,"navbar-top"],["fxLayout","row","fxLayoutAlign","space-between center"],["fusePerfectScrollbar","",1,"navbar-scroll-fileImport"],[1,"steps"],["class","step",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"step",3,"ngClass","click"],[1,"index"],[1,"title"]],template:function(e,t){1&e&&(O.Xb(0,"div",0),O.Sb(1,"div",1),O.Wb(),O.Xb(2,"div",2),O.Xb(3,"div",3),O.Jc(4,pe,6,8,"div",4),O.Wb(),O.Wb()),2&e&&(O.Db(2),O.Ic("height",t.height,"px"),O.Db(2),O.pc("ngForOf",t.steps))},directives:[Y.d,Y.c,J.a,o.s,o.q,Q.a],styles:['file-import-invoice-sidebar .navbar-top{background:#fff!important;padding:13px 0;-webkit-box-pack:center;justify-content:center;height:65px;border-bottom:1px solid #a3a3a3}file-import-invoice-sidebar .navbar-scroll-fileImport{background:#fff!important}file-import-invoice-sidebar .navbar-scroll-fileImport .steps{padding:16px 0}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step{position:relative;display:-webkit-box;display:flex;-webkit-box-pack:start;justify-content:flex-start;-webkit-box-align:center;align-items:center;padding:16px;cursor:pointer}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.current .index span{border:2px solid}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.current .title{font-weight:700}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.completed .index span{border:2px solid}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.first .index:before,file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.last .index:after{display:none}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index{display:-webkit-box;display:flex;margin-right:12px}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index:after,file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index:before{position:absolute;display:block;content:" ";border-left:1px solid;width:1px;height:50%;left:29px;z-index:8}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index:before{top:0}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index:after{bottom:0}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index span{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;position:relative;width:28px;min-width:28px;max-width:28px;height:28px;border-radius:100%;border:2px solid;font-weight:700;font-size:12px;z-index:10}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .title,navbar .navbar-top{display:-webkit-box;display:flex}navbar .navbar-top{-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-flex:1;flex:1 0 auto;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;min-height:64px;max-height:64px;height:64px;padding:12px 12px 12px 20px}@media screen and (max-width:599px){navbar .navbar-top{min-height:56px;max-height:56px;height:56px}}navbar .navbar-scroll-fileImport{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-flex:1;flex:1 1 auto;overflow-y:auto;-webkit-overflow-scrolling:touch;background:-webkit-gradient(linear,left top,left bottom,color-stop(30%,transparent),color-stop(30%,transparent)),-webkit-gradient(linear,left top,left bottom,color-stop(0,rgba(0,0,0,.25)),color-stop(40%,transparent));background:linear-gradient(transparent 30%,transparent 0),linear-gradient(rgba(0,0,0,.25),transparent 40%);background-repeat:no-repeat;background-size:100% 40px,100% 10px;background-attachment:local,scroll}navbar .navbar-scroll-fileImport .navbar-content{-webkit-box-flex:1;flex:1 1 auto;padding-top:32px}'],encapsulation:2}),e})();function ue(e,t){1&e&&(O.Xb(0,"fuse-sidebar",6),O.Xb(1,"div",7),O.Sb(2,"file-import-invoice-sidebar"),O.Wb(),O.Wb())}function he(e,t){1&e&&O.Sb(0,"router-outlet")}let de=(()=>{class e{constructor(e,t,i,r,o,a){this._fuseSidebarService=e,this.authService=t,this.fileImportService=i,this.router=r,this.route=o,this.datePipe=a,this.height=560,this.sidebarPanel=!0,this.errorMessage={status:!1,value:""},this._unsubscribeAll=new j.a}ngOnInit(){this.id="test",this.authService.windowSizeChanged.pipe(Object(R.takeUntil)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-12-12-54-62}),this.authService.changeScreen.pipe(Object(R.takeUntil)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-12-12-54-62:this.authService.screenHeight-64-12-12-54-62})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}toggleSidebar(e){this._fuseSidebarService.getSidebar(e).toggleOpen()}newFileImportInvoice(e){this.router.navigate(["/apps/workflow/fileImport/list"])}showHideBar(e){this.sidebarPanel=!this.sidebarPanel}refreshPage(e){this.authService.refreshData(this.fileImportService)}}return e.\u0275fac=function(t){return new(t||e)(O.Rb(M.a),O.Rb(T.a),O.Rb(z),O.Rb(r.g),O.Rb(r.a),O.Rb(o.f))},e.\u0275cmp=O.Lb({type:e,selectors:[["file-import-invoice"]],decls:6,vars:5,consts:[["id","file-import-invoice",1,"page-layout","simple","left-sidebar","inner-scroll"],["class","sidebar","name","file-import-invoice-sidebar","position","left","lockedOpen","gt-md",4,"ngIf"],["fusePerfectScrollbar","",1,"center"],[3,"sidebarName","spreadsheetId","errorMessage","showHideBar","refreshPage","toggleSidebar"],[1,"content","p-8",2,"background","white"],[4,"ngIf"],["name","file-import-invoice-sidebar","position","left","lockedOpen","gt-md",1,"sidebar"],[1,"content"]],template:function(e,t){1&e&&(O.Xb(0,"div",0),O.Jc(1,ue,3,0,"fuse-sidebar",1),O.Xb(2,"div",2),O.Xb(3,"file-import-invoice-header",3),O.fc("showHideBar",(function(e){return t.showHideBar(e)}))("refreshPage",(function(e){return t.refreshPage(e)}))("toggleSidebar",(function(e){return t.toggleSidebar(e)})),O.Wb(),O.Xb(4,"div",4),O.Jc(5,he,1,0,"router-outlet",5),O.Wb(),O.Wb(),O.Wb()),2&e&&(O.Db(1),O.pc("ngIf",t.sidebarPanel),O.Db(2),O.pc("sidebarName","file-import-invoice-sidebar")("spreadsheetId",t.id)("errorMessage",t.errorMessage),O.Db(2),O.pc("ngIf",!0))},directives:[B.a,o.t,J.a,ce,se.a,me,r.l],styles:[""]}),e})();var fe=i("PVWW");function ve(e){let t=e.value;return""==t?null:t&&t.match(/^[A-Z]\d{1,}[:][A-Z]\d{1,}$/g)?null:{validRange:!0}}const ge=["formDirective"],ye=["googleSheet"];function xe(e,t){if(1&e&&(O.Xb(0,"mat-radio-button",6),O.Xb(1,"span"),O.Lc(2),O.Wb(),O.Wb()),2&e){const e=t.$implicit,i=O.jc();O.pc("value",e.id)("checked",i.form.value.dateType==e.id),O.Db(2),O.Mc(e.code)}}const Se=function(){return{value:"50"}};let Xe=(()=>{class e{constructor(e,t,i,r,o,a,n,c,s){this.router=e,this.route=t,this.authService=i,this.fileImportService=r,this.googleApiService=o,this.datePipe=a,this.formBuilder=n,this.commonService=c,this.ngZone=s,this.data=[],this.height=560,this.spreadsheetId=null,this.form=this.formBuilder.group({invoice_type:["revenue",E.y.required],invoice_code:["AA/"+((new Date).getFullYear()-2e3).toString()+"E",E.y.required],range:["A1:S1000",ve],header:[!0],dateType:[2],column:this.formBuilder.group({invoice_number:[5,E.y.required],issue_date:[4,E.y.required],party:[1,E.y.required],price:[6,E.y.required],unit:[8,E.y.required],volume:[9,E.y.required],amount:[10,E.y.required],t_amount:[11,E.y.required],t_tax:[12,E.y.required],exrate:[13,E.y.required],info:[14,E.y.required]})}),this.sheetProperties=[],this.country={},this.party={},this.price={},this.unit={},this.currency={},this.user={},this.partymisa={},this.pricemisa={},this.selInvoice={},this._unsubscribeAll=new j.a}ngOnInit(){this.authService.windowSizeChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-12-12-54-8}),this.authService.changeScreen.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-12-12-54-8:this.authService.screenHeight-64-12-12-54-8}),this.fileImportService.onDataChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.country=this.fileImportService.country,this.party=this.fileImportService.party,this.price=this.fileImportService.price,this.unit=this.fileImportService.unit,this.currency=this.fileImportService.currency,this.user=this.fileImportService.user,this.partymisa=this.fileImportService.partymisa,this.pricemisa=this.fileImportService.pricemisa,this.selInvoice=this.fileImportService.selInvoice,this.type=this.fileImportService.type,this.invoiceType=this.fileImportService.invoiceType}),this.googleApiService.onFileChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{e&&e.length>0&&this.form.valid?this.ngZone.run(()=>{this.data=e,this.data=this.fileImportService.createData(e,this.form.value,this.selInvoice),this.googleApiService.onFileDataChanged.next([this.data,this.form.value.invoice_type]),this.googleApiService.stepChanged.next(1)}):this.data=[]}),this.googleApiService.onValidateForm.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{e&&this.validateFormDetail(!0)}),this.form.controls.invoice_type.valueChanges.subscribe(e=>{let t=this.invoiceType.find(t=>t.type==e);t&&(this.form.controls.header.setValue(t.header),this.form.controls.invoice_code.setValue(t.invoiceCode),this.form.controls.range.setValue(t.range),this.form.controls.dateType.setValue(t.dateType),this.form.get("column.invoice_number").setValue(t.column[0]),this.form.get("column.party").setValue(t.column[1]),this.form.get("column.issue_date").setValue(t.column[2]),this.form.get("column.price").setValue(t.column[3]),this.form.get("column.unit").setValue(t.column[4]),this.form.get("column.volume").setValue(t.column[5]),this.form.get("column.amount").setValue(t.column[6]),this.form.get("column.t_amount").setValue(t.column[7]),this.form.get("column.t_tax").setValue(t.column[8]),this.form.get("column.exrate").setValue(t.column[9]),this.form.get("column.info").setValue(t.column[10]),this.googleApiService.form=t,this.googleApiService.validForm=this.form.valid,this.googleApiService.onFormChanged.next(this.form.valid))}),this.form.valueChanges.subscribe(e=>{this.form.valid&&"string"!=typeof e.place?(this.googleApiService.form=e,this.googleApiService.validForm=this.form.valid,this.googleApiService.onFormChanged.next(!0)):this.googleApiService.onFormChanged.next(!1)}),this.googleApiService.onFormChanged.next(this.form.valid)}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}ngAfterViewInit(){this.googleApiService.form&&setTimeout(()=>{this.form.patchValue(this.googleApiService.form)})}validateFormDetail(e){!0===e&&(this.markFormGroupTouched(this.form),this.googleApiService.validForm=!1,!0===this.form.valid&&(this.googleApiService.form=this.form.value,this.googleApiService.validForm=!0,this.googleApiService.onFormChanged.next(!0)))}markFormGroupTouched(e){Object.values(e.controls).forEach(e=>{e.markAsTouched(),e.controls&&this.markFormGroupTouched(e)})}checkColumn(e,t){let i=this.form.value.column;i.date==t&&"date"!=e&&this.form.get("column.date").setValue(null),i.transaction==t&&"transaction"!=e&&this.form.get("column.transaction").setValue(null),i.content==t&&"content"!=e&&this.form.get("column.content").setValue(null),i.in==t&&"in"!=e&&this.form.get("column.in").setValue(null),i.out==t&&"out"!=e&&this.form.get("column.out").setValue(null)}}return e.\u0275fac=function(t){return new(t||e)(O.Rb(r.g),O.Rb(r.a),O.Rb(T.a),O.Rb(z),O.Rb($.a),O.Rb(o.f),O.Rb(E.d),O.Rb(le.a),O.Rb(O.A))},e.\u0275cmp=O.Lb({type:e,selectors:[["file-import-invoice-view"]],viewQuery:function(e,t){var i;1&e&&(O.Sc(ge,!0),O.Sc(ye,!0)),2&e&&(O.wc(i=O.gc())&&(t.templaceNgForm=i.first),O.wc(i=O.gc())&&(t.googleSheet=i.first))},decls:158,vars:16,consts:[["fxLayout","column","fxLayoutAlign","start start"],["name","form",1,"w-100-p",2,"overflow","auto",3,"formGroup","keydown.enter"],["formDirective","ngForm"],[1,"simple","table-format","w-100-p"],[1,"h-60"],["formControlName","invoice_type"],[1,"font-size-12","mb-4",3,"value","checked"],["colspan","5"],["appearance","outline",1,"my-form-field"],["matInput","","inputCheck","","formControlName","invoice_code"],[1,"w-240"],["formGroupName","column"],["appearance","outline",1,"my-form-field",2,"width","110px"],["type","number","inputCheck","","matInput","","formControlName","invoice_number","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","issue_date","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","party","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","price","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","unit","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","volume","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","amount","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","t_amount","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","t_tax","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","exrate","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","info","required","",2,"font-size","12px"],["fxLayout","row","fxLayoutAlign","start start"],["fxFlex","20",1,"p-4"],["fxFlex","80","formControlName","dateType","fxLayout","column","fxLayoutAlign","start"],["class","font-size-12 mb-4",3,"value","checked",4,"ngFor","ngForOf"],["appearance","outline","floatLabel","never",1,"my-form-field",2,"width","230px"],["matInput","","inputCheck","","formControlName","range","placeholder","Example: A1:C10 OR None","maxlength","11"],[1,"text-right"],[1,"mr-16"],["colspan","8"],["formControlName","header","fxLayout","row","fxLayoutAlign","start"],[3,"value","checked"],[1,"ml-4",3,"value"]],template:function(e,t){1&e&&(O.Xb(0,"div",0),O.Xb(1,"form",1,2),O.fc("keydown.enter",(function(e){return"TEXTAREA"==e.target.tagName})),O.Xb(3,"table",3),O.Xb(4,"thead"),O.Xb(5,"tr",4),O.Xb(6,"th"),O.Lc(7,"Invoice"),O.Wb(),O.Xb(8,"th"),O.Xb(9,"mat-radio-group",5),O.Xb(10,"mat-radio-button",6),O.Lc(11,"Revenue"),O.Wb(),O.Wb(),O.Wb(),O.Xb(12,"th"),O.Xb(13,"mat-radio-group",5),O.Xb(14,"mat-radio-button",6),O.Lc(15,"Cost"),O.Wb(),O.Wb(),O.Wb(),O.Sb(16,"th"),O.Sb(17,"th"),O.Sb(18,"th"),O.Wb(),O.Xb(19,"tr"),O.Xb(20,"th"),O.Lc(21,"Invoice code"),O.Wb(),O.Xb(22,"th",7),O.Xb(23,"mat-form-field",8),O.Sb(24,"input",9),O.Wb(),O.Wb(),O.Wb(),O.Xb(25,"tr",4),O.Xb(26,"th"),O.Lc(27,"SHEET"),O.Wb(),O.Xb(28,"th",10),O.Lc(29,"Column 1"),O.Wb(),O.Xb(30,"th"),O.Lc(31,"Column 2"),O.Wb(),O.Xb(32,"th"),O.Lc(33,"Column 3"),O.Wb(),O.Xb(34,"th"),O.Lc(35,"Column 4"),O.Wb(),O.Xb(36,"th"),O.Lc(37,"Column 5"),O.Wb(),O.Xb(38,"th"),O.Lc(39,"Column 6"),O.Wb(),O.Xb(40,"th"),O.Lc(41,"Column 7"),O.Wb(),O.Xb(42,"th"),O.Lc(43,"Column 8"),O.Wb(),O.Xb(44,"th"),O.Lc(45,"Column 9"),O.Wb(),O.Xb(46,"th"),O.Lc(47,"Column 10"),O.Wb(),O.Xb(48,"th"),O.Lc(49,"Column 11"),O.Wb(),O.Wb(),O.Wb(),O.Xb(50,"tbody"),O.Xb(51,"tr",4),O.Xb(52,"td"),O.Lc(53,"NAME"),O.Wb(),O.Xb(54,"td",10),O.Lc(55,"invoice_number"),O.Wb(),O.Xb(56,"td"),O.Lc(57,"issue_date"),O.Wb(),O.Xb(58,"td"),O.Lc(59,"party"),O.Wb(),O.Xb(60,"td"),O.Lc(61,"price"),O.Wb(),O.Xb(62,"td"),O.Lc(63,"unit"),O.Wb(),O.Xb(64,"td"),O.Lc(65,"volume"),O.Wb(),O.Xb(66,"td"),O.Lc(67,"amount"),O.Wb(),O.Xb(68,"td"),O.Lc(69,"t_amount"),O.Wb(),O.Xb(70,"td"),O.Lc(71,"t_tax"),O.Wb(),O.Xb(72,"td"),O.Lc(73,"exrate"),O.Wb(),O.Xb(74,"td"),O.Lc(75,"info"),O.Wb(),O.Wb(),O.Xb(76,"tr",11),O.Xb(77,"td"),O.Lc(78,"COLUMN"),O.Wb(),O.Xb(79,"td"),O.Xb(80,"mat-form-field",12),O.Sb(81,"input",13),O.Wb(),O.Wb(),O.Xb(82,"td"),O.Xb(83,"mat-form-field",12),O.Sb(84,"input",14),O.Wb(),O.Wb(),O.Xb(85,"td"),O.Xb(86,"mat-form-field",12),O.Sb(87,"input",15),O.Wb(),O.Wb(),O.Xb(88,"td"),O.Xb(89,"mat-form-field",12),O.Sb(90,"input",16),O.Wb(),O.Wb(),O.Xb(91,"td"),O.Xb(92,"mat-form-field",12),O.Sb(93,"input",17),O.Wb(),O.Wb(),O.Xb(94,"td"),O.Xb(95,"mat-form-field",12),O.Sb(96,"input",18),O.Wb(),O.Wb(),O.Xb(97,"td"),O.Xb(98,"mat-form-field",12),O.Sb(99,"input",19),O.Wb(),O.Wb(),O.Xb(100,"td"),O.Xb(101,"mat-form-field",12),O.Sb(102,"input",20),O.Wb(),O.Wb(),O.Xb(103,"td"),O.Xb(104,"mat-form-field",12),O.Sb(105,"input",21),O.Wb(),O.Wb(),O.Xb(106,"td"),O.Xb(107,"mat-form-field",12),O.Sb(108,"input",22),O.Wb(),O.Wb(),O.Xb(109,"td"),O.Xb(110,"mat-form-field",12),O.Sb(111,"input",23),O.Wb(),O.Wb(),O.Wb(),O.Xb(112,"tr"),O.Xb(113,"td"),O.Lc(114,"FORMAT"),O.Wb(),O.Xb(115,"td",10),O.Xb(116,"div",24),O.Xb(117,"span",25),O.Lc(118,"DATE:"),O.Wb(),O.Xb(119,"mat-radio-group",26),O.Jc(120,xe,3,3,"mat-radio-button",27),O.Wb(),O.Wb(),O.Wb(),O.Xb(121,"td"),O.Lc(122,"Text value"),O.Wb(),O.Xb(123,"td"),O.Lc(124,"Text value"),O.Wb(),O.Xb(125,"td"),O.Lc(126,"Number"),O.Wb(),O.Xb(127,"td"),O.Lc(128,"Number"),O.Wb(),O.Xb(129,"td"),O.Lc(130,"Text value"),O.Wb(),O.Xb(131,"td"),O.Lc(132,"Text value"),O.Wb(),O.Xb(133,"td"),O.Lc(134,"Text value"),O.Wb(),O.Xb(135,"td"),O.Lc(136,"Text value"),O.Wb(),O.Xb(137,"td"),O.Lc(138,"Text value"),O.Wb(),O.Xb(139,"td"),O.Lc(140,"Text value"),O.Wb(),O.Wb(),O.Xb(141,"tr"),O.Xb(142,"td"),O.Lc(143,"RANGE"),O.Wb(),O.Xb(144,"td"),O.Xb(145,"mat-form-field",28),O.Sb(146,"input",29),O.Wb(),O.Wb(),O.Xb(147,"td",30),O.Xb(148,"span",31),O.Lc(149,"HEADER"),O.Wb(),O.Wb(),O.Xb(150,"td",32),O.Xb(151,"mat-radio-group",33),O.Xb(152,"mat-radio-button",34),O.Lc(153,"None"),O.Wb(),O.Xb(154,"mat-radio-button",35),O.Lc(155,"First row"),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Lc(156),O.kc(157,"json"),O.Wb()),2&e&&(O.pc("@animateStagger",O.qc(15,Se)),O.Db(1),O.Ic("height",t.height,"px"),O.pc("formGroup",t.form),O.Db(9),O.pc("value","revenue")("checked","revenue"==t.form.value.invoice_type),O.Db(4),O.pc("value","cost")("checked","cost"==t.form.value.invoice_type),O.Db(106),O.pc("ngForOf",t.type),O.Db(32),O.pc("value",!1)("checked",!t.form.value.header),O.Db(2),O.pc("value",!0),O.Db(2),O.Nc(" ",O.lc(157,13,t.data),"\n"))},directives:[Y.d,Y.c,E.A,E.q,E.h,g.b,E.p,E.g,g.a,m.c,d.b,E.b,E.i,E.u,E.w,Y.b,o.s,E.k],pipes:[o.k],styles:["file-import-invoice-view .table-format{font-size:12px}file-import-invoice-view .table-format td,file-import-invoice-view .table-format th{padding:4px!important}file-import-invoice-view .table-format .my-form-field{width:100%}file-import-invoice-view .table-format .my-form-field .mat-form-field-wrapper{margin-bottom:-1.25em}file-import-invoice-view .table-format .my-form-field .mat-form-field-infix{margin-top:-.75em}file-import-invoice-view .table-format .my-form-field .mat-select-value-text{font-size:12px}file-import-invoice-view cdk-virtual-scroll-viewport{width:100%}file-import-invoice-view cdk-virtual-scroll-viewport .file-import-invoice-table{font-size:12px}file-import-invoice-view cdk-virtual-scroll-viewport .file-import-invoice-table thead th{position:sticky;position:-webkit-sticky;top:0;background:#fff;z-index:10}file-import-invoice-view cdk-virtual-scroll-viewport .file-import-invoice-table td,file-import-invoice-view cdk-virtual-scroll-viewport .file-import-invoice-table th{padding:8px!important;font-size:12px}"],encapsulation:2,data:{animation:fe.a}}),e})();var We=i("JX91"),Ie=i("lJxs"),we=i("FKr1");function ke(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," misa_party is required "),O.Wb())}function _e(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," misa_party is too long (max length = 25); "),O.Wb())}function Le(e,t){if(1&e&&(O.Xb(0,"mat-option",25),O.Lc(1),O.Wb()),2&e){const e=t.$implicit;O.pc("value",e),O.Db(1),O.Oc("",e.short_name,"-",e.full_name,"")}}function Ce(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," Party is required "),O.Wb())}function De(e,t){if(1&e){const e=O.Yb();O.Xb(0,"div"),O.Xb(1,"form",7),O.fc("keydown.enter",(function(t){return O.Bc(e),"TEXTAREA"==t.target.tagName}))("ngSubmit",(function(t){O.Bc(e);const i=O.jc();return i.onPartymisaFormSubmit(i.formPartymisa)})),O.Xb(2,"div",8),O.Xb(3,"mat-form-field",9),O.Xb(4,"mat-label"),O.Lc(5,"Misa party"),O.Wb(),O.Sb(6,"input",10),O.Jc(7,ke,2,0,"mat-error",6),O.Jc(8,_e,2,0,"mat-error",6),O.Wb(),O.Xb(9,"mat-form-field",11),O.Xb(10,"mat-label"),O.Lc(11,"Party"),O.Wb(),O.Sb(12,"input",12),O.Xb(13,"mat-autocomplete",13,14),O.Jc(15,Le,2,3,"mat-option",15),O.kc(16,"async"),O.Wb(),O.Jc(17,Ce,2,0,"mat-error",6),O.Wb(),O.Xb(18,"mat-form-field",16),O.Xb(19,"mat-label"),O.Lc(20,"Info"),O.Wb(),O.Sb(21,"input",17),O.Wb(),O.Xb(22,"mat-form-field",16),O.Xb(23,"mat-label"),O.Lc(24,"Update by"),O.Wb(),O.Sb(25,"input",18),O.Sb(26,"input",19),O.Wb(),O.Wb(),O.Xb(27,"div",20),O.Xb(28,"div",21),O.Lc(29),O.Wb(),O.Wb(),O.Xb(30,"div",22),O.Xb(31,"button",23),O.Lc(32,"Submit"),O.Wb(),O.Xb(33,"button",24),O.fc("click",(function(t){return O.Bc(e),O.jc().matDialogRef.close()})),O.Lc(34,"Cancel"),O.Wb(),O.Wb(),O.Wb(),O.Wb()}if(2&e){const e=O.xc(14),t=O.jc();O.Db(1),O.pc("formGroup",t.formPartymisa),O.Db(6),O.pc("ngIf",t.formPartymisa.get("misa_party").hasError("required")),O.Db(1),O.pc("ngIf",!t.formPartymisa.get("misa_party").hasError("required")&&t.formPartymisa.get("misa_party").hasError("maxLength")),O.Db(4),O.pc("matAutocomplete",e),O.Db(1),O.pc("displayWith",t.commonService.displayObjFn.bind(t,"full_name")),O.Db(2),O.pc("ngForOf",O.lc(16,9,t.filteredParty)),O.Db(2),O.pc("ngIf",t.formPartymisa.get("party").hasError("required")),O.Db(8),O.pc("value",t.name),O.Db(4),O.Mc(t.errorMessage)}}function Ae(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," misa_price is required "),O.Wb())}function Pe(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," misa_price is too long (max length = 25); "),O.Wb())}function Fe(e,t){if(1&e&&(O.Xb(0,"mat-option",25),O.Lc(1),O.Wb()),2&e){const e=t.$implicit;O.pc("value",e),O.Db(1),O.Oc("",e.code," - ",e.name,"")}}function Re(e,t){1&e&&(O.Xb(0,"mat-error"),O.Lc(1," Price is required "),O.Wb())}function je(e,t){if(1&e){const e=O.Yb();O.Xb(0,"div"),O.Xb(1,"form",26),O.fc("keydown.enter",(function(t){return O.Bc(e),"TEXTAREA"==t.target.tagName}))("ngSubmit",(function(t){O.Bc(e);const i=O.jc();return i.onPricemisaFormSubmit(i.formPricemisa)})),O.Xb(2,"div",8),O.Xb(3,"mat-form-field",9),O.Xb(4,"mat-label"),O.Lc(5,"Misa price"),O.Wb(),O.Sb(6,"input",27),O.Jc(7,Ae,2,0,"mat-error",6),O.Jc(8,Pe,2,0,"mat-error",6),O.Wb(),O.Xb(9,"mat-form-field",11),O.Xb(10,"mat-label"),O.Lc(11,"Price"),O.Wb(),O.Sb(12,"input",28),O.Xb(13,"mat-autocomplete",13,29),O.Jc(15,Fe,2,3,"mat-option",15),O.kc(16,"async"),O.Wb(),O.Jc(17,Re,2,0,"mat-error",6),O.Wb(),O.Xb(18,"mat-form-field",16),O.Xb(19,"mat-label"),O.Lc(20,"Info"),O.Wb(),O.Sb(21,"input",17),O.Wb(),O.Xb(22,"mat-form-field",16),O.Xb(23,"mat-label"),O.Lc(24,"Update by"),O.Wb(),O.Sb(25,"input",18),O.Sb(26,"input",19),O.Wb(),O.Wb(),O.Xb(27,"div",20),O.Xb(28,"div",21),O.Lc(29),O.Wb(),O.Wb(),O.Xb(30,"div",22),O.Xb(31,"button",23),O.Lc(32,"Submit"),O.Wb(),O.Xb(33,"button",24),O.fc("click",(function(t){return O.Bc(e),O.jc().matDialogRef.close()})),O.Lc(34,"Cancel"),O.Wb(),O.Wb(),O.Wb(),O.Wb()}if(2&e){const e=O.xc(14),t=O.jc();O.Db(1),O.pc("formGroup",t.formPricemisa),O.Db(6),O.pc("ngIf",t.formPricemisa.get("misa_price").hasError("required")),O.Db(1),O.pc("ngIf",!t.formPricemisa.get("misa_price").hasError("required")&&t.formPricemisa.get("misa_price").hasError("maxLength")),O.Db(4),O.pc("matAutocomplete",e),O.Db(1),O.pc("displayWith",t.commonService.displayObjFn.bind(t,"name")),O.Db(2),O.pc("ngForOf",O.lc(16,9,t.filteredPrice)),O.Db(2),O.pc("ngIf",t.formPricemisa.get("price").hasError("required")),O.Db(8),O.pc("value",t.name),O.Db(4),O.Mc(t.errorMessage)}}let Oe=(()=>{class e{constructor(e,t,i,r,o,a,n){this.router=e,this.matDialogRef=t,this._data=i,this._formBuilder=r,this.authService=o,this.commonService=a,this.fileImportInvoiceService=n,this.formPartymisa=this._formBuilder.group({misa_party:[null,[E.y.required,E.y.maxLength(25)]],party:[null,E.y.required],info:[null],update_by:[this.authService.user]}),this.formPricemisa=this._formBuilder.group({id:[null],misa_price:[null,[E.y.required,E.y.maxLength(25)]],price:[null,E.y.required],info:[null],update_by:[this.authService.user]}),this.errorMessage="",this.label=i.label,this.party=i.party,this.price=i.price,this.invoiceType=i.invoiceType,this.name=this.authService.name,"Create party misa"==this.label&&(this.formPartymisa.controls.misa_party.setValue(i.data.party_misa),this.formPartymisa.controls.info.setValue(i.data.party_name)),"Create price misa"==this.label&&(this.formPricemisa.controls.misa_price.setValue(i.data.price_misa),this.formPricemisa.controls.info.setValue(i.data.price_name))}ngOnInit(){this.filteredParty=this.formPartymisa.controls.party.valueChanges.pipe(Object(We.a)(""),Object(Ie.a)(e=>e?"string"==typeof e?e:e.partner_name:null),Object(Ie.a)(e=>e?this.commonService.filterData(e,"partner_name",this.party):[])),this.filteredPrice=this.formPricemisa.controls.price.valueChanges.pipe(Object(We.a)(""),Object(Ie.a)(e=>e?"string"==typeof e?e:e.price_name:null),Object(Ie.a)(e=>e?this.commonService.filterData(e,"price_name",this.price):[])),this.formPartymisa.valueChanges.subscribe(e=>{this.errorMessage=""}),this.formPricemisa.valueChanges.subscribe(e=>{this.errorMessage=""})}onPartymisaFormSubmit(e){if(e.valid){if("string"==typeof e.value.party)return void this.formPartymisa.controls.party.setValue(null);this.authService.onRequestChanged.next(!0);let t="revenue"==this.invoiceType?"customer":"supplier",i=JSON.parse(JSON.stringify(e.value));i["misa_"+t]=i.misa_party,i[t]=i.party.id,delete i.party,delete i.misa_party,i.update_by=this.authService.user,this.fileImportInvoiceService.createPartymisa(i,t).then(e=>{i.misa_party=i["misa_"+t],i.party=i[t],this.authService.onRequestChanged.next(!1),this.matDialogRef.close(i)}).catch(e=>{this.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)})}}onPricemisaFormSubmit(e){this.authService.onRequestChanged.next(!0);let t=e.value;t.price=t.price.id,t.update_by=this.authService.user,this.fileImportInvoiceService.createPricemisa(t).then(e=>{this.authService.onRequestChanged.next(!1),this.matDialogRef.close(t)}).catch(e=>{this.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)})}}return e.\u0275fac=function(t){return new(t||e)(O.Rb(r.g),O.Rb(y.f),O.Rb(y.a),O.Rb(E.d),O.Rb(T.a),O.Rb(le.a),O.Rb(z))},e.\u0275cmp=O.Lb({type:e,selectors:[["file-import-invoice-modal-dialog"]],decls:11,vars:3,consts:[[1,"dialog-content-wrapper"],[1,"mat-accent","m-0"],["fxFlex","","fxLayout","row","fxLayoutAlign","space-between center"],[1,"title","dialog-title"],["mat-icon-button","","aria-label","Close dialog",3,"click"],["mat-dialog-content","","fusePerfectScrollbar","",1,"p-16","pb-0","m-0"],[4,"ngIf"],["fxLayout","column","fxLayoutAlign","start","name","formPartymisa",3,"formGroup","keydown.enter","ngSubmit"],["fxLayout","row wrap","fxLayoutAlign","start center","fxFlex","1 0 auto"],["appearance","outline","fxFlex","25",1,"pr-8"],["inputCheck","","matInput","","formControlName","misa_party","maxlength","25","required",""],["appearance","outline","fxFlex","75",1,"pr-8"],["inputCheck","","aria-label","party","matInput","","formControlName","party","required","",3,"matAutocomplete"],[3,"displayWith"],["autoParty","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline","fxFlex","50",1,"pr-8"],["inputCheck","","matInput","","formControlName","info"],["inputCheck","","matInput","","readonly","true",3,"value"],["inputCheck","","matInput","","formControlName","update_by",2,"display","none"],["fxLayout","row","fxLayoutAlign","start center","fxFlex","1 0 auto"],[1,"mat-error"],["fxLayout","row","fxLayoutAlign","center","fxFlex","1 0 auto",1,"p-16"],["type","submit","mat-raised-button","","color","accent",1,"mr-8"],["type","button","mat-raised-button","","color","warn",1,"mr-8",3,"click"],[3,"value"],["fxLayout","column","fxLayoutAlign","start","name","formPricemisa",3,"formGroup","keydown.enter","ngSubmit"],["inputCheck","","matInput","","formControlName","misa_price","maxlength","25","required",""],["inputCheck","","aria-label","price","matInput","","formControlName","price","required","",3,"matAutocomplete"],["autoPrice","matAutocomplete"]],template:function(e,t){1&e&&(O.Xb(0,"div",0),O.Xb(1,"mat-toolbar",1),O.Xb(2,"mat-toolbar-row",2),O.Xb(3,"span",3),O.Lc(4),O.Wb(),O.Xb(5,"button",4),O.fc("click",(function(e){return t.matDialogRef.close()})),O.Xb(6,"mat-icon"),O.Lc(7,"close"),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Xb(8,"div",5),O.Jc(9,De,35,11,"div",6),O.Jc(10,je,35,11,"div",6),O.Wb(),O.Wb()),2&e&&(O.Db(4),O.Mc(t.label),O.Db(5),O.pc("ngIf","Create party misa"==t.label),O.Db(1),O.pc("ngIf","Create price misa"==t.label))},directives:[x.a,x.c,Y.b,Y.d,Y.c,l.b,u.a,y.d,J.a,o.t,E.A,E.q,E.h,m.c,m.f,d.b,E.b,E.p,E.g,E.k,E.w,c.c,c.a,o.s,m.b,we.n],pipes:[o.b],styles:["@media screen and (min-width:600px)and (max-width:959px){.file-import-invoice-modal-dialog{width:100%}}@media screen and (min-width:960px){.file-import-invoice-modal-dialog{width:1080px}}.file-import-invoice-modal-dialog .mat-dialog-container{padding:0}.file-import-invoice-modal-dialog .dialog-content-wrapper{max-height:85vh;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.file-import-invoice-modal-dialog .mat-form-field-wrapper{margin:0 0 5px}.file-import-invoice-modal-dialog .primary-color-input,.file-import-invoice-modal-dialog .secondary-color-input{padding:6px 8px}"],encapsulation:2}),e})();var Me=i("R0Ic");function Te(e,t){if(1&e&&(O.Xb(0,"span"),O.Lc(1),O.Wb()),2&e){const e=O.jc().$implicit;O.Db(1),O.Mc(e.party_misa)}}function qe(e,t){if(1&e){const e=O.Yb();O.Xb(0,"a",17),O.fc("click",(function(t){O.Bc(e);const i=O.jc().$implicit,r=O.jc(2);return t.stopPropagation(),r.createParty(i)})),O.Lc(1),O.Wb()}if(2&e){const e=O.jc().$implicit;O.Db(1),O.Mc(e.party_misa)}}function Ne(e,t){if(1&e){const e=O.Yb();O.Xb(0,"mat-icon",18),O.fc("click",(function(t){O.Bc(e);const i=O.jc().$implicit,r=O.jc(2);return t.stopPropagation(),r.saveImport([i])})),O.Lc(1,"save"),O.Wb()}}function ze(e,t){if(1&e){const e=O.Yb();O.Xb(0,"mat-icon",19),O.fc("click",(function(t){O.Bc(e);const i=O.jc(),r=i.$implicit,o=i.index,a=O.jc(2);return t.stopPropagation(),a.deleteInvoice(r,o)})),O.Lc(1,"delete"),O.Wb()}}function Be(e,t){if(1&e){const e=O.Yb();O.Xb(0,"mat-icon",19),O.fc("click",(function(t){O.Bc(e);const i=O.jc(),r=i.$implicit,o=i.index,a=O.jc(2);return t.stopPropagation(),a.deleteInvoice(r.duplicate,o)})),O.Lc(1,"delete"),O.Wb()}}function Je(e,t){if(1&e&&(O.Xb(0,"span"),O.Lc(1),O.Wb()),2&e){const e=O.jc().$implicit;O.Db(1),O.Mc(e.price_misa)}}function Ee(e,t){if(1&e){const e=O.Yb();O.Xb(0,"a",17),O.fc("click",(function(t){O.Bc(e);const i=O.jc().$implicit,r=O.jc(3);return t.stopPropagation(),r.createPrice(i)})),O.Lc(1),O.Wb()}if(2&e){const e=O.jc().$implicit;O.Db(1),O.Mc(e.price_misa)}}const Ve=function(e){return{"detail-cell":e}};function He(e,t){if(1&e&&(O.Xb(0,"tr",20),O.Xb(1,"td"),O.Lc(2),O.Wb(),O.Xb(3,"td"),O.Jc(4,Je,2,1,"span",3),O.Jc(5,Ee,2,1,"a",9),O.Wb(),O.Xb(6,"td"),O.Lc(7),O.Wb(),O.Xb(8,"td"),O.Lc(9),O.Wb(),O.Xb(10,"td"),O.Lc(11),O.Wb(),O.Xb(12,"td",5),O.Lc(13),O.kc(14,"number"),O.Wb(),O.Xb(15,"td"),O.Lc(16),O.Wb(),O.Xb(17,"td",5),O.Lc(18),O.kc(19,"number"),O.Wb(),O.Xb(20,"td",5),O.Lc(21),O.kc(22,"number"),O.Wb(),O.Xb(23,"td"),O.Lc(24),O.Wb(),O.Xb(25,"td",5),O.Lc(26),O.Wb(),O.Xb(27,"td",5),O.Lc(28),O.kc(29,"number"),O.Wb(),O.Sb(30,"td"),O.Wb()),2&e){const e=t.$implicit,i=t.index,r=O.jc().$implicit;O.pc("ngClass",O.rc(26,Ve,r.data_expand)),O.Db(2),O.Mc(i+1),O.Db(2),O.pc("ngIf",e.price),O.Db(1),O.pc("ngIf",!e.price),O.Db(2),O.Mc(null==e.price?null:e.price.code),O.Db(2),O.Mc(null==e.price?null:e.price.unit_code),O.Db(2),O.Mc(e.volume),O.Db(2),O.Mc(O.mc(14,14,e.amount,"1.0-0")),O.Db(3),O.Mc(e.tax),O.Db(2),O.Mc(O.mc(19,17,e.t_amount,"VND"==e.currency.code?"1.0-0":"1.2-2")),O.Db(3),O.Mc(O.mc(22,20,e.t_tax,"VND"==e.currency.code?"1.0-0":"1.2-2")),O.Db(3),O.Mc(e.currency?e.currency.code:""),O.Db(2),O.Mc(e.ex_rate),O.Db(2),O.Mc(O.mc(29,23,(e.t_amount+e.t_tax)*e.ex_rate,"1.0-0"))}}const Ue=function(e,t,i){return{error:e,success:t,"accent-200-bg":i}};function Ge(e,t){if(1&e&&(O.Vb(0),O.Xb(1,"tr",8),O.fc("click",(function(e){const i=t.$implicit;return i.data_expand=!i.data_expand})),O.Xb(2,"td"),O.Lc(3),O.Wb(),O.Xb(4,"td"),O.Lc(5),O.Wb(),O.Xb(6,"td"),O.Jc(7,Te,2,1,"span",3),O.Jc(8,qe,2,1,"a",9),O.Wb(),O.Xb(9,"td"),O.Lc(10),O.Wb(),O.Xb(11,"td"),O.Lc(12),O.kc(13,"date"),O.Wb(),O.Xb(14,"td",5),O.Lc(15),O.kc(16,"number"),O.Wb(),O.Xb(17,"td",5),O.Lc(18),O.kc(19,"number"),O.Wb(),O.Xb(20,"td",5),O.Lc(21),O.kc(22,"number"),O.Wb(),O.Xb(23,"td"),O.Lc(24),O.Wb(),O.Xb(25,"td",6),O.Lc(26),O.Wb(),O.Xb(27,"td"),O.Lc(28),O.Wb(),O.Xb(29,"td"),O.Lc(30),O.Wb(),O.Xb(31,"td"),O.Jc(32,Ne,2,0,"mat-icon",10),O.Jc(33,ze,2,0,"mat-icon",11),O.Jc(34,Be,2,0,"mat-icon",11),O.Wb(),O.Wb(),O.Xb(35,"tr",12),O.Xb(36,"td",13),O.Xb(37,"div",14),O.Xb(38,"table",15),O.Xb(39,"thead"),O.Xb(40,"tr"),O.Xb(41,"th"),O.Lc(42,"No"),O.Wb(),O.Xb(43,"th"),O.Lc(44,"Price Misa"),O.Wb(),O.Xb(45,"th"),O.Lc(46,"Price"),O.Wb(),O.Xb(47,"th"),O.Lc(48,"Unit"),O.Wb(),O.Xb(49,"th"),O.Lc(50,"Volume"),O.Wb(),O.Xb(51,"th",5),O.Lc(52,"Amount"),O.Wb(),O.Xb(53,"th"),O.Lc(54,"Tax(%)"),O.Wb(),O.Xb(55,"th",5),O.Lc(56,"Total amount"),O.Wb(),O.Xb(57,"th",5),O.Lc(58,"Total tax"),O.Wb(),O.Xb(59,"th"),O.Lc(60,"Currency"),O.Wb(),O.Xb(61,"th",5),O.Lc(62,"Exrate"),O.Wb(),O.Xb(63,"th",5),O.Lc(64,"Total VND"),O.Wb(),O.Sb(65,"th"),O.Wb(),O.Wb(),O.Xb(66,"tbody"),O.Jc(67,He,31,28,"tr",16),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Wb(),O.Ub()),2&e){const e=t.$implicit,i=t.index;O.Db(1),O.pc("ngClass",O.tc(31,Ue,e.error.includes("error"),e.error.includes("success"),e.duplicate)),O.Db(2),O.Mc(i+1),O.Db(2),O.Mc(e.invoice_number),O.Db(2),O.pc("ngIf",e.party),O.Db(1),O.pc("ngIf",!e.party),O.Db(2),O.Mc(null==e.party?null:e.party.short_name),O.Db(2),O.Mc(O.mc(13,19,e.issue_date,"MM/dd/yyyy")),O.Db(3),O.Mc(O.mc(16,22,e.amount,"1.0-0")),O.Db(3),O.Mc(O.mc(19,25,e.tax,"1.0-0")),O.Db(3),O.Mc(O.mc(22,28,e.amount+e.tax,"1.0-0")),O.Db(3),O.Mc(null==e.payment_center?null:e.payment_center.name),O.Db(2),O.Mc(e.info),O.Db(2),O.Mc(1==e.type?"Revenue":"Cost"),O.Db(2),O.Mc(e.error),O.Db(2),O.pc("ngIf",!e.id&&""==e.error),O.Db(1),O.pc("ngIf",e.id),O.Db(1),O.pc("ngIf",e.duplicate),O.Db(3),O.pc("@detailExpand",e.data_expand?"expanded":"collapsed"),O.Db(30),O.pc("ngForOf",e.itemPrice)}}function $e(e,t){if(1&e&&(O.Xb(0,"table",4),O.Xb(1,"thead"),O.Xb(2,"tr"),O.Xb(3,"th"),O.Lc(4,"No"),O.Wb(),O.Xb(5,"th"),O.Lc(6,"Number"),O.Wb(),O.Xb(7,"th"),O.Lc(8,"Party Misa"),O.Wb(),O.Xb(9,"th"),O.Lc(10,"Party"),O.Wb(),O.Xb(11,"th"),O.Lc(12,"Issue date"),O.Wb(),O.Xb(13,"th",5),O.Lc(14,"Amount"),O.Wb(),O.Xb(15,"th",5),O.Lc(16,"Tax"),O.Wb(),O.Xb(17,"th",5),O.Lc(18,"Total"),O.Wb(),O.Xb(19,"th"),O.Lc(20,"Payment center"),O.Wb(),O.Xb(21,"th",6),O.Lc(22,"Info"),O.Wb(),O.Xb(23,"th"),O.Lc(24,"Type"),O.Wb(),O.Xb(25,"th"),O.Lc(26,"Error"),O.Wb(),O.Sb(27,"th"),O.Wb(),O.Wb(),O.Xb(28,"tbody"),O.Jc(29,Ge,68,35,"ng-container",7),O.Wb(),O.Wb()),2&e){const e=O.jc();O.Db(29),O.pc("ngForOf",e.invoiceFilter)}}function Ye(e,t){if(1&e&&(O.Xb(0,"mat-option",30),O.Lc(1),O.Wb()),2&e){const e=t.$implicit,i=O.jc(2);O.pc("value",e),O.Db(1),O.Pc("",10*e+1," - ",10*(e+1)<i.invoiceImport.length?10*(e+1):i.invoiceImport.length," / ",i.invoiceImport.length,"")}}function Qe(e,t){if(1&e){const e=O.Yb();O.Xb(0,"div"),O.Xb(1,"mat-button-toggle-group",21),O.Xb(2,"mat-button-toggle",22),O.fc("change",(function(t){return O.Bc(e),O.jc().changeItem(t)})),O.Xb(3,"mat-icon",23),O.Lc(4,"fast_rewind"),O.Wb(),O.Wb(),O.Xb(5,"mat-button-toggle"),O.Xb(6,"div",24),O.Xb(7,"mat-select",25),O.fc("ngModelChange",(function(t){return O.Bc(e),O.jc().onChangeSelect(t)})),O.Jc(8,Ye,2,4,"mat-option",26),O.Wb(),O.Wb(),O.Wb(),O.Xb(9,"mat-button-toggle",27),O.fc("change",(function(t){return O.Bc(e),O.jc().changeItem(t)})),O.Xb(10,"mat-icon",23),O.Lc(11,"fast_forward"),O.Wb(),O.Wb(),O.Wb(),O.Xb(12,"button",28),O.fc("click",(function(t){O.Bc(e);const i=O.jc();return i.saveImport(i.invoiceFilter)})),O.Lc(13,"Save"),O.Wb(),O.Xb(14,"button",29),O.fc("click",(function(t){return O.Bc(e),O.jc().goBack(!0)})),O.Xb(15,"span"),O.Lc(16,"New Import"),O.Wb(),O.Wb(),O.Xb(17,"button",29),O.fc("click",(function(t){return O.Bc(e),O.jc().goBack()})),O.Xb(18,"span"),O.Lc(19,"Back"),O.Wb(),O.Wb(),O.Wb()}if(2&e){const e=O.jc();O.Db(2),O.pc("disabled",0==e.selectedItem),O.Db(5),O.pc("ngModel",e.selectedItem),O.Db(1),O.pc("ngForOf",e.arrSelect),O.Db(1),O.pc("disabled",e.selectedItem==e.arrSelect.length-1),O.Db(3),O.pc("disabled",0==e.invoiceImport||e.check)}}let Ze=(()=>{class e{constructor(e,t,i,r,o,a,n,c){this._formBuilder=e,this.router=t,this.route=i,this.authService=r,this.datePipe=o,this.fileImportService=a,this.googleApiService=n,this._matDialog=c,this.height=560,this.save=!0,this.selectedItem=0,this.invoiceFilter=[],this.arrSelect=[],this.formInvoiceImport=this._formBuilder.group({invoice_account:[null,E.y.required]}),this.check=!1,this._unsubscribeAll=new j.a}ngOnInit(){this.authService.windowSizeChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e.height-64-12-12-54-8-72}),this.authService.changeScreen.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.height=e?this.authService.screenHeight-12-12-54-8-72:this.authService.screenHeight-64-12-12-54-8-72}),this.googleApiService.onFileDataChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.invoiceImport=e[0],this.invoiceType=e[1],this.arrSelect=[];let t=Math.round(this.invoiceImport.length/10);for(let i=0;i<=t;++i)this.arrSelect.push(i);this.invoiceFilter=[],this.selectedItem=0,this.check=!1,this.invoiceImport.map((e,t)=>{t>=10*this.selectedItem&&t<=10*(this.selectedItem+1)-1&&(this.invoiceFilter.push(e),(e.error||e.duplicate)&&(this.check=!0))})}),this.fileImportService.onDataChanged.pipe(Object(V.a)(this._unsubscribeAll)).subscribe(e=>{this.type=this.fileImportService.type,this.customerArr=this.fileImportService.customerArr,this.supplierArr=this.fileImportService.supplierArr,this.priceArr=this.fileImportService.priceArr})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}getData(){this.authService.onRequestChanged.next(!0),this.fileImportService.getData().then(e=>{this.authService.onRequestChanged.next(!1)}).catch(e=>{this.authService.onRequestChanged.next(!1),console.error(e),alert("Error: Server error")})}onChangeSelect(e){this.selectedItem=e,this.invoiceFilter=[],this.check=!1,this.invoiceImport.map((e,t)=>{t>=10*this.selectedItem&&t<=10*(this.selectedItem+1)-1&&(this.invoiceFilter.push(e),e.error&&(this.check=!0))})}changeItem(e){this.selectedItem=this.selectedItem+parseInt(e.value),this.invoiceFilter=[],this.check=!1,this.invoiceImport.map((e,t)=>{t>=10*this.selectedItem&&t<=10*(this.selectedItem+1)-1&&(this.invoiceFilter.push(e),e.error&&(this.check=!0))})}saveImport(e){this.save=!0,e.map(e=>{this.save&&setTimeout(()=>{this.saveInvoice(e)},500)})}saveInvoice(e){let t=JSON.parse(JSON.stringify(e));t.party=t.party.id,t.payment_center=t.payment_center.id,t.issue_date&&(t.issue_date=this.datePipe.transform(t.issue_date,"yyyy-MM-dd")),t.itemPrice.map(e=>{e.pay_date&&(e.pay_date=this.datePipe.transform(e.pay_date,"yyyy-MM-dd")),e.currency=e.currency.id}),this.fileImportService.createInvoice(t,this.invoiceType).then(t=>{let i=this.invoiceImport.indexOf(e);this.invoiceImport[i].error="Save invoice success!",this.invoiceImport[i].id=t.createInv.insertId}).catch(e=>{this.save=!1,alert("ERROR"),console.error(e)})}deleteInvoice(e,t){this.authService.onRequestChanged.next(!0),this.fileImportService.deleteSelInvoice(e.id,this.invoiceType).then(i=>{if(this.authService.onRequestChanged.next(!1),1==i.invoice.affectedRows){let i=this.invoiceImport.indexOf(e);this.invoiceImport.splice(i,1),this.invoiceFilter.splice(t,1)}}).catch(e=>{this.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)})}getCheck(){let e=!1;return this.invoiceImport.map(t=>{(t.error||t.duplicate)&&(e=!0)}),e}goBack(e){e&&(this.googleApiService.form=null),this.googleApiService.onFileChanged.next([]),this.googleApiService.stepChanged.next(0)}createParty(e){JSON.parse(JSON.stringify(e)),this.dialogRef=this._matDialog.open(Oe,{panelClass:"file-import-invoice-modal-dialog",data:{label:"Create party misa",party:"revenue"==this.invoiceType?this.customerArr:this.supplierArr,price:this.priceArr,invoiceType:this.invoiceType,data:e}}),this.dialogRef.afterClosed().subscribe(e=>{e&&(this.fileImportService.partymisa[e.misa_party]=e,this.check=!1,this.invoiceFilter=[],this.invoiceImport.map((t,i)=>{t.party||t.party_misa!=e.misa_party||(t.party=this.fileImportService.party[e.party],t.payment_center=this.fileImportService.country[t.party.country]),this.fileImportService.checkError(t),i>=10*this.selectedItem&&i<=10*(this.selectedItem+1)-1&&(this.invoiceFilter.push(t),(t.error||t.duplicate)&&(this.check=!0))}))})}createPrice(e){JSON.parse(JSON.stringify(e)),this.dialogRef=this._matDialog.open(Oe,{panelClass:"file-import-invoice-modal-dialog",data:{label:"Create price misa",party:"revenue"==this.invoiceType?this.customerArr:this.supplierArr,price:this.priceArr,invoiceType:this.invoiceType,data:e}}),this.dialogRef.afterClosed().subscribe(e=>{e&&(this.fileImportService.partymisa[e.misa_party]=e,this.check=!1,this.invoiceFilter=[],this.invoiceImport.map((t,i)=>{t.itemPrice.map(t=>{t.price||t.price_misa!=e.misa_price||(t.price=this.fileImportService.price[e.price],t.unit=t.price.unit_code)}),this.fileImportService.checkError(t),i>=10*this.selectedItem&&i<=10*(this.selectedItem+1)-1&&(this.invoiceFilter.push(t),(t.error||t.duplicate)&&(this.check=!0))}))})}buildFilterData(e){}}return e.\u0275fac=function(t){return new(t||e)(O.Rb(E.d),O.Rb(r.g),O.Rb(r.a),O.Rb(T.a),O.Rb(o.f),O.Rb(z),O.Rb($.a),O.Rb(y.b))},e.\u0275cmp=O.Lb({type:e,selectors:[["file-import-invoice-table"]],viewQuery:function(e,t){var i;1&e&&O.Sc(C.e,!0),2&e&&O.wc(i=O.gc())&&(t.viewPort=i.first)},decls:4,vars:4,consts:[[1,"w-100-p","table-content"],["class","simple invoice-table mt-8",4,"ngIf"],[1,"p-8","w-100-p","mt-8"],[4,"ngIf"],[1,"simple","invoice-table","mt-8"],[1,"text-right"],[1,"w-400"],[4,"ngFor","ngForOf"],[1,"example-element-row",3,"ngClass","click"],["class","cursor-pointer",3,"click",4,"ngIf"],["class","cursor-pointer","color","accent",3,"click",4,"ngIf"],["class","cursor-pointer","color","warn",3,"click",4,"ngIf"],[1,"example-detail-row"],["colspan","12"],["fxLayout","row wrap","fxLayoutAlign","start center",1,"ml-16","example-element-detail"],[1,"view-table",2,"width","100%","border-collapse","collapse"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"cursor-pointer",3,"click"],["color","accent",1,"cursor-pointer",3,"click"],["color","warn",1,"cursor-pointer",3,"click"],[3,"ngClass"],[1,"mr-8"],["value","-1",3,"disabled","change"],["color","accent"],[1,"w-140"],["required","",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["value","1",3,"disabled","change"],["mat-raised-button","","type","button","color","accent",1,"mt-8","mr-8",3,"disabled","click"],["type","button","mat-raised-button","","color","accent",1,"ml-8",3,"click"],[3,"value"]],template:function(e,t){1&e&&(O.Xb(0,"div",0),O.Jc(1,$e,30,1,"table",1),O.Wb(),O.Xb(2,"div",2),O.Jc(3,Qe,20,5,"div",3),O.Wb()),2&e&&(O.Ic("height",t.height,"px"),O.Db(1),O.pc("ngIf",t.invoiceFilter.length>0),O.Db(2),O.pc("ngIf",t.invoiceImport.length>0))},directives:[o.t,o.s,o.q,Q.a,Y.d,Y.c,u.a,b.b,b.a,v.a,E.w,E.p,E.s,l.b,we.n],pipes:[o.f,o.g],styles:["file-import-invoice-table .table-content{overflow:auto}file-import-invoice-table .table-content .invoice-table{font-size:12px;width:99%;border-collapse:collapse}file-import-invoice-table .table-content .invoice-table td,file-import-invoice-table .table-content .invoice-table th{font-size:12px;border:1px solid #d6d7d6}file-import-invoice-table .table-content .invoice-table thead th{position:sticky;position:-webkit-sticky;top:0;background:#a5d7ef;z-index:20;padding:8px}file-import-invoice-table .table-content .invoice-table tr.detail-cell td,file-import-invoice-table .table-content .invoice-table tr.example-element-row td{padding:4px 8px}file-import-invoice-table .table-content .invoice-table tr.example-detail-row{height:0!important}file-import-invoice-table .table-content .invoice-table tr.example-element-row:not(.example-expanded-row):hover{background:#ffc4c4}file-import-invoice-table .table-content .invoice-table tr.example-element-row.active-row{background:#a8b3ff}file-import-invoice-table .table-content .invoice-table tr.error{background:#f786d1!important}file-import-invoice-table .table-content .invoice-table tr.success{background:#60f793!important}file-import-invoice-table .table-content .invoice-table .example-element-row td{border-bottom-width:0}file-import-invoice-table .table-content .invoice-table .example-detail-row td{padding:0}file-import-invoice-table .table-content .invoice-table .example-detail-row .example-element-detail{overflow:hidden;display:-webkit-box;display:flex}file-import-invoice-table .table-content .invoice-table .example-detail-row .example-element-detail .view-table td,file-import-invoice-table .table-content .invoice-table .example-detail-row .example-element-detail .view-table th{font-size:12px;padding:4px 8px}"],encapsulation:2,data:{animation:[Object(Me.p)("detailExpand",[Object(Me.m)("collapsed",Object(Me.n)({height:"0px",minHeight:"0"})),Object(Me.m)("expanded",Object(Me.n)({height:"*"})),Object(Me.o)("expanded <=> collapsed",Object(Me.e)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),e})();i.d(t,"FileImportInvoiceModule",(function(){return et}));const Ke=[{path:"",component:de,resolve:{data:z,google:$.a},children:[{path:"view",component:Xe},{path:"table",component:Ze}]}];let et=(()=>{class e{}return e.\u0275mod=O.Pb({type:e}),e.\u0275inj=O.Ob({factory:function(t){return new(t||e)},providers:[z],imports:[[r.k.forChild(Ke),o.c,n.b,c.b,s.c,l.c,b.c,p.b,m.e,u.b,h.b,d.c,f.c,v.b,g.c,y.e,x.b,S.b,X.b,W.d,I.e,w.b,k.b,_.b,L.k,C.g,D.b,A.c,P.a,F.f,a.a]]}),e})()}}]);