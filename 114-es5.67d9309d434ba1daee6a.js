function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var i=[],n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(c){o=!0,a=c}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return i}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{zLd6:function(e,t,i){"use strict";i.r(t);var n,o=i("tyNb"),a=i("5HBU"),r=i("STbY"),s=i("/1cH"),c=i("iadO"),l=i("bTqV"),u=i("7EHt"),h=i("kmnG"),p=i("NFeN"),d=i("Qu3c"),m=i("qFsG"),b=i("wZkO"),f=i("d3UM"),v=i("QibW"),g=i("0IaG"),y=i("/t3+"),k=i("bSwM"),_=i("M9IT"),S=i("xHqg"),C=i("A5z7"),w=i("bv9b"),D=i("XhcP"),R=i("FKr1"),B=i("1jcm"),O=i("+0xr"),T=i("Dh3D"),A=i("IOBc"),V=i("212X"),j=i("LPQX"),x=i("XNiG"),I=i("1G5W"),H=i("PVWW"),P=i("fXoL"),L=i("HX77"),N=i("lJxs"),q=i("2Vo4"),E=i("tk/3"),W=i("I/3d"),X=i("qXBG"),F=((n=function(){function e(t,i,n,o){_classCallCheck(this,e),this.router=t,this.db=i,this.authService=n,this._httpClient=o,this.modul="pacific-logistics-network",this.codeCompany=["DCL","SEG","SEL","SIN","SLO","TWN","REF: "],this.filterData={valid:"1"},this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.total={},this.priceHeader=[],this.priceObj={},this.onPermissionChanged=new q.a([]),this.onSelDocumentChanged=new q.a([]),this.onVesselChanged=new q.a([]),this.onDataChanged=new q.a([]),this.onDataItemChanged=new q.a([]),this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2])}return _createClass(e,[{key:"resolve",value:function(e){var t=this;return this.authService.routerData=e,new Promise((function(e,i){Promise.all([t.getDataVoyage()]).then((function(t){_toArray(t),e()}),i)}))}},{key:"getDataVoyage",value:function(){var e=this,t={headers:new E.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(i,n){e._httpClient.get(e.authService.apiUrl+"/pln/voyage/data",t).subscribe((function(t){e.vessel=t[0],e.partner=t[1],e.users=t[2],e.country=t[3],e.seaport=t[4],e.seaTerminal=t[5],e.supplier=t[6],e.selVessel=t[7],e.onDataChanged.next(t),i(t)}),n)}))}},{key:"getItemData",value:function(){var e=this,t={headers:new E.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(i,n){e._httpClient.get(e.authService.apiUrl+"/pln/shipment/item-data",t).subscribe((function(t){e.price=t[0],e.unit=t[1],e.currency=t[2],e.country=t[3],e.users=t[4],e.commodity=t[5],e.packageType=t[6],e.onDataItemChanged.next(t),i(t)}),n)}))}},{key:"writeDatabaseBooking",value:function(e,t){this.bookingCollection=this.db.collection("pln-booking-draft"),this.bookingCollection.doc(e).set(t)}},{key:"readDatabaseBooking",value:function(){return this.bookingCollection=this.db.collection("pln-booking-draft"),this.booking=this.bookingCollection.snapshotChanges().pipe(Object(N.a)((function(e){return e.map((function(e){var t=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},t)}))}))),this.booking}},{key:"readDatabaseBookingByUser",value:function(e){return this.bookingCollection=this.db.collection("pln-booking-draft",(function(t){return t.where("user","==",e)})),this.booking=this.bookingCollection.snapshotChanges().pipe(Object(N.a)((function(e){return e.map((function(e){var t=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},t)}))}))),this.booking}},{key:"getDatabaseBookingById",value:function(e){return this.bookingCollection=this.db.collection("pln-booking-draft"),this.bookingCollection.doc(e).valueChanges()}},{key:"updateDatabaseBookingById",value:function(e,t){this.bookingCollection=this.db.collection("pln-booking-draft"),this.bookingCollection.doc(e).set(t)}},{key:"deleteDatabaseBookingById",value:function(e){this.bookingDoc=this.db.doc("pln-booking-draft/"+e),this.bookingDoc.delete()}},{key:"readDatabaseRemark",value:function(){return this.remarkCollection=this.db.collection("pln-vessel-remark"),this.remark=this.remarkCollection.snapshotChanges().pipe(Object(N.a)((function(e){return e.map((function(e){var t=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},t)}))}))),this.remark}},{key:"updateDatabaseRemarkById",value:function(e,t){this.remarkCollection=this.db.collection("pln-vessel-remark"),this.remarkCollection.doc(e).set(t)}},{key:"deleteDatabaseRemarkById",value:function(e){this.remarkDoc=this.db.doc("pln-vessel-remark/"+e),this.remarkDoc.delete()}},{key:"updateBookingConfirm",value:function(e,t){var i=this,n=t.book,o=t.voyage,a=n.volume.map((function(e){return e.commodity.name})),r=(a=a.filter((function(e,t,i){return i.indexOf(e)===t}))).join(",");o.closing_time||(o.closing_time=o.depart_time-864e5);var s="";n.volume.map((function(e){s+=i.calculateTotal(e.cont_type.code,n.volume)+"x"+e.cont_type.code+" "})),o.closing_time||(o.closing_time=o.depart_time-864e5),t.bookConfirm={book_number:n.code,shipper:n.customer,agent:n.agent,volume:n.volume,commodity:r,empty_pick_up_depot:n.empty_pick_up_depot?n.empty_pick_up_depot:null,place_of_stuffing:n.place_of_stuffing?n.place_of_stuffing:null,closing_time_vgm:n.closing_time_vgm?n.closing_time_vgm:null,return_laden_cont:o.load_terminal_name,clcv:n.clcv?n.clcv:null,note:n.note?n.note:"All containers in clean, sound and cargo worthy condition",contact_note:n.contact_note?n.contact_note:"Vui l\xf2ng li\xean h\u1ec7 c\u1ea5p cont r\u1ed7ng qua mail legend@pln.vn v\xe0 com@pln.vn, l\u1ea5y seal t\u1ea1i b\xe3i c\u1ea5p v\u1ecf container",pol:n.pol,pot:n.pot?n.pot.name:null,pod:n.pod,voyage:{pol:o.load_port_name,pod:o.discharge_port_name,load_terminal:o.load_terminal_name,discharge_terminal:o.discharge_terminal_name,vessel:o.vessel_name,voyage:o.name,closing_time:o.closing_time,etd:o.depart_time,eta:o.arrive_time},lcv_note:n.lcv_note?n.lcv_note:null,lcv_volume:s,truck_name:n.truck_name?n.truck_name:null,truck_number:n.truck_number?n.truck_number:null,valid:n.valid?n.valid:null,valid_time:n.valid_time?n.valid_time:null,code_company:n.code_company?n.code_company:""},this.updateDatabaseBookingById(e,t)}},{key:"getPermissionById",value:function(e){var t=this,i={headers:new E.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(n,o){t._httpClient.get(t.authService.apiUrl+"/permission/id/"+e,i).subscribe((function(e){t.onPermissionChanged.next(e),n(e)}),o)}))}},{key:"createSelShipment",value:function(e){var t=this,i={headers:new E.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(n,o){t._httpClient.post(t.authService.apiUrl+"/pln/book/shipment",e,i).subscribe((function(e){n(e)}),o)}))}},{key:"getData",value:function(){var e=this;if(this.filterBook=this.bookingfb.slice(),"all"!=this.filterData.valid){var t=(new Date).getTime();this.filterBook=this.filterBook.filter("1"==this.filterData.valid?function(e){return e.voyage.depart_time>=t}:function(e){return e.voyage.depart_time<t})}if(this.filterData.code&&(this.filterBook=this.filterBook.filter((function(t){return t.book.code.toLowerCase().includes(e.filterData.code.toLowerCase())}))),this.filterData.customer&&(this.filterBook=this.filterBook.filter((function(t){return t.book.customer.full_name.toLowerCase().includes(e.filterData.customer.toLowerCase())}))),this.filterData.pol&&(this.filterBook=this.filterBook.filter((function(t){return t.voyage.load_port_name.toLowerCase().includes(e.filterData.pol.toLowerCase())}))),this.filterData.pod&&(this.filterBook=this.filterBook.filter((function(t){return t.voyage.discharge_port_name.toLowerCase().includes(e.filterData.pod.toLowerCase())}))),this.filterData.booking_number&&(this.filterBook=this.filterBook.filter((function(t){return t.book.code.toLowerCase().includes(e.filterData.booking_number.toLowerCase())}))),this.filterData.vessel&&(this.filterBook=this.filterBook.filter((function(t){return(t.voyage.vessel_name+" "+t.voyage.name).toLowerCase().includes(e.filterData.vessel.toLowerCase())}))),this.filterData.time_from){var i=new Date(this.filterData.time_from).getTime();this.filterBook=this.filterBook.filter((function(e){return new Date(e.voyage.depart_time).getTime()>=i}))}if(this.filterData.time_to){var n=new Date(this.filterData.time_to).getTime();this.filterBook=this.filterBook.filter((function(e){return new Date(e.voyage.depart_time).getTime()<=n}))}console.log(this.filterBook),this.contType=[],this.total={};var o=["20DC","20FR","20RF","20TK","40DC","40FR","40HC","40HR","40OT","40RF"];this.filterBook.map((function(t){o.map((function(e){t.book[e]&&delete t.book[e]})),t.book.volume&&t.book.volume.map((function(i){e.contType.includes(i.cont_type.code)||(e.contType.push(i.cont_type.code),e.total[i.cont_type.code]=0),t.book[i.cont_type.code]||(t.book[i.cont_type.code]=0),e.total[i.cont_type.code]+=i.quantity,t.book[i.cont_type.code]+=i.quantity}))})),this.contType.sort(),this.buildReport()}},{key:"buildReport",value:function(){var e=this;this.sptRouter=[],this.data={},this.voyage={},this.dataVessel={},this.total={},this.priceObj={},this.priceHeader=[];var t=[],i=[];this.filterBook.map((function(n){e.priceObj[n.id]={},n.bookConfirm.contArr&&0!=n.bookConfirm.contArr.length||(n.bookConfirm.contArr=[{container:null,type:null}]);var o=n.voyage.load_port_name+"-"+n.voyage.discharge_port_name;e.sptRouter.includes(o)?e.data[o].push(n):(e.sptRouter.push(o),e.data[o]=[n]),e.priceObj[n.id].revenueVNPrice||(e.priceObj[n.id].revenueVNPrice={}),e.priceObj[n.id].revenueNNPrice||(e.priceObj[n.id].revenueNNPrice={}),n.revenue.sell.map((function(o){t.includes(o.price.code+o.currency.code+o.payment_center.name)||(t.push(o.price.code+o.currency.code+o.payment_center.name),i.push({id:o.price.id,code:o.price.code,name:o.price.name,unit_code:o.price.unit_code,currency:o.currency.code,payment_center:o.payment_center.name})),"VIETNAM"==o.payment_center.name?e.priceObj[n.id].revenueVNPrice[o.price.code+o.currency.code+o.payment_center.name]=o.amount:e.priceObj[n.id].revenueNNPrice[o.price.code+o.currency.code+o.payment_center.name]=o.amount}))})),this.buildPrice(i),this.sptRouter.map((function(t){e.voyage[t]=[],e.data[t].map((function(i){var n=i.voyage,o=n.depart_time+"-"+n.vessel_name+"-"+n.name;e.dataVessel[o]||(e.dataVessel[o]={voyage_name:n.name,vessel_name:n.vessel_name,pol_name:n.load_port_name,pod_name:n.discharge_port_name,depart_time:n.depart_time,arrive_time:n.arrive_time,closing_time:n.closing_time,shipment:[],container:0},e.voyage[t].push(o)),e.dataVessel[o].shipment.push(i),e.dataVessel[o].container+=i.bookConfirm.contArr.length-1,i.book.volume.map((function(t){e.dataVessel[o][t.cont_type.code]?e.dataVessel[o][t.cont_type.code]+=t.quantity:e.dataVessel[o][t.cont_type.code]=t.quantity,e.total[t.cont_type.code]?e.total[t.cont_type.code]+=t.quantity:e.total[t.cont_type.code]=t.quantity}))}))})),this.onVesselChanged.next([this.contType,this.sptRouter,this.data,this.voyage,this.dataVessel,this.total])}},{key:"buildPrice",value:function(e){var t=e.filter((function(e){return"VIETNAM"==e.payment_center})),i=e.filter((function(e){return"VIETNAM"!=e.payment_center})),n=["OF","EBS","EFF","RR","BILL","LTHC","SEAL","DO","DTHC","DCIC","VS","AMS","ENS"];t.sort((function(e,t){var i=e.unit_code,n=t.unit_code,o=e.currency,a=t.currency,r=e.code,s=t.code;return i>n?1:i<n?-1:o>a?1:o<a?-1:r>s?1:r<s?-1:0}));var o,a,r=t.filter((function(e){return e.unit_code.includes("20")})),s=t.filter((function(e){return e.unit_code.includes("40")})),c=t.filter((function(e){return!e.unit_code.includes("20")&&!e.unit_code.includes("40")})),l=[],u=[],h=[],p=[],d=[],m=[];n.map((function(e,t){p[t]=r.filter((function(t){return t.code.includes(e)})),p[t].length>0&&p[t].map((function(e){(a=r.indexOf(e))>=0&&(o=r.splice(a,1),l.push(o[0]))})),d[t]=s.filter((function(t){return t.code.includes(e)})),d[t].length>0&&d[t].map((function(e){(a=s.indexOf(e))>=0&&(o=s.splice(a,1),u.push(o[0]))})),m[t]=c.filter((function(t){return t.code.includes(e)})),m[t].length>0&&m[t].map((function(e){(a=c.indexOf(e))>=0&&(o=c.splice(a,1),h.push(o[0]))}))})),i.sort((function(e,t){var i=e.unit_code,n=t.unit_code,o=e.currency,a=t.currency,r=e.code,s=t.code;return i>n?1:i<n?-1:o>a?1:o<a?-1:r>s?1:r<s?-1:0}));var b,f,v=i.filter((function(e){return e.unit_code.includes("20")})),g=i.filter((function(e){return e.unit_code.includes("40")})),y=i.filter((function(e){return!e.unit_code.includes("20")&&!e.unit_code.includes("40")})),k=[],_=[],S=[],C=[],w=[],D=[];n.map((function(e,t){C[t]=v.filter((function(t){return t.code.includes(e)})),C[t].length>0&&C[t].map((function(e){(f=v.indexOf(e))>=0&&(b=v.splice(f,1),k.push(b[0]))})),w[t]=g.filter((function(t){return t.code.includes(e)})),w[t].length>0&&w[t].map((function(e){(f=g.indexOf(e))>=0&&(b=g.splice(f,1),_.push(b[0]))})),D[t]=y.filter((function(t){return t.code.includes(e)})),D[t].length>0&&D[t].map((function(e){(f=y.indexOf(e))>=0&&(b=y.splice(f,1),S.push(b[0]))}))})),this.priceHeader=[].concat(l,_toConsumableArray(r),u,_toConsumableArray(s),h,_toConsumableArray(c),k,_toConsumableArray(v),_,_toConsumableArray(g),S,_toConsumableArray(y))}},{key:"updateVoyageList",value:function(e){var t=this,i={headers:new E.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(n,o){t._httpClient.put(t.authService.apiUrl+"/sel/book/voyage",e,i).subscribe((function(e){n(e)}),o)}))}},{key:"calculateTotal",value:function(e,t){var i=0;return t.map((function(t){t.cont_type.code==e&&(i+=t.quantity)})),i}}]),e}()).\u0275fac=function(e){return new(e||n)(P.bc(o.g),P.bc(W.a),P.bc(X.a),P.bc(E.a))},n.\u0275prov=P.Nb({token:n,factory:n.\u0275fac}),n),M=i("B9zo"),z=i("ofXK"),J=i("fE3o"),U=i("IZxC"),G=i("Pg/h");function K(e,t){if(1&e){var i=P.Yb();P.Xb(0,"fuse-sidebar",8),P.Xb(1,"bookings-sidebar",9),P.fc("filterChanged",(function(e){return P.Bc(i),P.jc().filterChanged(e)})),P.Wb(),P.Wb()}if(2&e){var n=P.jc();P.Db(1),P.pc("modul",n.modul)("portPair",n.portPair)}}function Q(e,t){1&e&&P.Sb(0,"router-outlet")}var Y,Z,$,ee,te=((Y=function(){function e(t,i,n,o){var a=this;_classCallCheck(this,e),this._fuseSidebarService=t,this.shipmentService=i,this.router=n,this.authService=o,this.modul="pacific-logistics-network",this.sidebarPanel=!0,this.time=Date.now(),this.contType=[],this.sptRouter=[],this.portPair=[],this.data={},this.voyage={},this.dataVessel={},this.total={},this._unsubscribeAll=new x.a,this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2]),this.permission&&!this.permission.data?this.shipmentService.getPermissionById(this.permission.id).then((function(e){a.permission=e,a.shipmentService.readDatabaseBooking().subscribe((function(e){e.map((function(e){e.voyage.depart_time=new Date(e.voyage.depart_time).getTime()})),e.sort((function(e,t){return e.voyage.depart_time<t.voyage.depart_time?1:t.voyage.depart_time<e.voyage.depart_time?-1:0}));var t=e.filter((function(e){return a.permission.owner.includes(e.user)||(e.book.create_by?a.permission.owner.includes(e.book.create_by.id):null)||!!e.share&&e.share.map((function(e){return e.id})).includes(a.authService.user)}));a.shipmentService.bookingfb=t,a.shipmentService.getData()}))})):this.shipmentService.readDatabaseBooking().subscribe((function(e){console.log(e),e.map((function(e){e.voyage.depart_time=new Date(e.voyage.depart_time).getTime()})),e.sort((function(e,t){return e.voyage.depart_time<t.voyage.depart_time?1:t.voyage.depart_time<e.voyage.depart_time?-1:0})),a.shipmentService.bookingfb=e,a.shipmentService.getData()}))}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.modul=this.shipmentService.modul,this.shipmentService.onVesselChanged.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.contType=e.shipmentService.contType,e.sptRouter=e.shipmentService.sptRouter,e.portPair.length<e.sptRouter.length&&(e.portPair=e.sptRouter.slice()),e.data=e.shipmentService.data,e.voyage=e.shipmentService.voyage,e.dataVessel=e.shipmentService.dataVessel,e.total=e.shipmentService.total}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"toggleSidebar",value:function(e){this._fuseSidebarService.getSidebar(e).toggleOpen()}},{key:"showHideBar",value:function(e){this.sidebarPanel=!this.sidebarPanel}},{key:"refreshPage",value:function(e){this.authService.refreshData(this.shipmentService)}},{key:"newContainer",value:function(e){this.router.navigate(["/apps/news/shipment-book/form/0"])}},{key:"saveShipment",value:function(e){var t=this,i=e.id,n={code:e.book.code,customer:e.book.customer.id,agent:e.book.agent?e.book.agent.id:null,pol:e.book.pol.id,pod:e.book.pod.id,status:1,direct:0,owner:e.user,info:e,create_by:e.book.create_by?e.book.create_by.id:this.authService.user};this.authService.onRequestChanged.next(!0),this.shipmentService.createSelShipment(n).then((function(e){t.authService.onRequestChanged.next(!1),t.shipmentService.deleteDatabaseBookingById(i),e.createShipment&&t.router.navigate(["/apps/pacific-logistics-network/shipment/detail/"+e.createShipment.insertId+"/soa"])})).catch((function(e){t.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)}))}},{key:"copyBooking",value:function(e){if(confirm("Do you want to copy this booking?")){var t=JSON.parse(JSON.stringify(e));t.book.code+="(copy)",t.user=this.authService.user,t.share=null,delete t.id;var i=Date.now().toString();this.shipmentService.writeDatabaseBooking(i,t)}}},{key:"deleteBookDraft",value:function(e){this.shipmentService.deleteDatabaseBookingById(e.id)}},{key:"filterChanged",value:function(e){this.shipmentService.filterData=e,this.shipmentService.getData()}}]),e}()).\u0275fac=function(e){return new(e||Y)(P.Rb(L.a),P.Rb(F),P.Rb(o.g),P.Rb(X.a))},Y.\u0275cmp=P.Lb({type:Y,selectors:[["shipment-book"]],decls:8,vars:6,consts:[["id","shipment",1,"page-layout","carded","left-sidebar","inner-scroll"],["class","sidebar","name","bookings-sidebar","position","left","lockedOpen","gt-md",4,"ngIf"],["name","bookings-setting","position","right",1,"sidebar"],[1,"center","mr-0","ml-0"],[3,"modul","searchText","sidebarName","showHideBar","refreshPage","toggleSidebar"],[1,"content-card",2,"border","none","border-radius","0"],[1,"content"],[4,"ngIf"],["name","bookings-sidebar","position","left","lockedOpen","gt-md",1,"sidebar"],[3,"modul","portPair","filterChanged"]],template:function(e,t){1&e&&(P.Xb(0,"div",0),P.Jc(1,K,2,2,"fuse-sidebar",1),P.Sb(2,"fuse-sidebar",2),P.Xb(3,"div",3),P.Xb(4,"bookings-header",4),P.fc("showHideBar",(function(e){return t.showHideBar(e)}))("refreshPage",(function(e){return t.refreshPage(e)}))("toggleSidebar",(function(e){return t.toggleSidebar(e)})),P.Wb(),P.Xb(5,"div",5),P.Xb(6,"div",6),P.Jc(7,Q,1,0,"router-outlet",7),P.Wb(),P.Wb(),P.Wb(),P.Wb()),2&e&&(P.Db(1),P.pc("ngIf",t.sidebarPanel),P.Db(3),P.pc("modul",t.modul)("searchText",t.searchText)("sidebarName","bookings-sidebar")("modul",t.modul),P.Db(3),P.pc("ngIf",!0))},directives:[M.a,z.t,J.a,U.a,G.a,o.l],styles:["shipment-book{width:100%}shipment-book .center .header{height:64px!important;min-height:64px!important;max-height:64px!important}@media screen and (max-width:599px){shipment-book .center .header{height:56px!important;min-height:56px!important;max-height:56px!important}}shipment-book .center .content-card .toolbar .toolbar-separator{height:32px;width:1px;margin:0 12px}@media screen and (max-width:1919px){shipment-book .center .content-card shipment-book{border-right:0}shipment-book .center .content-card shipment-book,shipment-book .center .content-card shipment-details{-webkit-box-flex:1;flex:1 0 100%}shipment-book .center .content-card shipment-details{display:none!important}shipment-book .center .content-card.current-shipment-selected .toolbar{padding-left:16px!important}shipment-book .center .content-card.current-shipment-selected .content shipment-book,shipment-book .center .content-card.current-shipment-selected .toolbar .shipment-selection{display:none!important}shipment-book .center .content-card.current-shipment-selected .content shipment-details{display:-webkit-box!important;display:flex!important}}"],encapsulation:2,data:{animation:H.a}}),Y),ie=i("qjGM"),ne=((Z=function(){function e(t,i,n,o,a){_classCallCheck(this,e),this.router=t,this.route=i,this._activatedRoute=n,this.authService=o,this.shipmentService=a,this.modul="pacific-logistics-network",this.vessel=[],this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.selected=0,this.total={},this.priceHeader=[],this.priceObj={},this.height=560,this._unsubscribeAll=new x.a,this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2])}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.modul=this.shipmentService.modul,this.authService.windowSizeChanged.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t.height-64-64-16-4})),this.authService.changeScreen.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t?e.authService.screenHeight-64-16-4:e.authService.screenHeight-64-64-16-4})),this.shipmentService.onVesselChanged.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.contType=e.shipmentService.contType,e.sptRouter=e.shipmentService.sptRouter,e.data=e.shipmentService.data,e.voyage=e.shipmentService.voyage,e.dataVessel=e.shipmentService.dataVessel,e.total=e.shipmentService.total,e.priceHeader=e.shipmentService.priceHeader,e.priceObj=e.shipmentService.priceObj}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"saveShipment",value:function(e){var t=this,i=e.id,n={code:e.book.code,customer:e.book.customer.id,agent:e.book.agent?e.book.agent.id:null,pol:e.book.pol.id,pod:e.book.pod.id,status:1,direct:0,owner:e.user,info:e,create_by:e.book.create_by?e.book.create_by.id:this.authService.user};this.authService.onRequestChanged.next(!0),this.shipmentService.createSelShipment(n).then((function(e){t.authService.onRequestChanged.next(!1),t.shipmentService.deleteDatabaseBookingById(i),e.createShipment&&t.router.navigate(["/apps/pacific-logistics-network/shipment/detail/"+e.createShipment.insertId+"/soa"])})).catch((function(e){t.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)}))}},{key:"copyBooking",value:function(e){if(confirm("Do you want to copy this booking?")){var t=JSON.parse(JSON.stringify(e));t.book.code+="(copy)",t.user=this.authService.user,t.share=null,delete t.id;var i=Date.now().toString();this.shipmentService.writeDatabaseBooking(i,t)}}},{key:"deleteBookDraft",value:function(e){this.shipmentService.deleteDatabaseBookingById(e.id)}}]),e}()).\u0275fac=function(e){return new(e||Z)(P.Rb(o.g),P.Rb(o.a),P.Rb(o.a),P.Rb(X.a),P.Rb(F))},Z.\u0275cmp=P.Lb({type:Z,selectors:[["shipment-book-vessel"]],decls:1,vars:10,consts:[[3,"dataVessel","voyage","sptRouter","contType","height","permission","total","priceHeader","priceObj","modul","saveShipment","copyBooking","deleteBookDraft"]],template:function(e,t){1&e&&(P.Xb(0,"bookings-vessel",0),P.fc("saveShipment",(function(e){return t.saveShipment(e)}))("copyBooking",(function(e){return t.copyBooking(e)}))("deleteBookDraft",(function(e){return t.deleteBookDraft(e)})),P.Wb()),2&e&&P.pc("dataVessel",t.dataVessel)("voyage",t.voyage)("sptRouter",t.sptRouter)("contType",t.contType)("height",t.height)("permission",t.permission)("total",t.total)("priceHeader",t.priceHeader)("priceObj",t.priceObj)("modul",t.modul)},directives:[ie.a],styles:[""],encapsulation:2,data:{animation:H.a}}),Z),oe=i("5S3l"),ae=(($=function(){function e(t,i,n,o,a){_classCallCheck(this,e),this.router=t,this.route=i,this._activatedRoute=n,this.authService=o,this.shipmentService=a,this.modul="pacific-logistics-network",this.vessel=[],this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.selected=0,this.total={},this.priceHeader=[],this.priceObj={},this.height=560,this._unsubscribeAll=new x.a,this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2])}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.modul=this.shipmentService.modul,this.authService.windowSizeChanged.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t.height-64-64-16-4})),this.authService.changeScreen.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t?e.authService.screenHeight-64-16-4:e.authService.screenHeight-64-64-16-4})),this.shipmentService.onVesselChanged.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.contType=e.shipmentService.contType,e.sptRouter=e.shipmentService.sptRouter,e.data=e.shipmentService.data,e.voyage=e.shipmentService.voyage,e.dataVessel=e.shipmentService.dataVessel,e.total=e.shipmentService.total}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}}]),e}()).\u0275fac=function(e){return new(e||$)(P.Rb(o.g),P.Rb(o.a),P.Rb(o.a),P.Rb(X.a),P.Rb(F))},$.\u0275cmp=P.Lb({type:$,selectors:[["shipment-book-table"]],decls:1,vars:11,consts:[[3,"data","dataVessel","voyage","sptRouter","contType","height","permission","total","priceHeader","priceObj","modul"]],template:function(e,t){1&e&&P.Sb(0,"bookings-table",0),2&e&&P.pc("data",t.data)("dataVessel",t.dataVessel)("voyage",t.voyage)("sptRouter",t.sptRouter)("contType",t.contType)("height",t.height)("permission",t.permission)("total",t.total)("priceHeader",t.priceHeader)("priceObj",t.priceObj)("modul",t.modul)},directives:[oe.a],styles:[""],encapsulation:2,data:{animation:H.a}}),$),re=i("t0+f"),se=i("wFrn"),ce=i("xmvJ"),le=((ee=function(){function e(t,i,n,o,a){var r=this;_classCallCheck(this,e),this.router=t,this.route=i,this.authService=n,this.shipmentService=o,this._matDialog=a,this.modul="pacific-logistics-network",this.data={},this.dataVessel={},this.voyage={},this.sptRouter=[],this.book=[],this.filterBook=[],this.contType=[],this.selected=0,this.total={},this.priceHeader=[],this.priceObj={},this.revenueVNOpen=!1,this.revenueNNOpen=!1,this.height=560,this.time=(new Date).getTime(),this.remarkVessel={},this._unsubscribeAll=new x.a,this.permission=this.authService.getAction(this.router.routerState.snapshot.url.split("/")[2]),this.shipmentService.readDatabaseRemark().subscribe((function(e){r.remarkVessel={},console.log(e),e.map((function(e){r.remarkVessel[e.id]=e.remark}))}))}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.modul=this.shipmentService.modul,this.authService.windowSizeChanged.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t.height-64-64-16-4})),this.authService.changeScreen.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t?e.authService.screenHeight-64-16-4:e.authService.screenHeight-64-64-16-4})),this.shipmentService.onDataChanged.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.vessel=t[0],e.supplier=t[1],e.user=t[2],e.country=t[3],e.seaport=t[4],e.seaTerminal=t[5]})),this.shipmentService.onVesselChanged.pipe(Object(I.a)(this._unsubscribeAll)).subscribe((function(t){e.contType=e.shipmentService.contType,e.sptRouter=e.shipmentService.sptRouter,e.data=e.shipmentService.data,e.voyage=e.shipmentService.voyage,e.dataVessel=e.shipmentService.dataVessel,e.total=e.shipmentService.total,e.priceHeader=e.shipmentService.priceHeader,e.priceObj=e.shipmentService.priceObj}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"openModal",value:function(e){var t=this;this.dialogRef=this._matDialog.open(re.a,{panelClass:"bookings-modal-dialog",data:{label:"Add/Remove container",data:e.bookConfirm}}),this.dialogRef.afterClosed().subscribe((function(i){i&&(e.bookConfirm.contArr=i.contArr?i.contArr:[],t.shipmentService.updateDatabaseBookingById(e.id,e))}))}},{key:"editRemark",value:function(e){var t=this,i=_slicedToArray(e,2),n=i[0],o=i[1];this.dialogRef=this._matDialog.open(se.a,{panelClass:"bookings-vessel-modal-dialog",data:{label:"Edit Remark",data:o||null}}),this.dialogRef.afterClosed().subscribe((function(e){if(e){var i=n.id;e.name=n.vessel_name+" "+n.name,!e.remark&&t.remarkVessel[i]?t.shipmentService.deleteDatabaseRemarkById(i.toString()):t.shipmentService.updateDatabaseRemarkById(i.toString(),e)}}))}},{key:"openVessel",value:function(e){var t=this,i=_slicedToArray(e,2),n=i[0],o=i[1];this.dialogRef=this._matDialog.open(se.a,{panelClass:"bookings-vessel-modal-dialog",data:{label:"Edit Voyage",data:n,vessel:this.vessel,supplier:this.supplier,user:this.user,country:this.country,seaport:this.seaport,seaTerminal:this.seaTerminal}}),this.dialogRef.afterClosed().subscribe((function(e){e&&(t.authService.onRequestChanged.next(!0),t.shipmentService.updateVoyageList(e).then((function(e){t.authService.onRequestChanged.next(!1),e.data?t.updateDataBook(e.data,o):alert("Error voyage"),console.log(e)})).catch((function(e){t.authService.onRequestChanged.next(!1),console.error(e),alert("Error edit voyage")})))}))}},{key:"updateDataBook",value:function(e,t){var i=this;this.dataVessel[t].shipment.map((function(t){t.voyage=e,t.bookConfirm.voyage={pol:e.load_port_name,pod:e.discharge_port_name,load_terminal:e.load_terminal_name,discharge_terminal:e.discharge_terminal_name,vessel:e.vessel_name.replace(e.name,"").trim(),voyage:e.name,closing_time:e.closing_time,etd:e.depart_time,eta:e.arrive_time},t.return_laden_cont=e.load_terminal_name,i.shipmentService.updateDatabaseBookingById(t.id,t)}))}}]),e}()).\u0275fac=function(e){return new(e||ee)(P.Rb(o.g),P.Rb(o.a),P.Rb(X.a),P.Rb(F),P.Rb(g.b))},ee.\u0275cmp=P.Lb({type:ee,selectors:[["shipment-book-container"]],decls:1,vars:11,consts:[[3,"dataVessel","voyage","sptRouter","contType","height","permission","total","priceHeader","priceObj","modul","remarkVessel","openModal","editRemark","openVessel"]],template:function(e,t){1&e&&(P.Xb(0,"bookings-container",0),P.fc("openModal",(function(e){return t.openModal(e)}))("editRemark",(function(e){return t.editRemark(e)}))("openVessel",(function(e){return t.openVessel(e)})),P.Wb()),2&e&&P.pc("dataVessel",t.dataVessel)("voyage",t.voyage)("sptRouter",t.sptRouter)("contType",t.contType)("height",t.height)("permission",t.permission)("total",t.total)("priceHeader",t.priceHeader)("priceObj",t.priceObj)("modul",t.modul)("remarkVessel",t.remarkVessel)},directives:[ce.a],styles:[""],encapsulation:2,data:{animation:H.a}}),ee),ue=i("vxfF"),he=i("cfqv"),pe=i("T3U3"),de=i("h3iT"),me=i("eKfw"),be=i("fUQu"),fe=i("Mrpe"),ve=i("FDnR"),ge=i("X00z");i.d(t,"ShipmentBookModule",(function(){return _e}));var ye,ke=[{path:"",component:te,resolve:{data:F},children:[{path:"vessel",component:ne},{path:"container",component:le},{path:"table",component:ae}]}],_e=((ye=function e(){_classCallCheck(this,e)}).\u0275mod=P.Pb({type:ye}),ye.\u0275inj=P.Ob({factory:function(e){return new(e||ye)},providers:[F],imports:[[o.k.forChild(ke),r.b,a.a,s.b,c.c,l.c,u.b,h.e,p.b,d.b,m.c,b.c,f.b,v.c,g.e,y.b,k.b,_.b,S.d,C.e,w.b,D.b,B.b,O.k,T.c,R.t,A.a,V.a,j.f,ue.g,he.b,pe.a,de.a,me.a,be.a,fe.a,ve.a,ge.a]]}),ye)}}]);