function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{JUHC:function(e,t,i){"use strict";i.r(t);var r,n=i("tyNb"),a=i("ofXK"),o=i("nmyD"),c=i("STbY"),l=i("/1cH"),s=i("iadO"),b=i("bTqV"),u=i("jaxi"),p=i("7EHt"),m=i("kmnG"),f=i("NFeN"),d=i("Qu3c"),h=i("qFsG"),v=i("wZkO"),g=i("d3UM"),y=i("QibW"),x=i("0IaG"),k=i("/t3+"),S=i("bSwM"),X=i("M9IT"),W=i("xHqg"),I=i("A5z7"),w=i("bv9b"),_=i("XhcP"),C=i("1jcm"),L=i("+0xr"),D=i("vxfF"),A=i("cfqv"),P=i("dNgK"),F=i("5HBU"),j=i("LPQX"),R=i("yrbL"),O=i("XNiG"),M=i("fXoL"),T=i("HX77"),q=i("qXBG"),N=i("2Vo4"),z=i("tk/3"),B=((r=function(){function e(t,i,r){_classCallCheck(this,e),this._httpClient=t,this.authService=i,this.datePipe=r,this.country={},this.party={},this.customer={},this.supplier={},this.price={},this.unit={},this.currency={},this.user={},this.partymisa={},this.customermisa={},this.suppliermisa={},this.pricemisa={},this.selInvoice={},this.selRevenueInvoice={},this.selCostInvoice={},this.objContainer={},this.onDataChanged=new N.a([]),this.onDataViewChanged=new N.a([]),this.onFileImportInvoiceChanged=new N.a([]),this.onFileSearchChanged=new N.a({}),this.onRequestProcessingChanged=new N.a(!1),this.onMovementChanged=new N.a([])}return _createClass(e,[{key:"resolve",value:function(e){var t=this;return this.authService.routerData=e,new Promise((function(e,i){Promise.all([t.getData()]).then((function(){e()}),i)}))}},{key:"getFileImportInvoiceById",value:function(e){var t=this,i={headers:new z.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(r,n){t._httpClient.get(t.authService.apiUrl+"/sel/fileImport/id/"+e,i).subscribe((function(e){t.fileImport=e,t.onFileImportInvoiceChanged.next(e),r(e)}),n)}))}},{key:"getData",value:function(){var e=this,t={headers:new z.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(i,r){e._httpClient.get(e.authService.apiUrl+"/sel/sel-invoice/data",t).subscribe((function(t){t[0].map((function(t){e.country[t.id]=t})),e.customerArr=t[1],t[1].map((function(t){e.customer[t.id]=t})),e.supplierArr=t[2],t[2].map((function(t){e.supplier[t.id]=t})),e.priceArr=t[3],t[3].map((function(t){e.price[t.id]=t})),t[4].map((function(t){e.unit[t.id]=t})),t[5].map((function(t){e.currency[t.code]=t})),t[6].map((function(t){e.user[t.id]=t})),t[7].map((function(t){e.selRevenueInvoice[t.keydate]=t})),t[8].map((function(t){e.selCostInvoice[t.keydate]=t})),t[9].map((function(t){e.customermisa[t.misa_party]=t})),t[10].map((function(t){e.suppliermisa[t.misa_party]=t})),t[11].map((function(t){e.pricemisa[t.misa_price]=t})),e.type=[{id:1,code:"MM/dd/yyyy",yearFirst:!0,month:0,day:1,year:2},{id:2,code:"dd/MM/yyyy",yearFirst:!0,month:1,day:0,year:2}];var r="AA/"+((new Date).getFullYear()-2e3).toString()+"E",n="IMP"+e.datePipe.transform(new Date,"MM-dd-yyyy");e.invoiceType=[{id:1,type:"revenue",invoiceCode:r,column:[5,1,4,6,8,9,10,11,12,13,14],dateType:2,range:"A1:S1000",header:!0},{id:2,type:"cost",invoiceCode:n,column:[5,1,4,6,8,9,10,11,12,13,14],dateType:2,range:"A1:U1000",header:!0}],e.onDataChanged.next(t),i(t)}),r)}))}},{key:"createInvoice",value:function(e,t){var i=this,r={headers:new z.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(n,a){i._httpClient.post(i.authService.apiUrl+"/sel/sel-invoice/inv/"+t,e,r).subscribe((function(e){n(e)}),a)}))}},{key:"createPartymisa",value:function(e,t){var i=this,r={headers:new z.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(n,a){i._httpClient.post(i.authService.apiUrl+"/sel/sel-invoice/partymisa/"+t,e,r).subscribe((function(e){n(e)}),a)}))}},{key:"createPricemisa",value:function(e){var t=this,i={headers:new z.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(r,n){t._httpClient.post(t.authService.apiUrl+"/sel/sel-invoice/pricemisa",e,i).subscribe((function(e){r(e)}),n)}))}},{key:"deleteSelInvoice",value:function(e,t){var i=this,r={headers:new z.c({"Content-Type":"application/json",Authorization:this.authService.accessToken})};return new Promise((function(n,a){i._httpClient.delete(i.authService.apiUrl+"/sel/sel-invoice/inv/"+t+"/"+e,r).subscribe((function(e){n(e)}),a)}))}},{key:"getDateTime",value:function(e,t){if("string"==typeof e){var i=this.type.find((function(e){return e.id==t.dateType})),r=e.split(/[./-]+/);return e.match(/^\d{1,2}[./-]\d{1,2}[./-]\d{4}$/g)?new Date(r[i.year],r[i.month]-1,r[i.day]):null}if(e>25569&&e<365*((new Date).getFullYear()-1970+1)+25569){var n=new Date(86400*(e-25569)*1e3+6e4*(new Date).getTimezoneOffset()+500);return this.datePipe.transform(n,"HH:mm"),n}return null}},{key:"dateToString",value:function(e){var t=(e=new Date(e)).getMonth(),i=e.getDate(),r=e.getFullYear(),n=(t+1<10?"0":"")+(t+1).toString();return n+="/"+(i+1<10?"0":"")+i.toString(),n+="/"+r.toString()}},{key:"createData",value:function(e,t,i){var r=this,n=[],a=[],o="revenue"==t.invoice_type?"customer":"supplier";return this.partymisa="revenue"==t.invoice_type?this.customermisa:this.suppliermisa,this.party="revenue"==t.invoice_type?this.customer:this.supplier,this.selInvoice="revenue"==t.invoice_type?this.selRevenueInvoice:this.selCostInvoice,e.map((function(e,i){if(r.checkHeader(i,t)){var c=r.partymisa[e[t.column.party-1]],l=c?r.party[c[o]]:null,s=r.pricemisa[e[t.column.price-1]],b=s?r.price[s.price]:null,u=r.getDateTime(e[t.column.issue_date-1],t),p=e[t.column.t_amount-1]?e[t.column.t_tax-1]/e[t.column.t_amount-1]*100:0;switch(!0){case p<5:p=0;break;case p>=5&&p<5.26:p=5;break;case p>=5.26&&p<6:p=5.26;break;case p>=6&&p<7.5:p=7;break;case p>=7&&p<8.5:p=8;break;default:p=10}var m=(e[t.column.invoice_number-1]?e[t.column.invoice_number-1]:"")+"-"+(l?l.id:"")+(u?"-"+r.dateToString(u):"");n.includes(m)?(a[a.length-1].amount+=e[t.column.t_amount-1]*e[t.column.exrate-1],a[a.length-1].tax+=e[t.column.t_tax-1]*e[t.column.exrate-1],a[a.length-1].itemPrice.push({price_misa:e[t.column.price-1],price_name:e[t.column.price],unit_misa:e[t.column.unit-1],price:b,unit:b?r.unit[b.unit]:null,volume:e[t.column.volume-1],amount:e[t.column.amount-1],t_amount:e[t.column.t_amount-1],tax:p,t_tax:e[t.column.t_tax-1],currency:1==e[t.column.exrate-1]?r.currency.VND:r.currency.USD,ex_rate:e[t.column.exrate-1],update_by:r.authService.user})):(n.push(m),a.push({invoice_number:e[t.column.invoice_number-1],invoice_code:t.invoice_code,party_misa:e[t.column.party-1],party_name:("revenue"==t.invoice_type?e[14]+"-":"")+e[t.column.party],party:l,amount:e[t.column.t_amount-1]*e[t.column.exrate-1],tax:e[t.column.t_tax-1]*e[t.column.exrate-1],payment_center:l?r.country[l.country]:null,issue_date:u,status:1,info:e[t.column.info-1],data_expand:!1,itemPrice:[{price_misa:e[t.column.price-1],price_name:e[t.column.price],unit_misa:e[t.column.unit-1],price:b,unit:b?r.unit[b.unit]:null,volume:e[t.column.volume-1],amount:e[t.column.amount-1],t_amount:e[t.column.t_amount-1],tax:p,t_tax:e[t.column.t_tax-1],currency:1==e[t.column.exrate-1]?r.currency.VND:r.currency.USD,ex_rate:e[t.column.exrate-1],update_by:r.authService.user}],duplicate:r.selInvoice[m]?r.selInvoice[m]:null,type:"revenue"==t.invoice_type?1:-1,error:"",create_by:r.authService.user}))}})),a.map((function(e){r.checkError(e)})),this.dataView=a,a}},{key:"checkHeader",value:function(e,t){return!t.header||e>0}},{key:"checkError",value:function(e){for(var t in e.error="",e)"status"!=t&&"data_expand"!=t&&"error"!=t&&"duplicate"!=t&&"party"!=t&&(e[t]||"info"==t||"amount"==t||"tax"==t||(e.error+="error: "+t+" "));e.itemPrice.map((function(t){for(var i in t)"unit"!=i&&"pay_date"!=i&&"info"!=i&&(t[i]||0==t[i]||e.error.includes("errorPrice: "+i)||(e.error+="errorPrice: "+i+" "))}));var i=(e.invoice_number?e.invoice_number:"")+"-"+(e.party?e.party.id:"")+(e.issue_date?"-"+this.dateToString(e.issue_date):"");e.duplicate=this.selInvoice[i]?this.selInvoice[i]:null,e.duplicate&&(e.error+="error: duplicate")}}]),e}()).\u0275fac=function(e){return new(e||r)(M.bc(z.a),M.bc(q.a),M.bc(a.f))},r.\u0275prov=M.Nb({token:r,factory:r.\u0275fac}),r),E=i("B9zo"),J=i("EwFO"),V=i("3Pt+"),H=i("1G5W"),U=i("Kj3r"),G=i("/uUt"),$=i("0JVi"),Y=i("vI/F"),Q=i("XiUz"),Z=i("znSr"),K=["googleSheet"];function ee(e,t){1&e&&(M.Xb(0,"span"),M.Lc(1,"Error:\xa0"),M.Wb())}function te(e,t){if(1&e&&(M.Xb(0,"span",20),M.Lc(1,"Error\xa0"),M.Wb()),2&e){var i=M.jc();M.pc("matTooltip",i.errorMessage.value)("matTooltipPosition","left")}}function ie(e,t){1&e&&(M.Xb(0,"span"),M.Lc(1,"Success\xa0"),M.Wb())}function re(e,t){if(1&e){var i=M.Yb();M.Xb(0,"button",21),M.fc("click",(function(e){return M.Bc(i),M.jc().openPicker()})),M.Xb(1,"span"),M.Lc(2,"Get file2"),M.Wb(),M.Wb()}}function ne(e,t){if(1&e){var i=M.Yb();M.Xb(0,"button",22),M.fc("click",(function(e){M.Bc(i);var t=M.jc();return e.stopPropagation(),t.changeScreen(!0)})),M.Xb(1,"mat-icon"),M.Lc(2,"flip_to_front"),M.Wb(),M.Wb()}}function ae(e,t){if(1&e){var i=M.Yb();M.Xb(0,"button",22),M.fc("click",(function(e){M.Bc(i);var t=M.jc();return e.stopPropagation(),t.changeScreen(!1)})),M.Xb(1,"mat-icon"),M.Lc(2,"flip_to_back"),M.Wb(),M.Wb()}}var oe,ce=function(e,t){return{"red-600-fg":e,"green-600-fg":t}},le=function(e){return{hide:e}},se=((oe=function(){function e(t,i,r){_classCallCheck(this,e),this.authService=t,this._fuseConfigService=i,this.googleApiService=r,this.collapsed=!0,this.fullScreen=!1,this.toggleSidebar=new M.o,this.showHideBar=new M.o,this.refreshPage=new M.o,this.input=new M.o,this.sheetProperties=[],this._unsubscribeAll=new O.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.searchInput=new V.e(""),this.searchInput.valueChanges.pipe(Object(H.a)(this._unsubscribeAll),Object(U.a)(300),Object(G.a)()).subscribe((function(t){e.input.emit(t)})),this.googleApiService.onFormChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.validForm=e.googleApiService.validForm})),this.googleApiService.stepChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.step=t}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"ngAfterViewInit",value:function(){var e=this;this.googleApiService.onGapiChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.auth=t,e.attachSignin()})),this.googleApiService.onFileDataChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(e){}))}},{key:"changeScreen",value:function(e){this.fullScreen=e,this.authService.changeScreen.next(e),this._fuseConfigService.config=this.fullScreen?{layout:{navbar:{hidden:!0},toolbar:{hidden:!0},footer:{hidden:!0},sidepanel:{hidden:!0}}}:{layout:{navbar:{hidden:!1},toolbar:{hidden:!1},footer:{hidden:!0},sidepanel:{hidden:!0}}}}},{key:"collapse",value:function(){this.collapsed=!0}},{key:"expand",value:function(){this.collapsed=!1}},{key:"attachSignin",value:function(){var e=this;this.auth.attachClickHandler(this.googleSheet._elementRef.nativeElement,{},(function(t){e.token=e.googleApiService.token=t.getAuthResponse().access_token,e.googleApiService.createPicker()}),(function(e){alert("ERROR"),console.error(e)}))}},{key:"openPicker",value:function(){this.googleApiService.createPicker()}},{key:"checkForm",value:function(){this.googleApiService.onValidateForm.next(!0)}}]),e}()).\u0275fac=function(e){return new(e||oe)(M.Rb(q.a),M.Rb($.b),M.Rb(Y.a))},oe.\u0275cmp=M.Lb({type:oe,selectors:[["file-import-invoice-header"]],viewQuery:function(e,t){var i;1&e&&M.Sc(K,!0),2&e&&M.wc(i=M.gc())&&(t.googleSheet=i.first)},inputs:{sidebarName:"sidebarName",errorMessage:"errorMessage",spreadsheetId:"spreadsheetId"},outputs:{toggleSidebar:"toggleSidebar",showHideBar:"showHideBar",refreshPage:"refreshPage",input:"input"},decls:35,vars:21,consts:[[1,"p-0","mat-elevation-z1"],["fxFlex","","fxFill","","fxLayout","row","fxLayoutAlign","start center"],["fxFlex","1 0 auto","fxLayout","row","fxLayoutAlign","start center"],[1,"px-8","px-md-16"],["mat-icon-button","","fxHide.gt-sm","","fxFlex","10","fxFlex.gt-sm","0",1,"sidebar-toggle","mr-12",3,"click"],["mat-icon-button","","fxHide","","fxShow.gt-sm","","fxFlex","10","fxFlex.gt-sm","0",1,"sidebar-toggle","mr-12",3,"click"],["fxHide","","fxShow.gt-sm","",1,"m-8","font-size-12",3,"ngClass"],[4,"ngIf"],["fxHide.gt-sm","",1,"m-8","font-size-12",3,"ngClass"],[3,"matTooltip","matTooltipPosition",4,"ngIf"],["fxFlex","0 1 auto","fxLayout","row","fxLayoutAlign","start center",1,""],[1,"toolbar-separator"],["type","button","mat-raised-button","","color","accent","id","googleSheet",1,"m-8",3,"ngClass"],["googleSheet",""],["type","button","mat-raised-button","","color","accent","id","googleSheet2",1,"m-8",3,"ngClass","click"],["type","button","mat-raised-button","","color","accent","class","m-8","id","googleSheet3",3,"click",4,"ngIf"],["mat-icon-button","",1,"ml-8","mr-8",3,"click"],["color","accent"],["mat-icon-button","","class","ml-8",3,"click",4,"ngIf"],["fxHide","","fxShow.gt-xs","",1,"toolbar-separator"],[3,"matTooltip","matTooltipPosition"],["type","button","mat-raised-button","","color","accent","id","googleSheet3",1,"m-8",3,"click"],["mat-icon-button","",1,"ml-8",3,"click"]],template:function(e,t){1&e&&(M.Xb(0,"mat-toolbar",0),M.Xb(1,"div",1),M.Xb(2,"div",2),M.Xb(3,"div",3),M.Xb(4,"button",4),M.fc("click",(function(e){return t.toggleSidebar.emit(t.sidebarName)})),M.Xb(5,"mat-icon"),M.Lc(6,"menu"),M.Wb(),M.Wb(),M.Xb(7,"button",5),M.fc("click",(function(e){return t.showHideBar.emit()})),M.Xb(8,"mat-icon"),M.Lc(9,"menu"),M.Wb(),M.Wb(),M.Wb(),M.Xb(10,"div",6),M.Jc(11,ee,2,0,"span",7),M.Xb(12,"span"),M.Lc(13),M.Wb(),M.Wb(),M.Xb(14,"div",8),M.Jc(15,te,2,2,"span",9),M.Jc(16,ie,2,0,"span",7),M.Wb(),M.Wb(),M.Xb(17,"div",10),M.Sb(18,"div",11),M.Xb(19,"button",12,13),M.Xb(21,"span"),M.Lc(22,"Get file"),M.Wb(),M.Wb(),M.Xb(23,"button",14),M.fc("click",(function(e){return t.checkForm()})),M.Xb(24,"span"),M.Lc(25,"Get file1"),M.Wb(),M.Wb(),M.Jc(26,re,3,0,"button",15),M.Sb(27,"div",11),M.Xb(28,"button",16),M.fc("click",(function(e){return e.stopPropagation(),t.refreshPage.emit()})),M.Xb(29,"mat-icon",17),M.Lc(30,"refresh"),M.Wb(),M.Wb(),M.Sb(31,"div",11),M.Jc(32,ne,3,0,"button",18),M.Jc(33,ae,3,0,"button",18),M.Sb(34,"div",19),M.Wb(),M.Wb(),M.Wb()),2&e&&(M.Db(10),M.pc("ngClass",M.sc(11,ce,t.errorMessage.status,!t.errorMessage.status)),M.Db(1),M.pc("ngIf",t.errorMessage.status),M.Db(2),M.Mc(t.errorMessage.value),M.Db(1),M.pc("ngClass",M.sc(14,ce,t.errorMessage.status,!t.errorMessage.status)),M.Db(1),M.pc("ngIf",t.errorMessage.status),M.Db(1),M.pc("ngIf",!t.errorMessage.status&&t.errorMessage.value),M.Db(3),M.pc("ngClass",M.rc(17,le,t.token||!t.validForm||0!=t.step)),M.Db(4),M.pc("ngClass",M.rc(19,le,t.validForm||0!=t.step)),M.Db(3),M.pc("ngIf",t.validForm&&t.token&&0==t.step),M.Db(6),M.pc("ngIf",!t.fullScreen),M.Db(1),M.pc("ngIf",t.fullScreen))},directives:[k.a,Q.b,Q.e,Q.d,Q.c,b.b,Z.b,f.a,a.q,Z.a,a.t,d.a],styles:["file-import-invoice-header{position:relative;display:-webkit-box;display:flex;-webkit-box-flex:0;flex:0 0 auto;z-index:4}file-import-invoice-header.below{z-index:2}file-import-invoice-header .mat-toolbar{position:relative;background:#fff!important;color:inherit!important}file-import-invoice-header .logo{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}file-import-invoice-header .logo .logo-icon{width:38px}file-import-invoice-header .chat-panel-toggle-button,file-import-invoice-header .language-button,file-import-invoice-header .quick-panel-toggle-button,file-import-invoice-header .user-button,file-import-invoice-header fuse-search-bar{min-width:64px;height:64px}@media screen and (max-width:599px){file-import-invoice-header .chat-panel-toggle-button,file-import-invoice-header .language-button,file-import-invoice-header .quick-panel-toggle-button,file-import-invoice-header .user-button,file-import-invoice-header fuse-search-bar{height:56px}}file-import-invoice-header .navbar-toggle-button{min-width:56px;height:56px}file-import-invoice-header .toolbar-separator{height:64px;width:1px;background:#e6e6e6}@media screen and (max-width:599px){file-import-invoice-header .toolbar-separator{height:56px}}file-import-invoice-header #fileImport-detail-search-bar{display:-webkit-box;display:flex;-webkit-box-flex:0;flex:0 1 auto;min-width:64px;height:64px;font-size:13px}@media screen and (max-width:599px){file-import-invoice-header #fileImport-detail-search-bar{height:56px}}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content{display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 1 auto;-webkit-box-align:center;align-items:center;-webkit-box-pack:start;justify-content:flex-start}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-collapser,file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-expander{cursor:pointer;padding:0 20px;margin:0;width:64px!important;height:64px!important;line-height:64px!important}@media screen and (max-width:599px){file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-collapser,file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-expander{height:56px!important;line-height:56px!important}}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-loader{width:64px!important;height:64px!important;line-height:64px!important}@media screen and (max-width:599px){file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-loader{height:56px!important;line-height:56px!important}}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content .fileImport-detail-search-bar-collapser{display:none}file-import-invoice-header #fileImport-detail-search-bar .fileImport-detail-search-bar-content #fileImport-detail-search-bar-input{display:none;-webkit-box-flex:1;flex:1 0 auto;min-height:64px;font-size:16px;background-color:transparent;color:currentColor}file-import-invoice-header #fileImport-detail-search-bar.expanded{position:absolute;top:0;right:0;bottom:0;left:0;z-index:10;background:#f5f5f5}file-import-invoice-header #fileImport-detail-search-bar.expanded .fileImport-detail-search-bar-content #fileImport-detail-search-bar-input{display:-webkit-box;display:flex}file-import-invoice-header #fileImport-detail-search-bar.expanded .fileImport-detail-search-bar-content .fileImport-detail-search-bar-collapser{display:block}"],encapsulation:2}),oe),be=i("fE3o"),ue=i("0Zc1"),pe=function(e,t,i,r){return{current:e,completed:t,last:i,first:r}};function me(e,t){if(1&e){var i=M.Yb();M.Xb(0,"div",5),M.fc("click",(function(e){M.Bc(i);var r=t.index;return M.jc().gotoStep(r)})),M.Xb(1,"div",6),M.Xb(2,"span"),M.Lc(3),M.Wb(),M.Wb(),M.Xb(4,"div",7),M.Lc(5),M.Wb(),M.Wb()}if(2&e){var r=t.$implicit,n=t.index,a=t.last,o=t.first,c=M.jc();M.pc("ngClass",M.uc(3,pe,c.currentStep===n,c.currentStep>n,a,o)),M.Db(3),M.Mc(n+1),M.Db(2),M.Mc(r.title)}}var fe,de=((fe=function(){function e(t,i,r,n,a){_classCallCheck(this,e),this.formBuilder=t,this.authService=i,this.router=r,this.commonService=n,this.googleApiService=a,this.getUpdate=new M.o,this.viewChanged=new M.o,this.height=560,this.steps=[{title:"Set info import",url:"/apps/sel-admin/invoice-import/file-import/view"},{title:"Import to server",url:"/apps/sel-admin/invoice-import/file-import/table"}],this._unsubscribeAll=new O.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.currentStep=0,this.authService.windowSizeChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t.height-64-64-12})),this.authService.changeScreen.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t?e.authService.screenHeight-64-12:e.authService.screenHeight-64-64-12})),this.googleApiService.stepChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.changeStep(t)}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"gotoStep",value:function(e){0==e&&this.googleApiService.stepChanged.next(e)}},{key:"changeStep",value:function(e){this.currentStep!=e&&this.router.navigate([this.steps[e].url]),this.currentStep=e}}]),e}()).\u0275fac=function(e){return new(e||fe)(M.Rb(V.d),M.Rb(q.a),M.Rb(n.g),M.Rb(ue.a),M.Rb(Y.a))},fe.\u0275cmp=M.Lb({type:fe,selectors:[["file-import-invoice-sidebar"]],inputs:{view:"view",column:"column",supplier:"supplier",moveType:"moveType"},outputs:{getUpdate:"getUpdate",viewChanged:"viewChanged"},decls:5,vars:3,consts:[[1,"navbar-top"],["fxLayout","row","fxLayoutAlign","space-between center"],["fusePerfectScrollbar","",1,"navbar-scroll-fileImport"],[1,"steps"],["class","step",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"step",3,"ngClass","click"],[1,"index"],[1,"title"]],template:function(e,t){1&e&&(M.Xb(0,"div",0),M.Sb(1,"div",1),M.Wb(),M.Xb(2,"div",2),M.Xb(3,"div",3),M.Jc(4,me,6,8,"div",4),M.Wb(),M.Wb()),2&e&&(M.Db(2),M.Ic("height",t.height,"px"),M.Db(2),M.pc("ngForOf",t.steps))},directives:[Q.d,Q.c,J.a,a.s,a.q,Z.a],styles:['file-import-invoice-sidebar .navbar-top{background:#fff!important;padding:13px 0;-webkit-box-pack:center;justify-content:center;height:65px;border-bottom:1px solid #a3a3a3}file-import-invoice-sidebar .navbar-scroll-fileImport{background:#fff!important}file-import-invoice-sidebar .navbar-scroll-fileImport .steps{padding:16px 0}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step{position:relative;display:-webkit-box;display:flex;-webkit-box-pack:start;justify-content:flex-start;-webkit-box-align:center;align-items:center;padding:16px;cursor:pointer}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.current .index span{border:2px solid}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.current .title{font-weight:700}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.completed .index span{border:2px solid}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.first .index:before,file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step.last .index:after{display:none}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index{display:-webkit-box;display:flex;margin-right:12px}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index:after,file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index:before{position:absolute;display:block;content:" ";border-left:1px solid;width:1px;height:50%;left:29px;z-index:8}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index:before{top:0}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index:after{bottom:0}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .index span{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;position:relative;width:28px;min-width:28px;max-width:28px;height:28px;border-radius:100%;border:2px solid;font-weight:700;font-size:12px;z-index:10}file-import-invoice-sidebar .navbar-scroll-fileImport .steps .step .title,navbar .navbar-top{display:-webkit-box;display:flex}navbar .navbar-top{-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-flex:1;flex:1 0 auto;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;min-height:64px;max-height:64px;height:64px;padding:12px 12px 12px 20px}@media screen and (max-width:599px){navbar .navbar-top{min-height:56px;max-height:56px;height:56px}}navbar .navbar-scroll-fileImport{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-flex:1;flex:1 1 auto;overflow-y:auto;-webkit-overflow-scrolling:touch;background:-webkit-gradient(linear,left top,left bottom,color-stop(30%,transparent),color-stop(30%,transparent)),-webkit-gradient(linear,left top,left bottom,color-stop(0,rgba(0,0,0,.25)),color-stop(40%,transparent));background:linear-gradient(transparent 30%,transparent 0),linear-gradient(rgba(0,0,0,.25),transparent 40%);background-repeat:no-repeat;background-size:100% 40px,100% 10px;background-attachment:local,scroll}navbar .navbar-scroll-fileImport .navbar-content{-webkit-box-flex:1;flex:1 1 auto;padding-top:32px}'],encapsulation:2}),fe);function he(e,t){1&e&&(M.Xb(0,"fuse-sidebar",6),M.Xb(1,"div",7),M.Sb(2,"file-import-invoice-sidebar"),M.Wb(),M.Wb())}function ve(e,t){1&e&&M.Sb(0,"router-outlet")}var ge,ye=((ge=function(){function e(t,i,r,n,a,o){_classCallCheck(this,e),this._fuseSidebarService=t,this.authService=i,this.fileImportService=r,this.router=n,this.route=a,this.datePipe=o,this.height=560,this.sidebarPanel=!0,this.errorMessage={status:!1,value:""},this._unsubscribeAll=new O.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.id="test",this.authService.windowSizeChanged.pipe(Object(R.takeUntil)(this._unsubscribeAll)).subscribe((function(t){e.height=t.height-64-12-12-54-62})),this.authService.changeScreen.pipe(Object(R.takeUntil)(this._unsubscribeAll)).subscribe((function(t){e.height=t?e.authService.screenHeight-12-12-54-62:e.authService.screenHeight-64-12-12-54-62}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"toggleSidebar",value:function(e){this._fuseSidebarService.getSidebar(e).toggleOpen()}},{key:"newFileImportInvoice",value:function(e){this.router.navigate(["/apps/workflow/fileImport/list"])}},{key:"showHideBar",value:function(e){this.sidebarPanel=!this.sidebarPanel}},{key:"refreshPage",value:function(e){this.authService.refreshData(this.fileImportService)}}]),e}()).\u0275fac=function(e){return new(e||ge)(M.Rb(T.a),M.Rb(q.a),M.Rb(B),M.Rb(n.g),M.Rb(n.a),M.Rb(a.f))},ge.\u0275cmp=M.Lb({type:ge,selectors:[["file-import-invoice"]],decls:6,vars:5,consts:[["id","file-import-invoice",1,"page-layout","simple","left-sidebar","inner-scroll"],["class","sidebar","name","file-import-invoice-sidebar","position","left","lockedOpen","gt-md",4,"ngIf"],["fusePerfectScrollbar","",1,"center"],[3,"sidebarName","spreadsheetId","errorMessage","showHideBar","refreshPage","toggleSidebar"],[1,"content","p-8",2,"background","white"],[4,"ngIf"],["name","file-import-invoice-sidebar","position","left","lockedOpen","gt-md",1,"sidebar"],[1,"content"]],template:function(e,t){1&e&&(M.Xb(0,"div",0),M.Jc(1,he,3,0,"fuse-sidebar",1),M.Xb(2,"div",2),M.Xb(3,"file-import-invoice-header",3),M.fc("showHideBar",(function(e){return t.showHideBar(e)}))("refreshPage",(function(e){return t.refreshPage(e)}))("toggleSidebar",(function(e){return t.toggleSidebar(e)})),M.Wb(),M.Xb(4,"div",4),M.Jc(5,ve,1,0,"router-outlet",5),M.Wb(),M.Wb(),M.Wb()),2&e&&(M.Db(1),M.pc("ngIf",t.sidebarPanel),M.Db(2),M.pc("sidebarName","file-import-invoice-sidebar")("spreadsheetId",t.id)("errorMessage",t.errorMessage),M.Db(2),M.pc("ngIf",!0))},directives:[E.a,a.t,J.a,se,be.a,de,n.l],styles:[""]}),ge),xe=i("PVWW");function ke(e){var t=e.value;return""==t?null:t&&t.match(/^[A-Z]\d{1,}[:][A-Z]\d{1,}$/g)?null:{validRange:!0}}var Se=["formDirective"],Xe=["googleSheet"];function We(e,t){if(1&e&&(M.Xb(0,"mat-radio-button",6),M.Xb(1,"span"),M.Lc(2),M.Wb(),M.Wb()),2&e){var i=t.$implicit,r=M.jc();M.pc("value",i.id)("checked",r.form.value.dateType==i.id),M.Db(2),M.Mc(i.code)}}var Ie,we=function(){return{value:"50"}},_e=((Ie=function(){function e(t,i,r,n,a,o,c,l,s){_classCallCheck(this,e),this.router=t,this.route=i,this.authService=r,this.fileImportService=n,this.googleApiService=a,this.datePipe=o,this.formBuilder=c,this.commonService=l,this.ngZone=s,this.data=[],this.height=560,this.spreadsheetId=null,this.form=this.formBuilder.group({invoice_type:["revenue",V.y.required],invoice_code:["AA/"+((new Date).getFullYear()-2e3).toString()+"E",V.y.required],range:["A1:S1000",ke],header:[!0],dateType:[2],column:this.formBuilder.group({invoice_number:[5,V.y.required],issue_date:[4,V.y.required],party:[1,V.y.required],price:[6,V.y.required],unit:[8,V.y.required],volume:[9,V.y.required],amount:[10,V.y.required],t_amount:[11,V.y.required],t_tax:[12,V.y.required],exrate:[13,V.y.required],info:[14,V.y.required]})}),this.sheetProperties=[],this.country={},this.party={},this.price={},this.unit={},this.currency={},this.user={},this.partymisa={},this.pricemisa={},this.selInvoice={},this._unsubscribeAll=new O.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.authService.windowSizeChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t.height-64-12-12-54-8})),this.authService.changeScreen.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t?e.authService.screenHeight-12-12-54-8:e.authService.screenHeight-64-12-12-54-8})),this.fileImportService.onDataChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.country=e.fileImportService.country,e.party=e.fileImportService.party,e.price=e.fileImportService.price,e.unit=e.fileImportService.unit,e.currency=e.fileImportService.currency,e.user=e.fileImportService.user,e.partymisa=e.fileImportService.partymisa,e.pricemisa=e.fileImportService.pricemisa,e.selInvoice=e.fileImportService.selInvoice,e.type=e.fileImportService.type,e.invoiceType=e.fileImportService.invoiceType})),this.googleApiService.onFileChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){t&&t.length>0&&e.form.valid?e.ngZone.run((function(){e.data=t,e.data=e.fileImportService.createData(t,e.form.value,e.selInvoice),e.googleApiService.onFileDataChanged.next([e.data,e.form.value.invoice_type]),e.googleApiService.stepChanged.next(1)})):e.data=[]})),this.googleApiService.onValidateForm.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){t&&e.validateFormDetail(!0)})),this.form.controls.invoice_type.valueChanges.subscribe((function(t){var i=e.invoiceType.find((function(e){return e.type==t}));i&&(e.form.controls.header.setValue(i.header),e.form.controls.invoice_code.setValue(i.invoiceCode),e.form.controls.range.setValue(i.range),e.form.controls.dateType.setValue(i.dateType),e.form.get("column.invoice_number").setValue(i.column[0]),e.form.get("column.party").setValue(i.column[1]),e.form.get("column.issue_date").setValue(i.column[2]),e.form.get("column.price").setValue(i.column[3]),e.form.get("column.unit").setValue(i.column[4]),e.form.get("column.volume").setValue(i.column[5]),e.form.get("column.amount").setValue(i.column[6]),e.form.get("column.t_amount").setValue(i.column[7]),e.form.get("column.t_tax").setValue(i.column[8]),e.form.get("column.exrate").setValue(i.column[9]),e.form.get("column.info").setValue(i.column[10]),e.googleApiService.form=i,e.googleApiService.validForm=e.form.valid,e.googleApiService.onFormChanged.next(e.form.valid))})),this.form.valueChanges.subscribe((function(t){e.form.valid&&"string"!=typeof t.place?(e.googleApiService.form=t,e.googleApiService.validForm=e.form.valid,e.googleApiService.onFormChanged.next(!0)):e.googleApiService.onFormChanged.next(!1)})),this.googleApiService.onFormChanged.next(this.form.valid)}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"ngAfterViewInit",value:function(){var e=this;this.googleApiService.form&&setTimeout((function(){e.form.patchValue(e.googleApiService.form)}))}},{key:"validateFormDetail",value:function(e){!0===e&&(this.markFormGroupTouched(this.form),this.googleApiService.validForm=!1,!0===this.form.valid&&(this.googleApiService.form=this.form.value,this.googleApiService.validForm=!0,this.googleApiService.onFormChanged.next(!0)))}},{key:"markFormGroupTouched",value:function(e){var t=this;Object.values(e.controls).forEach((function(e){e.markAsTouched(),e.controls&&t.markFormGroupTouched(e)}))}},{key:"checkColumn",value:function(e,t){var i=this.form.value.column;i.date==t&&"date"!=e&&this.form.get("column.date").setValue(null),i.transaction==t&&"transaction"!=e&&this.form.get("column.transaction").setValue(null),i.content==t&&"content"!=e&&this.form.get("column.content").setValue(null),i.in==t&&"in"!=e&&this.form.get("column.in").setValue(null),i.out==t&&"out"!=e&&this.form.get("column.out").setValue(null)}}]),e}()).\u0275fac=function(e){return new(e||Ie)(M.Rb(n.g),M.Rb(n.a),M.Rb(q.a),M.Rb(B),M.Rb(Y.a),M.Rb(a.f),M.Rb(V.d),M.Rb(ue.a),M.Rb(M.A))},Ie.\u0275cmp=M.Lb({type:Ie,selectors:[["file-import-invoice-view"]],viewQuery:function(e,t){var i;1&e&&(M.Sc(Se,!0),M.Sc(Xe,!0)),2&e&&(M.wc(i=M.gc())&&(t.templaceNgForm=i.first),M.wc(i=M.gc())&&(t.googleSheet=i.first))},decls:158,vars:16,consts:[["fxLayout","column","fxLayoutAlign","start start"],["name","form",1,"w-100-p",2,"overflow","auto",3,"formGroup","keydown.enter"],["formDirective","ngForm"],[1,"simple","table-format","w-100-p"],[1,"h-60"],["formControlName","invoice_type"],[1,"font-size-12","mb-4",3,"value","checked"],["colspan","5"],["appearance","outline",1,"my-form-field"],["matInput","","inputCheck","","formControlName","invoice_code"],[1,"w-240"],["formGroupName","column"],["appearance","outline",1,"my-form-field",2,"width","110px"],["type","number","inputCheck","","matInput","","formControlName","invoice_number","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","issue_date","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","party","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","price","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","unit","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","volume","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","amount","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","t_amount","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","t_tax","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","exrate","required","",2,"font-size","12px"],["type","number","inputCheck","","matInput","","formControlName","info","required","",2,"font-size","12px"],["fxLayout","row","fxLayoutAlign","start start"],["fxFlex","20",1,"p-4"],["fxFlex","80","formControlName","dateType","fxLayout","column","fxLayoutAlign","start"],["class","font-size-12 mb-4",3,"value","checked",4,"ngFor","ngForOf"],["appearance","outline","floatLabel","never",1,"my-form-field",2,"width","230px"],["matInput","","inputCheck","","formControlName","range","placeholder","Example: A1:C10 OR None","maxlength","11"],[1,"text-right"],[1,"mr-16"],["colspan","8"],["formControlName","header","fxLayout","row","fxLayoutAlign","start"],[3,"value","checked"],[1,"ml-4",3,"value"]],template:function(e,t){1&e&&(M.Xb(0,"div",0),M.Xb(1,"form",1,2),M.fc("keydown.enter",(function(e){return"TEXTAREA"==e.target.tagName})),M.Xb(3,"table",3),M.Xb(4,"thead"),M.Xb(5,"tr",4),M.Xb(6,"th"),M.Lc(7,"Invoice"),M.Wb(),M.Xb(8,"th"),M.Xb(9,"mat-radio-group",5),M.Xb(10,"mat-radio-button",6),M.Lc(11,"Revenue"),M.Wb(),M.Wb(),M.Wb(),M.Xb(12,"th"),M.Xb(13,"mat-radio-group",5),M.Xb(14,"mat-radio-button",6),M.Lc(15,"Cost"),M.Wb(),M.Wb(),M.Wb(),M.Sb(16,"th"),M.Sb(17,"th"),M.Sb(18,"th"),M.Wb(),M.Xb(19,"tr"),M.Xb(20,"th"),M.Lc(21,"Invoice code"),M.Wb(),M.Xb(22,"th",7),M.Xb(23,"mat-form-field",8),M.Sb(24,"input",9),M.Wb(),M.Wb(),M.Wb(),M.Xb(25,"tr",4),M.Xb(26,"th"),M.Lc(27,"SHEET"),M.Wb(),M.Xb(28,"th",10),M.Lc(29,"Column 1"),M.Wb(),M.Xb(30,"th"),M.Lc(31,"Column 2"),M.Wb(),M.Xb(32,"th"),M.Lc(33,"Column 3"),M.Wb(),M.Xb(34,"th"),M.Lc(35,"Column 4"),M.Wb(),M.Xb(36,"th"),M.Lc(37,"Column 5"),M.Wb(),M.Xb(38,"th"),M.Lc(39,"Column 6"),M.Wb(),M.Xb(40,"th"),M.Lc(41,"Column 7"),M.Wb(),M.Xb(42,"th"),M.Lc(43,"Column 8"),M.Wb(),M.Xb(44,"th"),M.Lc(45,"Column 9"),M.Wb(),M.Xb(46,"th"),M.Lc(47,"Column 10"),M.Wb(),M.Xb(48,"th"),M.Lc(49,"Column 11"),M.Wb(),M.Wb(),M.Wb(),M.Xb(50,"tbody"),M.Xb(51,"tr",4),M.Xb(52,"td"),M.Lc(53,"NAME"),M.Wb(),M.Xb(54,"td",10),M.Lc(55,"invoice_number"),M.Wb(),M.Xb(56,"td"),M.Lc(57,"issue_date"),M.Wb(),M.Xb(58,"td"),M.Lc(59,"party"),M.Wb(),M.Xb(60,"td"),M.Lc(61,"price"),M.Wb(),M.Xb(62,"td"),M.Lc(63,"unit"),M.Wb(),M.Xb(64,"td"),M.Lc(65,"volume"),M.Wb(),M.Xb(66,"td"),M.Lc(67,"amount"),M.Wb(),M.Xb(68,"td"),M.Lc(69,"t_amount"),M.Wb(),M.Xb(70,"td"),M.Lc(71,"t_tax"),M.Wb(),M.Xb(72,"td"),M.Lc(73,"exrate"),M.Wb(),M.Xb(74,"td"),M.Lc(75,"info"),M.Wb(),M.Wb(),M.Xb(76,"tr",11),M.Xb(77,"td"),M.Lc(78,"COLUMN"),M.Wb(),M.Xb(79,"td"),M.Xb(80,"mat-form-field",12),M.Sb(81,"input",13),M.Wb(),M.Wb(),M.Xb(82,"td"),M.Xb(83,"mat-form-field",12),M.Sb(84,"input",14),M.Wb(),M.Wb(),M.Xb(85,"td"),M.Xb(86,"mat-form-field",12),M.Sb(87,"input",15),M.Wb(),M.Wb(),M.Xb(88,"td"),M.Xb(89,"mat-form-field",12),M.Sb(90,"input",16),M.Wb(),M.Wb(),M.Xb(91,"td"),M.Xb(92,"mat-form-field",12),M.Sb(93,"input",17),M.Wb(),M.Wb(),M.Xb(94,"td"),M.Xb(95,"mat-form-field",12),M.Sb(96,"input",18),M.Wb(),M.Wb(),M.Xb(97,"td"),M.Xb(98,"mat-form-field",12),M.Sb(99,"input",19),M.Wb(),M.Wb(),M.Xb(100,"td"),M.Xb(101,"mat-form-field",12),M.Sb(102,"input",20),M.Wb(),M.Wb(),M.Xb(103,"td"),M.Xb(104,"mat-form-field",12),M.Sb(105,"input",21),M.Wb(),M.Wb(),M.Xb(106,"td"),M.Xb(107,"mat-form-field",12),M.Sb(108,"input",22),M.Wb(),M.Wb(),M.Xb(109,"td"),M.Xb(110,"mat-form-field",12),M.Sb(111,"input",23),M.Wb(),M.Wb(),M.Wb(),M.Xb(112,"tr"),M.Xb(113,"td"),M.Lc(114,"FORMAT"),M.Wb(),M.Xb(115,"td",10),M.Xb(116,"div",24),M.Xb(117,"span",25),M.Lc(118,"DATE:"),M.Wb(),M.Xb(119,"mat-radio-group",26),M.Jc(120,We,3,3,"mat-radio-button",27),M.Wb(),M.Wb(),M.Wb(),M.Xb(121,"td"),M.Lc(122,"Text value"),M.Wb(),M.Xb(123,"td"),M.Lc(124,"Text value"),M.Wb(),M.Xb(125,"td"),M.Lc(126,"Number"),M.Wb(),M.Xb(127,"td"),M.Lc(128,"Number"),M.Wb(),M.Xb(129,"td"),M.Lc(130,"Text value"),M.Wb(),M.Xb(131,"td"),M.Lc(132,"Text value"),M.Wb(),M.Xb(133,"td"),M.Lc(134,"Text value"),M.Wb(),M.Xb(135,"td"),M.Lc(136,"Text value"),M.Wb(),M.Xb(137,"td"),M.Lc(138,"Text value"),M.Wb(),M.Xb(139,"td"),M.Lc(140,"Text value"),M.Wb(),M.Wb(),M.Xb(141,"tr"),M.Xb(142,"td"),M.Lc(143,"RANGE"),M.Wb(),M.Xb(144,"td"),M.Xb(145,"mat-form-field",28),M.Sb(146,"input",29),M.Wb(),M.Wb(),M.Xb(147,"td",30),M.Xb(148,"span",31),M.Lc(149,"HEADER"),M.Wb(),M.Wb(),M.Xb(150,"td",32),M.Xb(151,"mat-radio-group",33),M.Xb(152,"mat-radio-button",34),M.Lc(153,"None"),M.Wb(),M.Xb(154,"mat-radio-button",35),M.Lc(155,"First row"),M.Wb(),M.Wb(),M.Wb(),M.Wb(),M.Wb(),M.Wb(),M.Wb(),M.Lc(156),M.kc(157,"json"),M.Wb()),2&e&&(M.pc("@animateStagger",M.qc(15,we)),M.Db(1),M.Ic("height",t.height,"px"),M.pc("formGroup",t.form),M.Db(9),M.pc("value","revenue")("checked","revenue"==t.form.value.invoice_type),M.Db(4),M.pc("value","cost")("checked","cost"==t.form.value.invoice_type),M.Db(106),M.pc("ngForOf",t.type),M.Db(32),M.pc("value",!1)("checked",!t.form.value.header),M.Db(2),M.pc("value",!0),M.Db(2),M.Nc(" ",M.lc(157,13,t.data),"\n"))},directives:[Q.d,Q.c,V.A,V.q,V.h,y.b,V.p,V.g,y.a,m.c,h.b,V.b,V.i,V.u,V.w,Q.b,a.s,V.k],pipes:[a.k],styles:["file-import-invoice-view .table-format{font-size:12px}file-import-invoice-view .table-format td,file-import-invoice-view .table-format th{padding:4px!important}file-import-invoice-view .table-format .my-form-field{width:100%}file-import-invoice-view .table-format .my-form-field .mat-form-field-wrapper{margin-bottom:-1.25em}file-import-invoice-view .table-format .my-form-field .mat-form-field-infix{margin-top:-.75em}file-import-invoice-view .table-format .my-form-field .mat-select-value-text{font-size:12px}file-import-invoice-view cdk-virtual-scroll-viewport{width:100%}file-import-invoice-view cdk-virtual-scroll-viewport .file-import-invoice-table{font-size:12px}file-import-invoice-view cdk-virtual-scroll-viewport .file-import-invoice-table thead th{position:sticky;position:-webkit-sticky;top:0;background:#fff;z-index:10}file-import-invoice-view cdk-virtual-scroll-viewport .file-import-invoice-table td,file-import-invoice-view cdk-virtual-scroll-viewport .file-import-invoice-table th{padding:8px!important;font-size:12px}"],encapsulation:2,data:{animation:xe.a}}),Ie),Ce=i("JX91"),Le=i("lJxs"),De=i("FKr1");function Ae(e,t){1&e&&(M.Xb(0,"mat-error"),M.Lc(1," misa_party is required "),M.Wb())}function Pe(e,t){1&e&&(M.Xb(0,"mat-error"),M.Lc(1," misa_party is too long (max length = 25); "),M.Wb())}function Fe(e,t){if(1&e&&(M.Xb(0,"mat-option",25),M.Lc(1),M.Wb()),2&e){var i=t.$implicit;M.pc("value",i),M.Db(1),M.Oc("",i.short_name,"-",i.full_name,"")}}function je(e,t){1&e&&(M.Xb(0,"mat-error"),M.Lc(1," Party is required "),M.Wb())}function Re(e,t){if(1&e){var i=M.Yb();M.Xb(0,"div"),M.Xb(1,"form",7),M.fc("keydown.enter",(function(e){return M.Bc(i),"TEXTAREA"==e.target.tagName}))("ngSubmit",(function(e){M.Bc(i);var t=M.jc();return t.onPartymisaFormSubmit(t.formPartymisa)})),M.Xb(2,"div",8),M.Xb(3,"mat-form-field",9),M.Xb(4,"mat-label"),M.Lc(5,"Misa party"),M.Wb(),M.Sb(6,"input",10),M.Jc(7,Ae,2,0,"mat-error",6),M.Jc(8,Pe,2,0,"mat-error",6),M.Wb(),M.Xb(9,"mat-form-field",11),M.Xb(10,"mat-label"),M.Lc(11,"Party"),M.Wb(),M.Sb(12,"input",12),M.Xb(13,"mat-autocomplete",13,14),M.Jc(15,Fe,2,3,"mat-option",15),M.kc(16,"async"),M.Wb(),M.Jc(17,je,2,0,"mat-error",6),M.Wb(),M.Xb(18,"mat-form-field",16),M.Xb(19,"mat-label"),M.Lc(20,"Info"),M.Wb(),M.Sb(21,"input",17),M.Wb(),M.Xb(22,"mat-form-field",16),M.Xb(23,"mat-label"),M.Lc(24,"Update by"),M.Wb(),M.Sb(25,"input",18),M.Sb(26,"input",19),M.Wb(),M.Wb(),M.Xb(27,"div",20),M.Xb(28,"div",21),M.Lc(29),M.Wb(),M.Wb(),M.Xb(30,"div",22),M.Xb(31,"button",23),M.Lc(32,"Submit"),M.Wb(),M.Xb(33,"button",24),M.fc("click",(function(e){return M.Bc(i),M.jc().matDialogRef.close()})),M.Lc(34,"Cancel"),M.Wb(),M.Wb(),M.Wb(),M.Wb()}if(2&e){var r=M.xc(14),n=M.jc();M.Db(1),M.pc("formGroup",n.formPartymisa),M.Db(6),M.pc("ngIf",n.formPartymisa.get("misa_party").hasError("required")),M.Db(1),M.pc("ngIf",!n.formPartymisa.get("misa_party").hasError("required")&&n.formPartymisa.get("misa_party").hasError("maxLength")),M.Db(4),M.pc("matAutocomplete",r),M.Db(1),M.pc("displayWith",n.commonService.displayObjFn.bind(n,"full_name")),M.Db(2),M.pc("ngForOf",M.lc(16,9,n.filteredParty)),M.Db(2),M.pc("ngIf",n.formPartymisa.get("party").hasError("required")),M.Db(8),M.pc("value",n.name),M.Db(4),M.Mc(n.errorMessage)}}function Oe(e,t){1&e&&(M.Xb(0,"mat-error"),M.Lc(1," misa_price is required "),M.Wb())}function Me(e,t){1&e&&(M.Xb(0,"mat-error"),M.Lc(1," misa_price is too long (max length = 25); "),M.Wb())}function Te(e,t){if(1&e&&(M.Xb(0,"mat-option",25),M.Lc(1),M.Wb()),2&e){var i=t.$implicit;M.pc("value",i),M.Db(1),M.Oc("",i.code," - ",i.name,"")}}function qe(e,t){1&e&&(M.Xb(0,"mat-error"),M.Lc(1," Price is required "),M.Wb())}function Ne(e,t){if(1&e){var i=M.Yb();M.Xb(0,"div"),M.Xb(1,"form",26),M.fc("keydown.enter",(function(e){return M.Bc(i),"TEXTAREA"==e.target.tagName}))("ngSubmit",(function(e){M.Bc(i);var t=M.jc();return t.onPricemisaFormSubmit(t.formPricemisa)})),M.Xb(2,"div",8),M.Xb(3,"mat-form-field",9),M.Xb(4,"mat-label"),M.Lc(5,"Misa price"),M.Wb(),M.Sb(6,"input",27),M.Jc(7,Oe,2,0,"mat-error",6),M.Jc(8,Me,2,0,"mat-error",6),M.Wb(),M.Xb(9,"mat-form-field",11),M.Xb(10,"mat-label"),M.Lc(11,"Price"),M.Wb(),M.Sb(12,"input",28),M.Xb(13,"mat-autocomplete",13,29),M.Jc(15,Te,2,3,"mat-option",15),M.kc(16,"async"),M.Wb(),M.Jc(17,qe,2,0,"mat-error",6),M.Wb(),M.Xb(18,"mat-form-field",16),M.Xb(19,"mat-label"),M.Lc(20,"Info"),M.Wb(),M.Sb(21,"input",17),M.Wb(),M.Xb(22,"mat-form-field",16),M.Xb(23,"mat-label"),M.Lc(24,"Update by"),M.Wb(),M.Sb(25,"input",18),M.Sb(26,"input",19),M.Wb(),M.Wb(),M.Xb(27,"div",20),M.Xb(28,"div",21),M.Lc(29),M.Wb(),M.Wb(),M.Xb(30,"div",22),M.Xb(31,"button",23),M.Lc(32,"Submit"),M.Wb(),M.Xb(33,"button",24),M.fc("click",(function(e){return M.Bc(i),M.jc().matDialogRef.close()})),M.Lc(34,"Cancel"),M.Wb(),M.Wb(),M.Wb(),M.Wb()}if(2&e){var r=M.xc(14),n=M.jc();M.Db(1),M.pc("formGroup",n.formPricemisa),M.Db(6),M.pc("ngIf",n.formPricemisa.get("misa_price").hasError("required")),M.Db(1),M.pc("ngIf",!n.formPricemisa.get("misa_price").hasError("required")&&n.formPricemisa.get("misa_price").hasError("maxLength")),M.Db(4),M.pc("matAutocomplete",r),M.Db(1),M.pc("displayWith",n.commonService.displayObjFn.bind(n,"name")),M.Db(2),M.pc("ngForOf",M.lc(16,9,n.filteredPrice)),M.Db(2),M.pc("ngIf",n.formPricemisa.get("price").hasError("required")),M.Db(8),M.pc("value",n.name),M.Db(4),M.Mc(n.errorMessage)}}var ze,Be=((ze=function(){function e(t,i,r,n,a,o,c){_classCallCheck(this,e),this.router=t,this.matDialogRef=i,this._data=r,this._formBuilder=n,this.authService=a,this.commonService=o,this.fileImportInvoiceService=c,this.formPartymisa=this._formBuilder.group({misa_party:[null,[V.y.required,V.y.maxLength(25)]],party:[null,V.y.required],info:[null],update_by:[this.authService.user]}),this.formPricemisa=this._formBuilder.group({id:[null],misa_price:[null,[V.y.required,V.y.maxLength(25)]],price:[null,V.y.required],info:[null],update_by:[this.authService.user]}),this.errorMessage="",this.label=r.label,this.party=r.party,this.price=r.price,this.invoiceType=r.invoiceType,this.name=this.authService.name,"Create party misa"==this.label&&(this.formPartymisa.controls.misa_party.setValue(r.data.party_misa),this.formPartymisa.controls.info.setValue(r.data.party_name)),"Create price misa"==this.label&&(this.formPricemisa.controls.misa_price.setValue(r.data.price_misa),this.formPricemisa.controls.info.setValue(r.data.price_name))}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.filteredParty=this.formPartymisa.controls.party.valueChanges.pipe(Object(Ce.a)(""),Object(Le.a)((function(e){return e?"string"==typeof e?e:e.partner_name:null})),Object(Le.a)((function(t){return t?e.commonService.filterData(t,"partner_name",e.party):[]}))),this.filteredPrice=this.formPricemisa.controls.price.valueChanges.pipe(Object(Ce.a)(""),Object(Le.a)((function(e){return e?"string"==typeof e?e:e.price_name:null})),Object(Le.a)((function(t){return t?e.commonService.filterData(t,"price_name",e.price):[]}))),this.formPartymisa.valueChanges.subscribe((function(t){e.errorMessage=""})),this.formPricemisa.valueChanges.subscribe((function(t){e.errorMessage=""}))}},{key:"onPartymisaFormSubmit",value:function(e){var t=this;if(e.valid){if("string"==typeof e.value.party)return void this.formPartymisa.controls.party.setValue(null);this.authService.onRequestChanged.next(!0);var i="revenue"==this.invoiceType?"customer":"supplier",r=JSON.parse(JSON.stringify(e.value));r["misa_"+i]=r.misa_party,r[i]=r.party.id,delete r.party,delete r.misa_party,r.update_by=this.authService.user,this.fileImportInvoiceService.createPartymisa(r,i).then((function(e){r.misa_party=r["misa_"+i],r.party=r[i],t.authService.onRequestChanged.next(!1),t.matDialogRef.close(r)})).catch((function(e){t.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)}))}}},{key:"onPricemisaFormSubmit",value:function(e){var t=this;this.authService.onRequestChanged.next(!0);var i=e.value;i.price=i.price.id,i.update_by=this.authService.user,this.fileImportInvoiceService.createPricemisa(i).then((function(e){t.authService.onRequestChanged.next(!1),t.matDialogRef.close(i)})).catch((function(e){t.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)}))}}]),e}()).\u0275fac=function(e){return new(e||ze)(M.Rb(n.g),M.Rb(x.f),M.Rb(x.a),M.Rb(V.d),M.Rb(q.a),M.Rb(ue.a),M.Rb(B))},ze.\u0275cmp=M.Lb({type:ze,selectors:[["file-import-invoice-modal-dialog"]],decls:11,vars:3,consts:[[1,"dialog-content-wrapper"],[1,"mat-accent","m-0"],["fxFlex","","fxLayout","row","fxLayoutAlign","space-between center"],[1,"title","dialog-title"],["mat-icon-button","","aria-label","Close dialog",3,"click"],["mat-dialog-content","","fusePerfectScrollbar","",1,"p-16","pb-0","m-0"],[4,"ngIf"],["fxLayout","column","fxLayoutAlign","start","name","formPartymisa",3,"formGroup","keydown.enter","ngSubmit"],["fxLayout","row wrap","fxLayoutAlign","start center","fxFlex","1 0 auto"],["appearance","outline","fxFlex","25",1,"pr-8"],["inputCheck","","matInput","","formControlName","misa_party","maxlength","25","required",""],["appearance","outline","fxFlex","75",1,"pr-8"],["inputCheck","","aria-label","party","matInput","","formControlName","party","required","",3,"matAutocomplete"],[3,"displayWith"],["autoParty","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline","fxFlex","50",1,"pr-8"],["inputCheck","","matInput","","formControlName","info"],["inputCheck","","matInput","","readonly","true",3,"value"],["inputCheck","","matInput","","formControlName","update_by",2,"display","none"],["fxLayout","row","fxLayoutAlign","start center","fxFlex","1 0 auto"],[1,"mat-error"],["fxLayout","row","fxLayoutAlign","center","fxFlex","1 0 auto",1,"p-16"],["type","submit","mat-raised-button","","color","accent",1,"mr-8"],["type","button","mat-raised-button","","color","warn",1,"mr-8",3,"click"],[3,"value"],["fxLayout","column","fxLayoutAlign","start","name","formPricemisa",3,"formGroup","keydown.enter","ngSubmit"],["inputCheck","","matInput","","formControlName","misa_price","maxlength","25","required",""],["inputCheck","","aria-label","price","matInput","","formControlName","price","required","",3,"matAutocomplete"],["autoPrice","matAutocomplete"]],template:function(e,t){1&e&&(M.Xb(0,"div",0),M.Xb(1,"mat-toolbar",1),M.Xb(2,"mat-toolbar-row",2),M.Xb(3,"span",3),M.Lc(4),M.Wb(),M.Xb(5,"button",4),M.fc("click",(function(e){return t.matDialogRef.close()})),M.Xb(6,"mat-icon"),M.Lc(7,"close"),M.Wb(),M.Wb(),M.Wb(),M.Wb(),M.Xb(8,"div",5),M.Jc(9,Re,35,11,"div",6),M.Jc(10,Ne,35,11,"div",6),M.Wb(),M.Wb()),2&e&&(M.Db(4),M.Mc(t.label),M.Db(5),M.pc("ngIf","Create party misa"==t.label),M.Db(1),M.pc("ngIf","Create price misa"==t.label))},directives:[k.a,k.c,Q.b,Q.d,Q.c,b.b,f.a,x.d,J.a,a.t,V.A,V.q,V.h,m.c,m.f,h.b,V.b,V.p,V.g,V.k,V.w,l.c,l.a,a.s,m.b,De.n],pipes:[a.b],styles:["@media screen and (min-width:600px)and (max-width:959px){.file-import-invoice-modal-dialog{width:100%}}@media screen and (min-width:960px){.file-import-invoice-modal-dialog{width:1080px}}.file-import-invoice-modal-dialog .mat-dialog-container{padding:0}.file-import-invoice-modal-dialog .dialog-content-wrapper{max-height:85vh;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.file-import-invoice-modal-dialog .mat-form-field-wrapper{margin:0 0 5px}.file-import-invoice-modal-dialog .primary-color-input,.file-import-invoice-modal-dialog .secondary-color-input{padding:6px 8px}"],encapsulation:2}),ze),Ee=i("R0Ic");function Je(e,t){if(1&e&&(M.Xb(0,"span"),M.Lc(1),M.Wb()),2&e){var i=M.jc().$implicit;M.Db(1),M.Mc(i.party_misa)}}function Ve(e,t){if(1&e){var i=M.Yb();M.Xb(0,"a",17),M.fc("click",(function(e){M.Bc(i);var t=M.jc().$implicit,r=M.jc(2);return e.stopPropagation(),r.createParty(t)})),M.Lc(1),M.Wb()}if(2&e){var r=M.jc().$implicit;M.Db(1),M.Mc(r.party_misa)}}function He(e,t){if(1&e){var i=M.Yb();M.Xb(0,"mat-icon",18),M.fc("click",(function(e){M.Bc(i);var t=M.jc().$implicit,r=M.jc(2);return e.stopPropagation(),r.saveImport([t])})),M.Lc(1,"save"),M.Wb()}}function Ue(e,t){if(1&e){var i=M.Yb();M.Xb(0,"mat-icon",19),M.fc("click",(function(e){M.Bc(i);var t=M.jc(),r=t.$implicit,n=t.index,a=M.jc(2);return e.stopPropagation(),a.deleteInvoice(r,n)})),M.Lc(1,"delete"),M.Wb()}}function Ge(e,t){if(1&e){var i=M.Yb();M.Xb(0,"mat-icon",19),M.fc("click",(function(e){M.Bc(i);var t=M.jc(),r=t.$implicit,n=t.index,a=M.jc(2);return e.stopPropagation(),a.deleteInvoice(r.duplicate,n)})),M.Lc(1,"delete"),M.Wb()}}function $e(e,t){if(1&e&&(M.Xb(0,"span"),M.Lc(1),M.Wb()),2&e){var i=M.jc().$implicit;M.Db(1),M.Mc(i.price_misa)}}function Ye(e,t){if(1&e){var i=M.Yb();M.Xb(0,"a",17),M.fc("click",(function(e){M.Bc(i);var t=M.jc().$implicit,r=M.jc(3);return e.stopPropagation(),r.createPrice(t)})),M.Lc(1),M.Wb()}if(2&e){var r=M.jc().$implicit;M.Db(1),M.Mc(r.price_misa)}}var Qe=function(e){return{"detail-cell":e}};function Ze(e,t){if(1&e&&(M.Xb(0,"tr",20),M.Xb(1,"td"),M.Lc(2),M.Wb(),M.Xb(3,"td"),M.Jc(4,$e,2,1,"span",3),M.Jc(5,Ye,2,1,"a",9),M.Wb(),M.Xb(6,"td"),M.Lc(7),M.Wb(),M.Xb(8,"td"),M.Lc(9),M.Wb(),M.Xb(10,"td"),M.Lc(11),M.Wb(),M.Xb(12,"td",5),M.Lc(13),M.kc(14,"number"),M.Wb(),M.Xb(15,"td"),M.Lc(16),M.Wb(),M.Xb(17,"td",5),M.Lc(18),M.kc(19,"number"),M.Wb(),M.Xb(20,"td",5),M.Lc(21),M.kc(22,"number"),M.Wb(),M.Xb(23,"td"),M.Lc(24),M.Wb(),M.Xb(25,"td",5),M.Lc(26),M.Wb(),M.Xb(27,"td",5),M.Lc(28),M.kc(29,"number"),M.Wb(),M.Sb(30,"td"),M.Wb()),2&e){var i=t.$implicit,r=t.index,n=M.jc().$implicit;M.pc("ngClass",M.rc(26,Qe,n.data_expand)),M.Db(2),M.Mc(r+1),M.Db(2),M.pc("ngIf",i.price),M.Db(1),M.pc("ngIf",!i.price),M.Db(2),M.Mc(null==i.price?null:i.price.code),M.Db(2),M.Mc(null==i.price?null:i.price.unit_code),M.Db(2),M.Mc(i.volume),M.Db(2),M.Mc(M.mc(14,14,i.amount,"1.0-0")),M.Db(3),M.Mc(i.tax),M.Db(2),M.Mc(M.mc(19,17,i.t_amount,"VND"==i.currency.code?"1.0-0":"1.2-2")),M.Db(3),M.Mc(M.mc(22,20,i.t_tax,"VND"==i.currency.code?"1.0-0":"1.2-2")),M.Db(3),M.Mc(i.currency?i.currency.code:""),M.Db(2),M.Mc(i.ex_rate),M.Db(2),M.Mc(M.mc(29,23,(i.t_amount+i.t_tax)*i.ex_rate,"1.0-0"))}}var Ke=function(e,t,i){return{error:e,success:t,"accent-200-bg":i}};function et(e,t){if(1&e&&(M.Vb(0),M.Xb(1,"tr",8),M.fc("click",(function(e){var i=t.$implicit;return i.data_expand=!i.data_expand})),M.Xb(2,"td"),M.Lc(3),M.Wb(),M.Xb(4,"td"),M.Lc(5),M.Wb(),M.Xb(6,"td"),M.Jc(7,Je,2,1,"span",3),M.Jc(8,Ve,2,1,"a",9),M.Wb(),M.Xb(9,"td"),M.Lc(10),M.Wb(),M.Xb(11,"td"),M.Lc(12),M.kc(13,"date"),M.Wb(),M.Xb(14,"td",5),M.Lc(15),M.kc(16,"number"),M.Wb(),M.Xb(17,"td",5),M.Lc(18),M.kc(19,"number"),M.Wb(),M.Xb(20,"td",5),M.Lc(21),M.kc(22,"number"),M.Wb(),M.Xb(23,"td"),M.Lc(24),M.Wb(),M.Xb(25,"td",6),M.Lc(26),M.Wb(),M.Xb(27,"td"),M.Lc(28),M.Wb(),M.Xb(29,"td"),M.Lc(30),M.Wb(),M.Xb(31,"td"),M.Jc(32,He,2,0,"mat-icon",10),M.Jc(33,Ue,2,0,"mat-icon",11),M.Jc(34,Ge,2,0,"mat-icon",11),M.Wb(),M.Wb(),M.Xb(35,"tr",12),M.Xb(36,"td",13),M.Xb(37,"div",14),M.Xb(38,"table",15),M.Xb(39,"thead"),M.Xb(40,"tr"),M.Xb(41,"th"),M.Lc(42,"No"),M.Wb(),M.Xb(43,"th"),M.Lc(44,"Price Misa"),M.Wb(),M.Xb(45,"th"),M.Lc(46,"Price"),M.Wb(),M.Xb(47,"th"),M.Lc(48,"Unit"),M.Wb(),M.Xb(49,"th"),M.Lc(50,"Volume"),M.Wb(),M.Xb(51,"th",5),M.Lc(52,"Amount"),M.Wb(),M.Xb(53,"th"),M.Lc(54,"Tax(%)"),M.Wb(),M.Xb(55,"th",5),M.Lc(56,"Total amount"),M.Wb(),M.Xb(57,"th",5),M.Lc(58,"Total tax"),M.Wb(),M.Xb(59,"th"),M.Lc(60,"Currency"),M.Wb(),M.Xb(61,"th",5),M.Lc(62,"Exrate"),M.Wb(),M.Xb(63,"th",5),M.Lc(64,"Total VND"),M.Wb(),M.Sb(65,"th"),M.Wb(),M.Wb(),M.Xb(66,"tbody"),M.Jc(67,Ze,31,28,"tr",16),M.Wb(),M.Wb(),M.Wb(),M.Wb(),M.Wb(),M.Ub()),2&e){var i=t.$implicit,r=t.index;M.Db(1),M.pc("ngClass",M.tc(31,Ke,i.error.includes("error"),i.error.includes("success"),i.duplicate)),M.Db(2),M.Mc(r+1),M.Db(2),M.Mc(i.invoice_number),M.Db(2),M.pc("ngIf",i.party),M.Db(1),M.pc("ngIf",!i.party),M.Db(2),M.Mc(null==i.party?null:i.party.short_name),M.Db(2),M.Mc(M.mc(13,19,i.issue_date,"MM/dd/yyyy")),M.Db(3),M.Mc(M.mc(16,22,i.amount,"1.0-0")),M.Db(3),M.Mc(M.mc(19,25,i.tax,"1.0-0")),M.Db(3),M.Mc(M.mc(22,28,i.amount+i.tax,"1.0-0")),M.Db(3),M.Mc(null==i.payment_center?null:i.payment_center.name),M.Db(2),M.Mc(i.info),M.Db(2),M.Mc(1==i.type?"Revenue":"Cost"),M.Db(2),M.Mc(i.error),M.Db(2),M.pc("ngIf",!i.id&&""==i.error),M.Db(1),M.pc("ngIf",i.id),M.Db(1),M.pc("ngIf",i.duplicate),M.Db(3),M.pc("@detailExpand",i.data_expand?"expanded":"collapsed"),M.Db(30),M.pc("ngForOf",i.itemPrice)}}function tt(e,t){if(1&e&&(M.Xb(0,"table",4),M.Xb(1,"thead"),M.Xb(2,"tr"),M.Xb(3,"th"),M.Lc(4,"No"),M.Wb(),M.Xb(5,"th"),M.Lc(6,"Number"),M.Wb(),M.Xb(7,"th"),M.Lc(8,"Party Misa"),M.Wb(),M.Xb(9,"th"),M.Lc(10,"Party"),M.Wb(),M.Xb(11,"th"),M.Lc(12,"Issue date"),M.Wb(),M.Xb(13,"th",5),M.Lc(14,"Amount"),M.Wb(),M.Xb(15,"th",5),M.Lc(16,"Tax"),M.Wb(),M.Xb(17,"th",5),M.Lc(18,"Total"),M.Wb(),M.Xb(19,"th"),M.Lc(20,"Payment center"),M.Wb(),M.Xb(21,"th",6),M.Lc(22,"Info"),M.Wb(),M.Xb(23,"th"),M.Lc(24,"Type"),M.Wb(),M.Xb(25,"th"),M.Lc(26,"Error"),M.Wb(),M.Sb(27,"th"),M.Wb(),M.Wb(),M.Xb(28,"tbody"),M.Jc(29,et,68,35,"ng-container",7),M.Wb(),M.Wb()),2&e){var i=M.jc();M.Db(29),M.pc("ngForOf",i.invoiceFilter)}}function it(e,t){if(1&e&&(M.Xb(0,"mat-option",30),M.Lc(1),M.Wb()),2&e){var i=t.$implicit,r=M.jc(2);M.pc("value",i),M.Db(1),M.Pc("",10*i+1," - ",10*(i+1)<r.invoiceImport.length?10*(i+1):r.invoiceImport.length," / ",r.invoiceImport.length,"")}}function rt(e,t){if(1&e){var i=M.Yb();M.Xb(0,"div"),M.Xb(1,"mat-button-toggle-group",21),M.Xb(2,"mat-button-toggle",22),M.fc("change",(function(e){return M.Bc(i),M.jc().changeItem(e)})),M.Xb(3,"mat-icon",23),M.Lc(4,"fast_rewind"),M.Wb(),M.Wb(),M.Xb(5,"mat-button-toggle"),M.Xb(6,"div",24),M.Xb(7,"mat-select",25),M.fc("ngModelChange",(function(e){return M.Bc(i),M.jc().onChangeSelect(e)})),M.Jc(8,it,2,4,"mat-option",26),M.Wb(),M.Wb(),M.Wb(),M.Xb(9,"mat-button-toggle",27),M.fc("change",(function(e){return M.Bc(i),M.jc().changeItem(e)})),M.Xb(10,"mat-icon",23),M.Lc(11,"fast_forward"),M.Wb(),M.Wb(),M.Wb(),M.Xb(12,"button",28),M.fc("click",(function(e){M.Bc(i);var t=M.jc();return t.saveImport(t.invoiceFilter)})),M.Lc(13,"Save"),M.Wb(),M.Xb(14,"button",29),M.fc("click",(function(e){return M.Bc(i),M.jc().goBack(!0)})),M.Xb(15,"span"),M.Lc(16,"New Import"),M.Wb(),M.Wb(),M.Xb(17,"button",29),M.fc("click",(function(e){return M.Bc(i),M.jc().goBack()})),M.Xb(18,"span"),M.Lc(19,"Back"),M.Wb(),M.Wb(),M.Wb()}if(2&e){var r=M.jc();M.Db(2),M.pc("disabled",0==r.selectedItem),M.Db(5),M.pc("ngModel",r.selectedItem),M.Db(1),M.pc("ngForOf",r.arrSelect),M.Db(1),M.pc("disabled",r.selectedItem==r.arrSelect.length-1),M.Db(3),M.pc("disabled",0==r.invoiceImport||r.check)}}var nt,at=((nt=function(){function e(t,i,r,n,a,o,c,l){_classCallCheck(this,e),this._formBuilder=t,this.router=i,this.route=r,this.authService=n,this.datePipe=a,this.fileImportService=o,this.googleApiService=c,this._matDialog=l,this.height=560,this.save=!0,this.selectedItem=0,this.invoiceFilter=[],this.arrSelect=[],this.formInvoiceImport=this._formBuilder.group({invoice_account:[null,V.y.required]}),this.check=!1,this._unsubscribeAll=new O.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.authService.windowSizeChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t.height-64-12-12-54-8-72})),this.authService.changeScreen.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.height=t?e.authService.screenHeight-12-12-54-8-72:e.authService.screenHeight-64-12-12-54-8-72})),this.googleApiService.onFileDataChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.invoiceImport=t[0],e.invoiceType=t[1],e.arrSelect=[];for(var i=Math.round(e.invoiceImport.length/10),r=0;r<=i;++r)e.arrSelect.push(r);e.invoiceFilter=[],e.selectedItem=0,e.check=!1,e.invoiceImport.map((function(t,i){i>=10*e.selectedItem&&i<=10*(e.selectedItem+1)-1&&(e.invoiceFilter.push(t),(t.error||t.duplicate)&&(e.check=!0))}))})),this.fileImportService.onDataChanged.pipe(Object(H.a)(this._unsubscribeAll)).subscribe((function(t){e.type=e.fileImportService.type,e.customerArr=e.fileImportService.customerArr,e.supplierArr=e.fileImportService.supplierArr,e.priceArr=e.fileImportService.priceArr}))}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}},{key:"getData",value:function(){var e=this;this.authService.onRequestChanged.next(!0),this.fileImportService.getData().then((function(t){e.authService.onRequestChanged.next(!1)})).catch((function(t){e.authService.onRequestChanged.next(!1),console.error(t),alert("Error: Server error")}))}},{key:"onChangeSelect",value:function(e){var t=this;this.selectedItem=e,this.invoiceFilter=[],this.check=!1,this.invoiceImport.map((function(e,i){i>=10*t.selectedItem&&i<=10*(t.selectedItem+1)-1&&(t.invoiceFilter.push(e),e.error&&(t.check=!0))}))}},{key:"changeItem",value:function(e){var t=this;this.selectedItem=this.selectedItem+parseInt(e.value),this.invoiceFilter=[],this.check=!1,this.invoiceImport.map((function(e,i){i>=10*t.selectedItem&&i<=10*(t.selectedItem+1)-1&&(t.invoiceFilter.push(e),e.error&&(t.check=!0))}))}},{key:"saveImport",value:function(e){var t=this;this.save=!0,e.map((function(e){t.save&&setTimeout((function(){t.saveInvoice(e)}),500)}))}},{key:"saveInvoice",value:function(e){var t=this,i=JSON.parse(JSON.stringify(e));i.party=i.party.id,i.payment_center=i.payment_center.id,i.issue_date&&(i.issue_date=this.datePipe.transform(i.issue_date,"yyyy-MM-dd")),i.itemPrice.map((function(e){e.pay_date&&(e.pay_date=t.datePipe.transform(e.pay_date,"yyyy-MM-dd")),e.currency=e.currency.id})),this.fileImportService.createInvoice(i,this.invoiceType).then((function(i){var r=t.invoiceImport.indexOf(e);t.invoiceImport[r].error="Save invoice success!",t.invoiceImport[r].id=i.createInv.insertId})).catch((function(e){t.save=!1,alert("ERROR"),console.error(e)}))}},{key:"deleteInvoice",value:function(e,t){var i=this;this.authService.onRequestChanged.next(!0),this.fileImportService.deleteSelInvoice(e.id,this.invoiceType).then((function(r){if(i.authService.onRequestChanged.next(!1),1==r.invoice.affectedRows){var n=i.invoiceImport.indexOf(e);i.invoiceImport.splice(n,1),i.invoiceFilter.splice(t,1)}})).catch((function(e){i.authService.onRequestChanged.next(!1),alert("ERROR"),console.error(e)}))}},{key:"getCheck",value:function(){var e=!1;return this.invoiceImport.map((function(t){(t.error||t.duplicate)&&(e=!0)})),e}},{key:"goBack",value:function(e){e&&(this.googleApiService.form=null),this.googleApiService.onFileChanged.next([]),this.googleApiService.stepChanged.next(0)}},{key:"createParty",value:function(e){var t=this;JSON.parse(JSON.stringify(e)),this.dialogRef=this._matDialog.open(Be,{panelClass:"file-import-invoice-modal-dialog",data:{label:"Create party misa",party:"revenue"==this.invoiceType?this.customerArr:this.supplierArr,price:this.priceArr,invoiceType:this.invoiceType,data:e}}),this.dialogRef.afterClosed().subscribe((function(e){e&&(t.fileImportService.partymisa[e.misa_party]=e,t.check=!1,t.invoiceFilter=[],t.invoiceImport.map((function(i,r){i.party||i.party_misa!=e.misa_party||(i.party=t.fileImportService.party[e.party],i.payment_center=t.fileImportService.country[i.party.country]),t.fileImportService.checkError(i),r>=10*t.selectedItem&&r<=10*(t.selectedItem+1)-1&&(t.invoiceFilter.push(i),(i.error||i.duplicate)&&(t.check=!0))})))}))}},{key:"createPrice",value:function(e){var t=this;JSON.parse(JSON.stringify(e)),this.dialogRef=this._matDialog.open(Be,{panelClass:"file-import-invoice-modal-dialog",data:{label:"Create price misa",party:"revenue"==this.invoiceType?this.customerArr:this.supplierArr,price:this.priceArr,invoiceType:this.invoiceType,data:e}}),this.dialogRef.afterClosed().subscribe((function(e){e&&(t.fileImportService.partymisa[e.misa_party]=e,t.check=!1,t.invoiceFilter=[],t.invoiceImport.map((function(i,r){i.itemPrice.map((function(i){i.price||i.price_misa!=e.misa_price||(i.price=t.fileImportService.price[e.price],i.unit=i.price.unit_code)})),t.fileImportService.checkError(i),r>=10*t.selectedItem&&r<=10*(t.selectedItem+1)-1&&(t.invoiceFilter.push(i),(i.error||i.duplicate)&&(t.check=!0))})))}))}},{key:"buildFilterData",value:function(e){}}]),e}()).\u0275fac=function(e){return new(e||nt)(M.Rb(V.d),M.Rb(n.g),M.Rb(n.a),M.Rb(q.a),M.Rb(a.f),M.Rb(B),M.Rb(Y.a),M.Rb(x.b))},nt.\u0275cmp=M.Lb({type:nt,selectors:[["file-import-invoice-table"]],viewQuery:function(e,t){var i;1&e&&M.Sc(D.e,!0),2&e&&M.wc(i=M.gc())&&(t.viewPort=i.first)},decls:4,vars:4,consts:[[1,"w-100-p","table-content"],["class","simple invoice-table mt-8",4,"ngIf"],[1,"p-8","w-100-p","mt-8"],[4,"ngIf"],[1,"simple","invoice-table","mt-8"],[1,"text-right"],[1,"w-400"],[4,"ngFor","ngForOf"],[1,"example-element-row",3,"ngClass","click"],["class","cursor-pointer",3,"click",4,"ngIf"],["class","cursor-pointer","color","accent",3,"click",4,"ngIf"],["class","cursor-pointer","color","warn",3,"click",4,"ngIf"],[1,"example-detail-row"],["colspan","12"],["fxLayout","row wrap","fxLayoutAlign","start center",1,"ml-16","example-element-detail"],[1,"view-table",2,"width","100%","border-collapse","collapse"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"cursor-pointer",3,"click"],["color","accent",1,"cursor-pointer",3,"click"],["color","warn",1,"cursor-pointer",3,"click"],[3,"ngClass"],[1,"mr-8"],["value","-1",3,"disabled","change"],["color","accent"],[1,"w-140"],["required","",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["value","1",3,"disabled","change"],["mat-raised-button","","type","button","color","accent",1,"mt-8","mr-8",3,"disabled","click"],["type","button","mat-raised-button","","color","accent",1,"ml-8",3,"click"],[3,"value"]],template:function(e,t){1&e&&(M.Xb(0,"div",0),M.Jc(1,tt,30,1,"table",1),M.Wb(),M.Xb(2,"div",2),M.Jc(3,rt,20,5,"div",3),M.Wb()),2&e&&(M.Ic("height",t.height,"px"),M.Db(1),M.pc("ngIf",t.invoiceFilter.length>0),M.Db(2),M.pc("ngIf",t.invoiceImport.length>0))},directives:[a.t,a.s,a.q,Z.a,Q.d,Q.c,f.a,u.b,u.a,g.a,V.w,V.p,V.s,b.b,De.n],pipes:[a.f,a.g],styles:["file-import-invoice-table .table-content{overflow:auto}file-import-invoice-table .table-content .invoice-table{font-size:12px;width:99%;border-collapse:collapse}file-import-invoice-table .table-content .invoice-table td,file-import-invoice-table .table-content .invoice-table th{font-size:12px;border:1px solid #d6d7d6}file-import-invoice-table .table-content .invoice-table thead th{position:sticky;position:-webkit-sticky;top:0;background:#a5d7ef;z-index:20;padding:8px}file-import-invoice-table .table-content .invoice-table tr.detail-cell td,file-import-invoice-table .table-content .invoice-table tr.example-element-row td{padding:4px 8px}file-import-invoice-table .table-content .invoice-table tr.example-detail-row{height:0!important}file-import-invoice-table .table-content .invoice-table tr.example-element-row:not(.example-expanded-row):hover{background:#ffc4c4}file-import-invoice-table .table-content .invoice-table tr.example-element-row.active-row{background:#a8b3ff}file-import-invoice-table .table-content .invoice-table tr.error{background:#f786d1!important}file-import-invoice-table .table-content .invoice-table tr.success{background:#60f793!important}file-import-invoice-table .table-content .invoice-table .example-element-row td{border-bottom-width:0}file-import-invoice-table .table-content .invoice-table .example-detail-row td{padding:0}file-import-invoice-table .table-content .invoice-table .example-detail-row .example-element-detail{overflow:hidden;display:-webkit-box;display:flex}file-import-invoice-table .table-content .invoice-table .example-detail-row .example-element-detail .view-table td,file-import-invoice-table .table-content .invoice-table .example-detail-row .example-element-detail .view-table th{font-size:12px;padding:4px 8px}"],encapsulation:2,data:{animation:[Object(Ee.p)("detailExpand",[Object(Ee.m)("collapsed",Object(Ee.n)({height:"0px",minHeight:"0"})),Object(Ee.m)("expanded",Object(Ee.n)({height:"*"})),Object(Ee.o)("expanded <=> collapsed",Object(Ee.e)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),nt);i.d(t,"FileImportInvoiceModule",(function(){return lt}));var ot,ct=[{path:"",component:ye,resolve:{data:B,google:Y.a},children:[{path:"view",component:_e},{path:"table",component:at}]}],lt=((ot=function e(){_classCallCheck(this,e)}).\u0275mod=M.Pb({type:ot}),ot.\u0275inj=M.Ob({factory:function(e){return new(e||ot)},providers:[B],imports:[[n.k.forChild(ct),a.c,c.b,l.b,s.c,b.c,u.c,p.b,m.e,f.b,d.b,h.c,v.c,g.b,y.c,x.e,k.b,S.b,X.b,W.d,I.e,w.b,_.b,C.b,L.k,D.g,A.b,P.c,F.a,j.f,o.a]]}),ot)}}]);